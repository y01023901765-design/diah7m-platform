# DIAH-7M 플랫폼 — AI 작업 규칙

## 🔴 이것을 모르고 개발하면 전부 꼬인다 — 인체 = 국가 경제 (DIAH-7M 설계 철학)

이 시스템은 **인체 생리학 ↔ 국가 경제** 1:1 등식에 기반한다.
게이지·서사·보고서·판정 모두 이 등식 위에 지어진 것이다. **등식을 모르면 판정이 틀린다.**

### 혈관 → 경제 구조 매핑 (정책 도달 순서)

| 인체 혈관 | 경제 주체 | 정책 도달 | 비고 |
|---|---|---|---|
| 대동맥·대정맥 | 대기업·금융기관 | 쉽게 도달 | 금리·세금 지원 |
| 세동맥·세정맥 | 중소기업·자영업 | 희석됨 | 정책 효과 반감 |
| 미세혈관 | 골목경제 | 대부분 미도달 | H(저산소) 주요 원인 |
| **세포** | **가계·소상공인** | **직접 도달 불가** | **가장 먼저 죽음** |

> 대동맥(대기업)에 수혈해도 세포(가계·소상공인)까지 닿지 않는다.
> 지역화폐 = 미세혈관 직접 주사 = 올바른 처방.

### 물질 → 경제 등식 (★ 이 시스템 고유 발견)

| 인체 물질 | 경제 개념 | 핵심 특성 |
|---|---|---|
| 칼슘 | 현금·유동성 | 흐르는 것 |
| 뼈 | 비상금고·저축 | 저장되는 것 |
| 미세석회 | **빚 이자** | 굳어서 막히는 것 — **원금(대출)과 근본적으로 다름** |
| CO₂ | 인플레이션 압력 | 쌓여서 썩게 하는 것 — **미세석회(이자)와 다름** |

> 원금(대출)은 돌아올 수 있다. 이자(미세석회)는 굳어서 **절대 돌아오지 않는다.**
> 이자 누적 → 소비 불가(DLT) + 투자 불가(CAM) = **이중봉쇄**

### 5단계 인과 경로 (판정 순서)

```
1단계 요인(깔때기론) → 2단계 시작(유출론) → 3단계 봉쇄(이중봉쇄론)
                     ↘ [압력 축적: CO₂/인플레이션 배출 실패]
→ 4단계 발현(7M론: 단독 또는 복합, 순차 아님) → 5단계 궤멸
```

- **이중봉쇄(CAM+DLT)** = 3단계. 7M의 **원인**이지 7M 기전의 하나가 아님.
- **7M** = 단독 또는 복합 발현. 1M→7M 순서대로 진행하지 않음.
- **DIAH**: D=결핍(수입↓), I=염증(지출↑), A=산증(화폐가치↓), H=저산소(생산중단)

---

## ⚠️ 필수 선행 확인 (작업 전 반드시 읽기)

이 프로젝트는 **워드 보고서(근본 설계) → 배포패키지 v5 → git** 순서로 설계된 시스템입니다.
AI가 기존 설계를 무시하고 독자 개발하는 것은 엄격히 금지됩니다.

---

## ⚠️ 새 기능 개발 전 필수 확인 절차 (재개발 방지)

> 이미 개발된 기능을 다시 만드는 과오를 방지하기 위한 강제 절차.

### 1단계: 함수 맵 확인 (필수)
작업 시작 전 `memory/doctrine-filemap.md` 섹션 2(함수맵)에서 유사 함수/파일 검색.

### 2단계: 판단 기준
- 같은 함수 있음 → 해당 파일 수정 (새 파일 생성 금지)
- 유사 파일 있음 → 기존 파일에 함수 추가
- 확신 없음 → 사용자에게 먼저 질문

### 3단계: 신규 파일 생성 허용 조건 (모두 만족 시만)
```
□ doctrine-filemap.md 함수맵에 없는 완전히 새로운 도메인
□ 기존 파일에 추가 시 단일 책임 원칙 위반 명백
□ 사용자 명시적 승인
```

### 특히 주의할 동명 함수 충돌
- `scoreToLevel()` — core-engine(severity 0~5 입력) vs score-engine(score 0~100 입력) **혼용 금지**
- `renderDOCX()` — renderer.js(**ACTIVE**) vs report_renderer.js(INACTIVE) — **반드시 renderer.js 사용**

---

## 절대 금지 사항

1. **지시 없이 새 파일 생성 금지** — 배포패키지에 없는 파일을 임의로 만들지 않는다
2. **지시 없이 기존 파일 수정 금지** — 사용자 명시적 요청 없이 운영 중인 파일 변경 금지
3. **정본 파일 덮어쓰기 금지** — 다운로드 폴더의 정본 파일은 읽기 전용
4. **중복 파일 임의 생성 금지** — 유사 파일이 있으면 최신 파일에 작업
5. **push 전 사용자 확인 필수** — git push는 반드시 사용자 승인 후 실행

---

## 정본 파일 목록 (기준 문서)

| 역할 | 정본 위치 | 비고 |
|---|---|---|
| 진단 엔진 | `D:\다운로드\core-engine-v2.js` | v5.1, 59게이지 9축 |
| 보고서 렌더러 | `D:\다운로드\full_report_59_v2.jsx` | 59게이지 전체 + 위성 교차참조 |
| 서사 엔진 | `D:\다운로드\DIAH-7M_서사엔진_v2.8.js` | 최신 서사 |
| 보고서 생성기 | `D:\다운로드\DIAH-7M_보고서생성기_v2.7_양식고정.js` | 양식 고정 버전 |
| 마스터 설계도 | `D:\다운로드\DIAH-7M_마스터설계도_v2.7.md` | 전체 설계 기준 |
| 3-Layer 문법 | `D:\다운로드\report-grammar-v2.js` | Layer1/2/3 규격 |
| v2 패치 내용 | `D:\다운로드\PATCH-v2-CHANGELOG.md` | 59게이지, D/M 코드 |
| 용어 규격 | `D:\다운로드\DIAH-7M_최종용어규격화_v2.9.5.docx` | 최신 용어 |
| 배포패키지 | `D:\다운로드\DIAH-7M_v5_배포패키지\` | 전체 구조 기준 |

---

## 현재 git 파일 역할

### server/lib/ (서버 핵심)

| 파일 | 역할 | 상태 |
|---|---|---|
| `core-engine.js` | 진단 엔진 v2.0 | 교체 예정 (→ core-engine-v2.js 정본) |
| `data-pipeline.js` | 59게이지 수집 (ECOS/FRED/Yahoo/TE) | 운영 중 — 건드리지 않음 |
| `data-store.js` | SQLite + memCache | 운영 중 — 건드리지 않음 |
| `score-engine.js` | V2 수축 평균 점수 엔진 | 운영 중 — 건드리지 않음 |
| `global-pipeline.js` | 국가별 점수 집계 | 운영 중 — 건드리지 않음 |
| `stock-pipeline.js` | 주식 파이프라인 | 운영 중 |
| `renderer.js` | 보고서 JSON/DOCX 생성 | 배포패키지 기준 |
| `auth.js` | 인증 | 운영 중 — 건드리지 않음 |
| `billing.js` | 결제/마일리지 | 운영 중 — 건드리지 않음 |
| `db.js` | DB 연결 | 운영 중 — 건드리지 않음 |
| `security.js` | 보안 미들웨어 | 운영 중 — 건드리지 않음 |

### src/ (프론트엔드)

| 파일 | 역할 | 상태 |
|---|---|---|
| `pages/Dashboard.jsx` | 메인 대시보드 | 운영 중 |
| `pages/Stock.jsx` | 주식 페이지 | 운영 중 |
| `components/Satellite.jsx` | 위성 데이터 표시 | 운영 중 |
| `components/Gauges.jsx` | 게이지 표시 | 운영 중 |
| `components/GlobalPulse.jsx` | 글로벌 국가 점수 | 운영 중 |

---

## 시스템 설계 원칙

### 59게이지 9축 구조
```
A1 순환계    [6] : I1 I2 I3 I4 I5 I6
A2 호흡계    [6] : E1 E2 E3 E4 E5 E6
A3 소화계    [6] : C1 C2 C3 C4 C5 C6
A4 신경계    [6] : S1 S2 S3 S4 S5 S6
A5 면역계    [7] : F1 F2 F3 F4 F5 F6 F7
A6 내분비계  [6] : P1 P2 P3 P4 P5 P6
A7 근골격계  [9] : M1 M2 M3 O1 O2 O3 O4 O5 O6
A8 인구/취약 [7] : D1 D2 D3 L1 L2 L3 L4
A9 재생/대외 [6] : R1 R2 R5 R6 G1 G6
                    ─────────────────────
                    합계: 59개
```

### 판정 방식 (배포패키지 기준)
- Level 0~5 경보 방식 (안정/관심/주의/경계/심각/위기)
- 이중봉쇄: CAM(기능적봉쇄) + DLT(물리적봉쇄) 동시 발생
- DIAH 플래그: D(결핍)/I(염증)/A(산증)/H(저산소)

### 보고서 10개 섹션 구조 (워드 보고서 기준)
1. 커버 / 종합판정
2. 게이지 채점표
3. Input 정밀진단 (순환계/신경계/면역계/내분비계)
4. Output 정밀진단 (호흡계/소화계/근골격계)
5. DIAH 트리거 스위치
6. 7M 기전 분석
7. 예후 3경로
8. 시계열 추이
9. 경제 가족력
10. 명의 처방 / 면책고지

---

## 데이터 수집 현황 (2026-02-20 기준)

- **58/58 게이지 OK** (fetchAll 배치 검증 완료)
- ECOS API: 한국은행 데이터 (다중 계층 item code 주의)
- FRED API: 미국 지표
- Yahoo Finance: 주가
- TradingEconomics: PMI, 발틱운임지수 (스크래핑)
- 위성: VIIRS(야간광), Landsat(열섬) — GEE 서비스 계정

---

## 배포 환경

- **Render** (free tier, ~90-120s 배포 시간)
- 서버: Express.js
- DB: SQLite (data-store.js)
- 프론트: Vite + React

---

© 인체국가경제론 / DIAH-7M / 윤종원
