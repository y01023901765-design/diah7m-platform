// ══════════════════════════════════════════════════════════════
// DIAH-7M 서사엔진 v2.8
// 판정엔진 v5.1 출력 → 보고서생성기 v3.1 D 객체 변환
//
// 역할: 숫자 판정을 인체 비유 서사로 변환
// 패턴: "값 — '인체비유' [등급]" + "→ 진단:" + "▶ 종합:"
// 원본: 2026년 1월 확정본 양식에서 추출한 서사 규칙
//
// v2.7 → v2.8 변경:
//   P1: overallGrade 구조 변경 (순환/구조 이원 등급) 호환
//   P2: 축9 구조축 전용 서사 (순환등급과 독립)
//   P3: 교차신호 축4↔축7(부동산↔금융) 서사 추가
//   P4: 종합 진단 서사 이원 구조 (순환+구조)
//   P5: 보고서 표지 등급 이원 표시
// v2.8 → v2.9 (report-grammar 연결):
//   GAUGE_NARRATIVE: v2 코드 59개 서사 (report-grammar.js에서 import)
//   3-Layer 확장: blindSpot(사각지대) + actionSignals(행동시그널) 추가
// ══════════════════════════════════════════════════════════════

// ── report-grammar.js에서 v2 코드 기반 서사 데이터 로드 ──
let GAUGE_NARRATIVE = {};
try {
  const grammar = require('./report-grammar');
  GAUGE_NARRATIVE = grammar.GAUGE_NARRATIVE || {};
} catch (e) {
  console.warn('[narrative-engine] report-grammar 로드 실패 (GAUGE_NARRATIVE 빈 객체 사용):', e.message);
}

// ━━━ 1. 게이지별 인체 비유 매핑 (등급별 3단계) ━━━

const METAPHOR = {
  I1: { // 경상수지 → 폐 기능 (산소 공급)
    name: "경상수지", bodyPart: "폐",
    "양호 ○": { metaphor: "폐 기능 양호", prefix: "산소 공급이 원활하다." },
    "주의 ●": { metaphor: "폐 기능 약화", prefix: "산소 공급이 둔화되고 있다." },
    "경보 ★": { metaphor: "폐 기능 위험", prefix: "산소 공급이 급격히 감소하고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `폐 기능 양호. 비상금고 소진 속도 안정적.${c.includes('+') ? ' 산소 공급 증가세.' : ''}`,
      "주의 ●": (v,c) => `폐 기능 약화 징후. 산소 공급량(${v}) 감소에 주의 필요.`,
      "경보 ★": (v,c) => `폐 기능 경보. 산소 공급(${v})이 위험 수준. D(소득절벽) 트리거 잠복 강화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const base = `비상금고 소진 속도는 ${grade === "양호 ○" ? "안정적" : grade === "주의 ●" ? "다소 불안정" : "위험 수준"}이다. 경상수지(I1)가 ${v}를 기록했다.`;
      return base;
    },
  },

  I2: { // 단기외채비율 → 혈액 점도
    name: "단기외채비율", bodyPart: "혈액점도",
    "양호 ○": { metaphor: "혈액 점도 정상", prefix: "혈액이 원활하게 흐르고 있다." },
    "주의 ●": { metaphor: "혈액 점도 상승", prefix: "혈액이 끈적해지고 있다." },
    "경보 ★": { metaphor: "혈액 점도 위험", prefix: "혈액이 굳어가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈액 점도 정상. 단기외채 비율(${v}) 안전 범위.`,
      "주의 ●": (v,c) => `혈액 점도 상승. 단기외채(${v})가 높아져 거시석회 파열 가능성 증가.`,
      "경보 ★": (v,c) => `혈액 점도 위험. 단기외채(${v})가 임계점 접근. 급성 유동성 위기 가능성.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `단기외채비율(I2)은 ${v}로 ${grade === "양호 ○" ? "안전 범위 내에 있다. 거시석회(기업·정부 빚이자) 파열 가능성은 낮다." : "상승하고 있다. 거시석회 파열 위험이 증가하고 있다."}`;
    },
  },

  I3: { // 외환보유고 → 저장 혈액
    name: "외환보유고", bodyPart: "혈액저장",
    "양호 ○": { metaphor: "저장 혈액 충분", prefix: "국가 체력 저장분이 안정적이다." },
    "주의 ●": { metaphor: "저장 혈액 감소", prefix: "국가 체력 저장분이 줄어들고 있다." },
    "경보 ★": { metaphor: "저장 혈액 부족", prefix: "국가 체력 저장분이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `국가 체력 저장분 안정. 위기 대응 여력 충분.`,
      "주의 ●": (v,c) => `저장 혈액 감소 추세(${c}). 외환보유고 관리 주의 필요.`,
      "경보 ★": (v,c) => `저장 혈액 급감(${c}). 위기 대응 여력 위축. 비상금고 경보.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `외환보유고(I3)는 ${v}로 ${c.includes('-') ? '감소' : '안정'}했으며 세계 9위 수준을 유지하고 있다.`;
    },
  },

  I4: { // 환율 → 혈압
    name: "환율", bodyPart: "혈압",
    "양호 ○": { metaphor: "혈압 안정", prefix: "혈압이 안정적이다." },
    "주의 ●": { metaphor: "혈압 상승", prefix: "혈압이 올라가고 있다." },
    "경보 ★": { metaphor: "혈압 위험", prefix: "혈압이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈압 안정. 환율 변동 범위 내 정상 작동.`,
      "주의 ●": (v,c) => `혈압 상승 지속. ${v} 고환율은 만성 고혈압 상태.`,
      "경보 ★": (v,c) => `혈압 위험. 환율 ${v} 급등은 급성 고혈압. 수입 의존 가계 타격 심화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const dir = c.includes('+') || c.includes('상승') ? '상승' : c.includes('-') ? '하락' : '유지';
      return `환율(I4)은 ${v}으로 전월비 ${c} ${dir}했다. ${grade !== "양호 ○" ? '혈압이 올라가고 있다.' : '혈압이 안정적이다.'}`;
    },
  },

  I5: { // 신용스프레드 → 혈관 탄력
    name: "신용스프레드", bodyPart: "혈관탄력",
    "양호 ○": { metaphor: "혈관 탄력 양호", prefix: "혈관이 유연하게 작동하고 있다." },
    "주의 ●": { metaphor: "혈관 탄력 저하", prefix: "혈관이 경직되기 시작했다." },
    "경보 ★": { metaphor: "혈관 경화", prefix: "혈관이 굳어지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈관 탄력 양호. 신용스프레드(${v}) 정상 범위.`,
      "주의 ●": (v,c) => `혈관 탄력 저하. 신용스프레드(${v}) 확대는 자금 조달 경색 초기 징후.`,
      "경보 ★": (v,c) => `혈관 경화 경보. 신용스프레드(${v}) 급확대는 H(돈맥경화) 트리거 접근 신호.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `신용스프레드(I5)는 ${v}로 ${grade === "양호 ○" ? "혈관이 유연하게 작동하고 있다. 기업 자금 조달에 경색 신호는 없다." : "확대되고 있다. 기업 자금 조달 비용이 증가하고 있다."}`;
    },
  },

  I6: { // 국채금리 → 심박수
    name: "국채금리", bodyPart: "심박수",
    "양호 ○": { metaphor: "심박수 안정", prefix: "심박수가 안정적이다." },
    "주의 ●": { metaphor: "심박수 상승", prefix: "심박수가 빨라지고 있다." },
    "경보 ★": { metaphor: "심박수 위험", prefix: "심박수가 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `심박수 안정. 자금 조달 비용 정상 범위.`,
      "주의 ●": (v,c) => `심박수 점진적 상승. 소상공인과 자영업의 자금 조달 비용 증가 중. 봉쇄 수준은 아님.`,
      "경보 ★": (v,c) => `심박수 위험 수준. 금리 급등으로 자금 조달 경색. H(돈맥경화) 트리거 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `국채금리(I6)가 ${v}로 전월 대비 ${c} 변동했다. ${grade === "양호 ○" ? '심박수가 안정적이다.' : '심박수가 빨라지고 있다.'}`;
    },
  },

  O1: { // 산업생산 → 근육 활력
    name: "산업생산", bodyPart: "근육",
    "양호 ○": { metaphor: "근육 활력 양호", prefix: "근육의 힘이 유지되고 있다." },
    "주의 ●": { metaphor: "근육 활력 약화", prefix: "근육이 뻣뻣해지기 시작했다." },
    "경보 ★": { metaphor: "근육 활력 저하", prefix: "근육이 뻣뻣해지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근육 활력 양호. 실물경제 생산 활동 정상.`,
      "주의 ●": (v,c) => `근육 활력 약화. 산업생산(${v}) 둔화는 미세석회 침착 초기 징후.`,
      "경보 ★": (v,c) => `근육 활력 급격 저하. 내수 기반 제조업의 미세석회 침착 가속 징후.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `가장 심각한 것은 산업생산(O1)이다. 전년 동기 대비 ${v}로, 근육이 뻣뻣해지고 있다. 미세석회(가계 빚이자)가 실물경제의 활력을 갉아먹고 있는 직접적 증거다.`;
      if (grade === "주의 ●") return `산업생산(O1)이 ${v}로 둔화세를 보이고 있다. 근육 활력이 약해지기 시작했다.`;
      return `산업생산(O1)이 ${v}로 양호한 수준을 유지하고 있다.`;
    },
  },

  O2: { // 물가 → 체온
    name: "물가", bodyPart: "체온",
    "양호 ○": { metaphor: "체온 안정", prefix: "체온이 안정적이다." },
    "주의 ●": { metaphor: "체온 미열", prefix: "체온이 다소 올라가 미열 수준이다." },
    "경보 ★": { metaphor: "체온 고열", prefix: "체온이 고열 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `체온 안정. 물가 목표 범위 내 정상 작동.`,
      "주의 ●": (v,c) => `체온 미열. 물가(${v}) 상승 추세에 서민 체감 물가는 헤드라인보다 높다.`,
      "경보 ★": (v,c) => `체온 고열. 물가(${v}) 급등은 A(물가폭등) 트리거 발동 위험. 배출 압력 축적 중.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `물가(O2)는 소비자물가 상승률 ${v}로, ${grade === "양호 ○" ? '한국은행 목표치 부합으로 체온이 안정되었다.' : grade === "주의 ●" ? '미열 수준이다.' : '고열 상태다.'}`;
    },
  },

  O3: { // 실업률 → 세포 괴사율
    name: "실업률", bodyPart: "세포괴사",
    "양호 ○": { metaphor: "세포 활력 양호", prefix: "세포(고용)가 건강하게 유지되고 있다." },
    "주의 ●": { metaphor: "세포 괴사 시작", prefix: "세포(일자리)가 죽어가기 시작했다." },
    "경보 ★": { metaphor: "세포 괴사 가속", prefix: "세포(일자리)가 빠르게 죽어가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `세포 활력 양호. 실업률(${v}) 완전고용 수준.`,
      "주의 ●": (v,c) => `세포 괴사 시작. 실업률(${v}) 상승은 미세석회가 세포를 죽이기 시작했다는 신호.`,
      "경보 ★": (v,c) => `세포 괴사 가속. 실업률(${v}) 급등은 시스템적 위기. 6M(단절) 경로 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade !== "양호 ○") return `실업률(O3)이 ${v}로 상승하며 세포(일자리)가 죽어가고 있다. 미세석회(가계 빚이자)가 경제 세포를 괴사시키는 직접적 증거다.`;
      return `실업률(O3)은 ${v}로 완전고용에 가까운 수준을 유지하고 있다. 세포(일자리) 활력은 양호하다.`;
    },
  },

  O4: { // 주가 → 혈색/안면
    name: "주가", bodyPart: "안면",
    "양호 ○": { metaphor: "혈색 안정", prefix: "혈색이 안정적이다." },
    "주의 ●": { metaphor: "안면 홍조", prefix: "안면이 붉게 달아오르고 있다." },
    "경보 ★": { metaphor: "안면 홍조 급성", prefix: "안면이 위험하게 달아올랐다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈색 안정. 급격한 변동 없이 안정적 순환 유지.`,
      "주의 ●": (v,c) => `안면 홍조. 주가 급등은 거시석회(자산버블) 팽창 신호.`,
      "경보 ★": (v,c) => `안면 홍조 급성. 자산버블 팽창이 실물경제와 괴리. 1M(폐열) 진입 잠재적 뇌관.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "주의 ●" || grade === "경보 ★") return `주가(O4)에서 ${grade === "경보 ★" ? "경보" : "주의"} 신호가 감지된다. 코스피가 ${v}를 기록하며 ${c} 변동했다. 안면이 붉게 달아오르고 있다.`;
      return `주가(O4)가 코스피 ${v}로 ${c} 변동하며 혈색이 안정적이다.`;
    },
  },

  O5: { // 주택가격 → 부종 수치
    name: "주택가격", bodyPart: "부종",
    "양호 ○": { metaphor: "부종 없음", prefix: "조직의 체액 균형이 정상이다." },
    "주의 ●": { metaphor: "부종 시작", prefix: "조직에 체액이 고이기 시작했다." },
    "경보 ★": { metaphor: "부종 심화", prefix: "조직이 심하게 부어올랐다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `부종 없음. 주택가격(${v}) 안정 범위. 거시석회(자산버블) 팽창 신호 없음.`,
      "주의 ●": (v,c) => `부종 시작. 주택가격(${v}) 상승은 거시석회 팽창 초기 징후.`,
      "경보 ★": (v,c) => `부종 심화. 주택가격(${v}) 급등은 거시석회 과잉 팽창. 5M(범파) 경로 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade !== "양호 ○") return `주택가격(O5)이 전월비 ${v} 변동하며 부종이 ${grade === "경보 ★" ? "심화되고" : "시작되고"} 있다. 거시석회(자산버블)가 부동산 부문에서 팽창하고 있다.`;
      return `주택가격(O5)은 전월비 ${v}로 안정적이다. 부종(자산버블) 신호는 관측되지 않는다.`;
    },
  },

  O6: { // 소비 → 손끝 체온
    name: "소비", bodyPart: "손끝",
    "양호 ○": { metaphor: "손끝 체온 유지", prefix: "말단 순환이 유지되고 있다." },
    "주의 ●": { metaphor: "손끝 체온 하락", prefix: "손끝 체온이 차가워지고 있다." },
    "경보 ★": { metaphor: "손끝 체온 경보", prefix: "손끝이 얼어붙고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => {
        const numVal = parseFloat(v);
        if (numVal < 0) return "손끝 체온 지속 하락. 미세석회 침착의 조용한 증거.";
        return "손끝 체온 유지. 소비 여력 정상 범위.";
      },
      "주의 ●": (v,c) => `손끝 체온 지속 하락. 미세석회 침착의 조용한 증거.`,
      "경보 ★": (v,c) => `손끝 체온 경보. 미세석회가 말단 순환을 심각하게 잠식. DLT 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const numVal = parseFloat(v);
      if (numVal < 0) return `소비(O6)는 전월비 ${v}로 내수 부진이 이어지고 있다. 손끝 체온이 차갑다. 수출이 호조를 기록하는 동안 가계의 지갑은 닫혀 있다. 미세석회(가계 빚이자)가 말단의 소비 여력을 잠식한 결과다.`;
      return `소비(O6)는 전월비 ${v}로 내수가 안정적이다. 말단 순환이 유지되고 있다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 2. 무역/제조업 — 동맥 혈류 (S1~S3, T1~T3)
  // ════════════════════════════════════════════════════

  S1: { // 선박 입출항/대기일수 → 동맥 맥박
    name: "선박대기", bodyPart: "동맥맥박", axis: 2,
    "양호 ○": { metaphor: "동맥 맥박 정상", prefix: "항만 물동량이 원활하게 흐르고 있다." },
    "주의 ●": { metaphor: "동맥 맥박 불규칙", prefix: "항만 대기가 늘어나며 혈류가 지연되고 있다." },
    "경보 ★": { metaphor: "동맥 맥박 위험", prefix: "항만 정체가 심각하며 동맥 혈류가 막히고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 맥박 정상. 선박 대기일수(${v}) 안정. 물동량 순환 원활.`,
      "주의 ●": (v,c) => `동맥 맥박 불규칙. 선박 대기(${v}) 증가. 공급망 지연 초기 징후.`,
      "경보 ★": (v,c) => `동맥 맥박 경보. 선박 대기(${v}) 급증. 공급망 병목이 수출 동맥을 압박.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `선박 대기일수(S1)가 ${v}로 급증했다. 항만이 막혀 수출 동맥의 혈류가 정체되고 있다. 글로벌 공급망 병목이 한국 수출의 물리적 통로를 압박하는 형국이다.`;
      if (grade === "주의 ●") return `선박 대기일수(S1)가 ${v}로 소폭 증가했다. 동맥의 맥박이 다소 불규칙하다. 일시적 물류 지연인지 구조적 병목의 시작인지 관찰이 필요하다.`;
      return `선박 대기일수(S1)가 ${v}로 정상 범위다. 수출 동맥의 맥박이 규칙적으로 뛰고 있다.`;
    },
  },

  S2: { // 야간광량 (항만/공단) → 동맥 활력
    name: "야간광량", bodyPart: "동맥활력", axis: 2,
    "양호 ○": { metaphor: "동맥 활력 양호", prefix: "항만·공단의 야간 활동이 활발하다." },
    "주의 ●": { metaphor: "동맥 활력 저하", prefix: "항만·공단의 야간 활동이 둔화되고 있다." },
    "경보 ★": { metaphor: "동맥 활력 위험", prefix: "항만·공단의 야간 활동이 급감했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 활력 양호. 항만·공단 야간광량(${v}) 안정. 가동률 정상.`,
      "주의 ●": (v,c) => `동맥 활력 저하. 야간광량(${v}) 감소는 공단 가동률 하락 신호.`,
      "경보 ★": (v,c) => `동맥 활력 경보. 야간광량(${v}) 급감. 공단 셧다운 가능성.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `위성이 포착한 항만·공단 야간광량(S2)이 ${v} 급감했다. 동맥의 활력이 급속히 떨어지고 있다. 공장의 불이 꺼지면 수출의 심장이 멈추는 것이다.`;
      if (grade === "주의 ●") return `항만·공단 야간광량(S2)이 ${v} 감소했다. 동맥의 활력이 다소 저하되었다. 계절적 요인인지 구조적 위축인지 확인이 필요하다.`;
      return `항만·공단 야간광량(S2)이 ${v}로 안정적이다. 동맥의 활력이 유지되고 있다. 위성이 확인하는 실물 가동 신호다.`;
    },
  },

  S3: { // NO₂ 농도 (공단 상공) → 동맥 배기
    name: "NO₂농도", bodyPart: "동맥배기", axis: 2,
    "양호 ○": { metaphor: "동맥 배기 정상", prefix: "공단 상공의 배기가스 농도가 정상 가동을 시사한다." },
    "주의 ●": { metaphor: "동맥 배기 감소", prefix: "공단 상공의 배기가스가 줄어들며 생산 둔화를 시사한다." },
    "경보 ★": { metaphor: "동맥 배기 급감", prefix: "공단 상공의 배기가스가 급감하며 생산 중단 징후다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 배기 정상. NO₂ 농도(${v}) 안정. 제조업 가동 확인.`,
      "주의 ●": (v,c) => `동맥 배기 감소. NO₂(${v}) 하락은 공단 가동 위축 신호.`,
      "경보 ★": (v,c) => `동맥 배기 경보. NO₂(${v}) 급감. 공단 생산라인 중단 가능성.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `환경위성이 측정한 공단 상공 NO₂(S3)가 ${v} 급감했다. 공장이 돌아가면 배기가스가 나온다 — 배기가 사라진다는 것은 동맥이 멈추고 있다는 뜻이다.`;
      if (grade === "주의 ●") return `공단 상공 NO₂(S3)가 ${v} 감소했다. 동맥의 배기가 줄어들고 있다. 생산 둔화의 위성 증거다.`;
      return `공단 상공 NO₂(S3)가 ${v}로 정상 범위다. 동맥이 활발히 작동하며 배기를 내뿜고 있다. 위성이 확인하는 제조업 가동 지표다.`;
    },
  },

  T1: { // 수출입 컨테이너 TEU → 혈류 총량
    name: "컨테이너", bodyPart: "혈류총량", axis: 2,
    "양호 ○": { metaphor: "혈류 총량 정상", prefix: "수출입 물동량이 충분히 순환하고 있다." },
    "주의 ●": { metaphor: "혈류 총량 감소", prefix: "수출입 물동량이 줄어들며 혈류가 둔화되고 있다." },
    "경보 ★": { metaphor: "혈류 총량 위험", prefix: "수출입 물동량이 급감하며 혈류 부족 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈류 총량 정상. 컨테이너 물동량(${v}) 안정. 무역 순환 원활.`,
      "주의 ●": (v,c) => `혈류 총량 감소. TEU(${v}) 하락. 수출입 둔화 초기 단계.`,
      "경보 ★": (v,c) => `혈류 총량 경보. TEU(${v}) 급감. 무역 순환 위축 심화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `수출입 컨테이너(T1)가 ${v}로 급감했다. 동맥을 흐르는 혈류의 총량이 위험 수준으로 줄었다. 수출 의존 경제의 생명선이 가늘어지고 있다.`;
      if (grade === "주의 ●") return `수출입 컨테이너(T1)가 ${v}로 소폭 감소했다. 동맥의 혈류 총량이 다소 줄었다. 글로벌 수요 둔화가 한국 무역에 영향을 미치기 시작했다.`;
      return `수출입 컨테이너(T1)가 ${v}로 안정적이다. 동맥의 혈류 총량이 충분하다. 무역 순환이 원활하게 유지되고 있다.`;
    },
  },

  T2: { // 제조업 BSI/PMI → 제조 체감
    name: "제조업BSI", bodyPart: "제조체감", axis: 2,
    "양호 ○": { metaphor: "동맥 탄력 양호", prefix: "제조업 체감이 확장 국면이다." },
    "주의 ●": { metaphor: "동맥 탄력 저하", prefix: "제조업 체감이 위축 국면에 접어들고 있다." },
    "경보 ★": { metaphor: "동맥 탄력 경직", prefix: "제조업 체감이 급격히 위축되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 탄력 양호. BSI(${v}) 확장 국면. 제조업 자신감 유지.`,
      "주의 ●": (v,c) => `동맥 탄력 저하. BSI(${v}) 기준선 접근. 제조업 체감 위축 시작.`,
      "경보 ★": (v,c) => `동맥 탄력 경직. BSI(${v}) 급락. 제조업 심리 냉각.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `제조업 BSI(T2)가 ${v}로 급락했다. 동맥의 탄력이 경직되었다. 제조업 현장이 느끼는 체감 경기가 급속히 냉각되고 있다.`;
      if (grade === "주의 ●") return `제조업 BSI(T2)가 ${v}로 기준선에 근접했다. 동맥의 탄력이 다소 줄었다. 확장에서 위축으로 전환되는 경계에 있다.`;
      return `제조업 BSI(T2)가 ${v}로 확장 국면을 유지하고 있다. 동맥의 탄력이 양호하다. 제조업 현장의 자신감이 살아 있다.`;
    },
  },

  T3: { // 산업용 전력사용량 → 동맥 가동률
    name: "산업전력", bodyPart: "동맥가동률", axis: 2,
    "양호 ○": { metaphor: "동맥 가동률 정상", prefix: "산업용 전력이 정상적으로 소비되고 있다." },
    "주의 ●": { metaphor: "동맥 가동률 저하", prefix: "산업용 전력 사용이 줄어들며 가동률이 하락하고 있다." },
    "경보 ★": { metaphor: "동맥 가동률 위험", prefix: "산업용 전력 사용이 급감하며 가동률이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 가동률 정상. 산업전력(${v}) 안정. 제조라인 가동 확인.`,
      "주의 ●": (v,c) => `동맥 가동률 저하. 산업전력(${v}) 감소. 공장 가동 둔화 실측.`,
      "경보 ★": (v,c) => `동맥 가동률 경보. 산업전력(${v}) 급감. 제조라인 정지 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const numVal = parseFloat(v);
      if (numVal < 0 || grade === "경보 ★") return `산업용 전력(T3)이 ${v} 감소했다. 전기는 거짓말을 하지 않는다 — 공장이 돌아가면 전기를 쓰고, 서면 꺼진다. 동맥의 가동률이 실측으로 하락 확인되었다.`;
      if (grade === "주의 ●") return `산업용 전력(T3)이 ${v}로 소폭 감소했다. 동맥의 가동률이 다소 떨어졌다. 전력사용량은 조작이 불가능한 실물 가동 지표다.`;
      return `산업용 전력(T3)이 ${v}로 안정적이다. 동맥의 가동률이 유지되고 있다. 전력거래소 데이터가 확인하는 실측 신호다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 3. 골목시장 — 미세혈관 (M1~M5)
  // ════════════════════════════════════════════════════

  M1: { // 개업/폐업 → 모세혈관 생성/소멸
    name: "개폐업", bodyPart: "미세혈관생멸", axis: 3,
    "양호 ○": { metaphor: "미세혈관 재생 양호", prefix: "골목 상권의 개업이 폐업을 상회하며 혈관이 새로 뚫리고 있다." },
    "주의 ●": { metaphor: "미세혈관 재생 둔화", prefix: "폐업이 개업을 따라잡으며 혈관 재생이 멈추고 있다." },
    "경보 ★": { metaphor: "미세혈관 괴사 시작", prefix: "폐업이 개업을 압도하며 골목의 혈관이 죽어가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `미세혈관 재생 양호. 개폐업 비율(${v}) 안정. 골목 상권 순환 유지.`,
      "주의 ●": (v,c) => `미세혈관 재생 둔화. 개폐업(${v}) 균형 붕괴 시작. 골목 위축 초기.`,
      "경보 ★": (v,c) => `미세혈관 괴사 시작. 폐업률(${v}) 급증. 골목 상권 사망 신호.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `개폐업 비율(M1)이 ${v}로 폐업이 개업을 압도하고 있다. 골목의 미세혈관이 괴사하기 시작했다. 새 혈관이 뚫리는 속도보다 기존 혈관이 막히는 속도가 빠르다 — 이것이 골목 사망의 첫 신호다.`;
      if (grade === "주의 ●") return `개폐업 비율(M1)이 ${v}로 균형이 무너지기 시작했다. 미세혈관의 재생이 둔화되고 있다. 개업과 폐업의 균형이 골목 건강의 바로미터다.`;
      return `개폐업 비율(M1)이 ${v}로 개업이 폐업을 상회하고 있다. 미세혈관이 새로 생기고 있다. 골목 상권의 자생력이 유지되고 있다.`;
    },
  },

  M2: { // 유동인구 → 미세혈관 혈류량
    name: "유동인구", bodyPart: "미세혈관혈류", axis: 3,
    "양호 ○": { metaphor: "미세혈관 혈류 정상", prefix: "골목에 사람이 돌아다니며 혈류가 흐르고 있다." },
    "주의 ●": { metaphor: "미세혈관 혈류 감소", prefix: "골목의 발길이 줄며 혈류가 약해지고 있다." },
    "경보 ★": { metaphor: "미세혈관 혈류 급감", prefix: "골목이 텅 비며 혈류가 거의 멈추고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `미세혈관 혈류 정상. 유동인구(${v}) 안정. 골목 활력 유지.`,
      "주의 ●": (v,c) => `미세혈관 혈류 감소. 유동인구(${v}) 하락. 골목 활력 저하 시작.`,
      "경보 ★": (v,c) => `미세혈관 혈류 급감. 유동인구(${v}) 급락. 골목 생존 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `유동인구(M2)가 ${v} 급감했다. 미세혈관에 피가 돌지 않는다. 사람이 걷지 않는 골목에서 상권은 살 수 없다 — 혈류 없는 조직은 괴사한다.`;
      if (grade === "주의 ●") return `유동인구(M2)가 ${v} 감소했다. 미세혈관의 혈류가 약해지고 있다. 발길이 줄면 매출이 줄고, 매출이 줄면 폐업이 늘어나는 악순환의 시작점이다.`;
      return `유동인구(M2)가 ${v}로 안정적이다. 미세혈관에 혈류가 충분히 흐르고 있다. 골목에 사람이 다니는 것 자체가 상권 생존의 제1 조건이다.`;
    },
  },

  M3: { // 카드매출 → 미세혈관 산소교환
    name: "카드매출", bodyPart: "미세혈관산소교환", axis: 3,
    "양호 ○": { metaphor: "산소 교환 정상", prefix: "골목의 매출이 유지되며 산소가 세포에 공급되고 있다." },
    "주의 ●": { metaphor: "산소 교환 둔화", prefix: "골목 매출이 줄며 세포에 산소가 부족해지고 있다." },
    "경보 ★": { metaphor: "산소 교환 마비", prefix: "골목 매출이 급감하며 세포가 질식하고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `산소 교환 정상. 카드매출(${v}) 안정. 골목 소비 순환 유지.`,
      "주의 ●": (v,c) => `산소 교환 둔화. 카드매출(${v}) 감소. 골목 소비 위축 시작.`,
      "경보 ★": (v,c) => `산소 교환 마비. 카드매출(${v}) 급감. 골목 경제 질식 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `카드매출(M3)이 ${v} 급감했다. 미세혈관에서 산소 교환이 거의 멈추고 있다. 매출은 골목 세포의 산소다 — 산소가 끊기면 세포는 죽는다.`;
      if (grade === "주의 ●") return `카드매출(M3)이 ${v} 감소했다. 미세혈관에서의 산소 교환이 둔화되고 있다. 유동인구가 줄면 매출이 줄고, 미세석회(가계 빚이자)가 소비를 잠식한 결과다.`;
      return `카드매출(M3)이 ${v}로 안정적이다. 미세혈관에서 산소 교환이 정상적으로 이루어지고 있다. 골목의 세포(소상공인)에게 산소(매출)가 공급되고 있다.`;
    },
  },

  M4: { // 상가 임대차 → 미세혈관 벽 압력
    name: "상가임대", bodyPart: "미세혈관벽압", axis: 3,
    "양호 ○": { metaphor: "혈관벽 압력 정상", prefix: "상가 임대료가 안정적이며 혈관벽이 버티고 있다." },
    "주의 ●": { metaphor: "혈관벽 압력 상승", prefix: "임대료 부담이 커지며 혈관벽이 눌리고 있다." },
    "경보 ★": { metaphor: "혈관벽 파열 위험", prefix: "임대료가 감당 불가 수준이며 혈관벽이 터질 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈관벽 압력 정상. 상가임대(${v}) 안정. 고정비 부담 감당 범위.`,
      "주의 ●": (v,c) => `혈관벽 압력 상승. 상가임대(${v}) 상승. 소상공인 고정비 압박.`,
      "경보 ★": (v,c) => `혈관벽 파열 위험. 상가임대(${v}) 급등. 매출 대비 임대료 감당 불가.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `상가 임대료(M4)가 ${v} 급등했다. 미세혈관의 벽이 터질 지경이다. 매출은 줄어드는데 임대료는 오른다 — 이것이 골목 상권을 죽이는 가장 흔한 방식이다.`;
      if (grade === "주의 ●") return `상가 임대료(M4)가 ${v} 상승했다. 미세혈관 벽에 가해지는 압력이 커지고 있다. 매출 대비 임대료 비율이 소상공인의 생존선을 위협하기 시작했다.`;
      return `상가 임대료(M4)가 ${v}로 안정적이다. 미세혈관 벽의 압력이 정상 범위다. 고정비 부담이 감당 가능한 수준이다.`;
    },
  },

  M5: { // 상권 등급 변화 → 미세혈관 등급
    name: "상권등급", bodyPart: "미세혈관등급", axis: 3,
    "양호 ○": { metaphor: "미세혈관 등급 양호", prefix: "상권 등급이 유지·상승하며 혈관 건강이 양호하다." },
    "주의 ●": { metaphor: "미세혈관 등급 하락", prefix: "상권 등급이 하락하며 혈관 건강이 악화되고 있다." },
    "경보 ★": { metaphor: "미세혈관 등급 위험", prefix: "상권이 급격히 퇴화하며 혈관이 사라지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `미세혈관 등급 양호. 상권등급(${v}) 유지. 골목 상권 자생력 확인.`,
      "주의 ●": (v,c) => `미세혈관 등급 하락. 상권등급(${v}) 하향. 골목 위축 가속화 징후.`,
      "경보 ★": (v,c) => `미세혈관 등급 위험. 상권등급(${v}) 급락. 상권 소멸 단계 진입.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `상권 등급(M5)이 ${v} 급락했다. 미세혈관의 등급이 위험 수준이다. 등급 하락은 단순한 숫자가 아니라 그 골목에서 살아가는 사람들의 삶이 무너지고 있다는 뜻이다.`;
      if (grade === "주의 ●") return `상권 등급(M5)이 ${v} 하향되었다. 미세혈관의 등급이 떨어지고 있다. 상권 등급은 개폐업·유동인구·매출을 종합한 건강 지표로, 하락 추세가 이어지면 회복이 어렵다.`;
      return `상권 등급(M5)이 ${v}로 유지되고 있다. 미세혈관의 등급이 양호하다. 골목 상권의 종합 건강 지표가 안정적이다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 4. 부동산 X-ray — 뼈 (R1~R9)
  // ════════════════════════════════════════════════════

  R1: { // 아파트 실거래가 → 골밀도 수치
    name: "실거래가", bodyPart: "골밀도수치", axis: 4,
    "양호 ○": { metaphor: "골밀도 정상", prefix: "실거래가가 안정적이며 뼈의 밀도가 유지되고 있다." },
    "주의 ●": { metaphor: "골밀도 감소", prefix: "실거래가가 하락하며 뼈가 약해지기 시작했다." },
    "경보 ★": { metaphor: "골밀도 위험", prefix: "실거래가가 급락하며 골다공증이 진행되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `골밀도 정상. 실거래가(${v}) 안정. 부동산 자산 가치 유지.`,
      "주의 ●": (v,c) => `골밀도 감소. 실거래가(${v}) 하락. 자산 가치 침식 시작.`,
      "경보 ★": (v,c) => `골밀도 위험. 실거래가(${v}) 급락. 자산 골다공증 진행.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `아파트 실거래가(R1)가 ${v} 급락했다. 뼈의 밀도가 빠르게 빠지고 있다. 부동산은 가계 자산의 뼈대다 — 골밀도가 떨어지면 작은 충격에도 골절이 온다.`;
      if (grade === "주의 ●") return `아파트 실거래가(R1)가 ${v} 하락했다. 골밀도가 서서히 감소하고 있다. 아직 골절 수준은 아니지만, 뼈가 약해지는 추세를 주시해야 한다.`;
      return `아파트 실거래가(R1)가 ${v}로 안정적이다. 골밀도가 정상 범위를 유지하고 있다. 부동산 자산의 뼈대가 견고하다.`;
    },
  },

  R2: { // 미분양 통계 → 골절 전조
    name: "미분양", bodyPart: "골절전조", axis: 4,
    "양호 ○": { metaphor: "골절 전조 없음", prefix: "미분양이 낮은 수준이며 뼈에 균열이 없다." },
    "주의 ●": { metaphor: "미세 균열 감지", prefix: "미분양이 증가하며 뼈에 미세 균열이 생기고 있다." },
    "경보 ★": { metaphor: "골절 임박", prefix: "미분양이 급증하며 골절이 임박했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `골절 전조 없음. 미분양(${v}) 안정. 분양 시장 정상 순환.`,
      "주의 ●": (v,c) => `미세 균열 감지. 미분양(${v}) 증가. 수요 둔화 시작.`,
      "경보 ★": (v,c) => `골절 임박. 미분양(${v}) 급증. 건설사 유동성 위기 가능.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `미분양(R2)이 ${v} 급증했다. 뼈에 골절이 임박한 상태다. 팔리지 않는 아파트는 건설사의 뼈를 부러뜨리고, 그 충격은 금융권으로 전이된다.`;
      if (grade === "주의 ●") return `미분양(R2)이 ${v} 증가했다. 뼈에 미세 균열이 감지되었다. 미분양 증가는 수요 둔화의 가장 직접적인 증거다.`;
      return `미분양(R2)이 ${v}로 안정적이다. 뼈에 균열 전조가 없다. 분양 시장이 정상적으로 순환하고 있다.`;
    },
  },

  R3: { // 전세가율 → 골수 충전율
    name: "전세가율", bodyPart: "골수충전율", axis: 4,
    "양호 ○": { metaphor: "골수 충전 정상", prefix: "전세가율이 안정적이며 골수가 충분히 차 있다." },
    "주의 ●": { metaphor: "골수 충전 과잉", prefix: "전세가율이 위험 수준에 접근하며 골수 과충전 상태다." },
    "경보 ★": { metaphor: "골수 과충전 위험", prefix: "전세가율이 극단적 수준이며 역전세 골절 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `골수 충전 정상. 전세가율(${v}) 안정. 매매-전세 균형 유지.`,
      "주의 ●": (v,c) => `골수 충전 과잉. 전세가율(${v}) 상승. 갭투자 레버리지 경고.`,
      "경보 ★": (v,c) => `골수 과충전 위험. 전세가율(${v}) 극단. 역전세·깡통전세 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `전세가율(R3)이 ${v}로 극단적 수준이다. 골수가 과충전되어 터질 위험이다. 전세가율이 80%를 넘으면 집값이 조금만 떨어져도 '깡통전세'가 된다 — 뼈 안의 압력이 뼈를 부수는 것이다.`;
      if (grade === "주의 ●") return `전세가율(R3)이 ${v}로 상승 추세다. 골수가 과충전되기 시작했다. 갭투자 레버리지가 쌓이며 부동산 뼈대의 취약성이 커지고 있다.`;
      return `전세가율(R3)이 ${v}로 안정적이다. 골수 충전율이 정상 범위다. 매매가와 전세가의 균형이 유지되고 있다.`;
    },
  },

  R4: { // 경매 건수 → 골절 발생
    name: "경매건수", bodyPart: "골절발생", axis: 4,
    "양호 ○": { metaphor: "골절 미발생", prefix: "경매 건수가 낮으며 골절이 발생하지 않았다." },
    "주의 ●": { metaphor: "골절 증가", prefix: "경매 건수가 늘며 골절이 발생하기 시작했다." },
    "경보 ★": { metaphor: "다발 골절", prefix: "경매 건수가 급증하며 다발 골절 상태다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `골절 미발생. 경매(${v}) 안정. 부동산 디폴트 미미.`,
      "주의 ●": (v,c) => `골절 증가. 경매(${v}) 상승. 대출 상환 불능 확산 시작.`,
      "경보 ★": (v,c) => `다발 골절. 경매(${v}) 급증. 부동산 연쇄 디폴트 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `경매 건수(R4)가 ${v} 급증했다. 다발 골절이 발생하고 있다. 경매는 이미 부러진 뼈다 — 더 이상 버틸 수 없어 법원에 넘겨진 것이다. 한 곳의 골절이 인접 뼈에 충격을 전달한다.`;
      if (grade === "주의 ●") return `경매 건수(R4)가 ${v} 증가했다. 골절이 발생하기 시작했다. 경매 증가는 대출 상환 불능의 직접적 증거다.`;
      return `경매 건수(R4)가 ${v}로 안정적이다. 골절이 발생하지 않고 있다. 부동산 디폴트가 관리 가능한 수준이다.`;
    },
  },

  R5: { // 건물 높이 변화 (SAR) → X-ray 공정률
    name: "SAR높이", bodyPart: "X-ray공정률", axis: 4,
    "양호 ○": { metaphor: "X-ray 공정률 일치", prefix: "SAR 측정 건물 높이가 공식 공정률과 일치한다." },
    "주의 ●": { metaphor: "X-ray 공정률 괴리", prefix: "SAR 높이 변화와 공식 공정률 사이에 괴리가 감지되었다." },
    "경보 ★": { metaphor: "X-ray 공정률 허위", prefix: "SAR가 보여주는 현실과 공식 공정률이 완전히 다르다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `X-ray 공정률 일치. SAR 높이(${v}) 정상. 건설 진행 확인.`,
      "주의 ●": (v,c) => `X-ray 공정률 괴리. SAR 높이(${v}) 불일치. 공정률 과대보고 의심.`,
      "경보 ★": (v,c) => `X-ray 공정률 허위. SAR 높이(${v}) 정지. 공사 중단 은폐 경보.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `SAR 건물 높이(R5)가 ${v}로 변화가 없다. 공식 공정률은 진행 중이라 보고했지만, 위성 X-ray는 공사가 멈춰있다고 말한다. 서류는 조작할 수 있지만 위성은 거짓말을 못 한다.`;
      if (grade === "주의 ●") return `SAR 건물 높이(R5)가 ${v}로 공식 공정률과 괴리가 있다. X-ray 판독 결과 공정률이 과대 보고되었을 가능성이 있다.`;
      return `SAR 건물 높이(R5)가 ${v}로 공식 공정률과 일치한다. X-ray 상 건설이 정상적으로 진행 중이다.`;
    },
  },

  R6: { // 야간광량 (신축단지) → X-ray 실입주
    name: "신축야간광", bodyPart: "X-ray실입주", axis: 4,
    "양호 ○": { metaphor: "실입주 확인", prefix: "신축단지 야간광량이 정상이며 실제 입주가 확인된다." },
    "주의 ●": { metaphor: "실입주 의심", prefix: "신축단지 야간광량이 낮으며 빈집 가능성이 있다." },
    "경보 ★": { metaphor: "유령단지 감지", prefix: "신축단지에 불이 켜지지 않는다. 유령단지 의심." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `실입주 확인. 야간광(${v}) 정상. 신축 단지 생활 확인.`,
      "주의 ●": (v,c) => `실입주 의심. 야간광(${v}) 저조. 공실률 상승 의심.`,
      "경보 ★": (v,c) => `유령단지 감지. 야간광(${v}) 극저. 입주율 보고와 괴리.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `신축단지 야간광량(R6)이 ${v}로 거의 감지되지 않는다. 위성이 촬영한 밤의 단지는 어둡다. 입주율 90%라는 보고와 달리 사람이 살지 않는다 — 유령단지다.`;
      if (grade === "주의 ●") return `신축단지 야간광량(R6)이 ${v}로 예상보다 낮다. 공실이 상당수 존재할 가능성이 있다. 야간광은 사람의 존재를 증명하는 가장 정직한 위성 지표다.`;
      return `신축단지 야간광량(R6)이 ${v}로 정상이다. 위성이 확인하는 실입주 신호가 정상 범위다.`;
    },
  },

  R7: { // 주차장 점유율 → X-ray 생활흔적
    name: "주차점유", bodyPart: "X-ray생활흔적", axis: 4,
    "양호 ○": { metaphor: "생활흔적 확인", prefix: "주차장 점유율이 정상이며 실제 거주가 확인된다." },
    "주의 ●": { metaphor: "생활흔적 희미", prefix: "주차장 점유율이 낮으며 거주 실태가 의심된다." },
    "경보 ★": { metaphor: "생활흔적 소멸", prefix: "주차장이 텅 비어있다. 거주 실태와 보고가 불일치한다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `생활흔적 확인. 주차점유(${v}) 정상. 실거주 확인.`,
      "주의 ●": (v,c) => `생활흔적 희미. 주차점유(${v}) 저조. 공실 의심.`,
      "경보 ★": (v,c) => `생활흔적 소멸. 주차점유(${v}) 극저. 유령단지 2차 확인.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `주차장 점유율(R7)이 ${v}로 텅 비어있다. 위성이 내려다본 주차장에 차가 없다. 야간광(R6)과 함께 유령단지를 이중으로 확인하는 2차 X-ray다.`;
      if (grade === "주의 ●") return `주차장 점유율(R7)이 ${v}로 예상보다 낮다. 생활흔적이 희미하다. 공식 입주율과 실제 거주 사이에 간극이 있을 수 있다.`;
      return `주차장 점유율(R7)이 ${v}로 정상이다. 위성으로 확인한 생활흔적이 뚜렷하다.`;
    },
  },

  R8: { // 건물 표면온도 → X-ray 체온
    name: "표면온도", bodyPart: "X-ray체온", axis: 4,
    "양호 ○": { metaphor: "건물 체온 정상", prefix: "건물 표면온도가 정상이며 난방·사용이 확인된다." },
    "주의 ●": { metaphor: "건물 체온 저하", prefix: "건물 표면온도가 낮으며 사용률이 의심된다." },
    "경보 ★": { metaphor: "건물 체온 소실", prefix: "건물이 차갑다. 난방이 되지 않는 빈 건물이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `건물 체온 정상. 표면온도(${v}) 안정. 사용·거주 확인.`,
      "주의 ●": (v,c) => `건물 체온 저하. 표면온도(${v}) 낮음. 공실 확대 의심.`,
      "경보 ★": (v,c) => `건물 체온 소실. 표면온도(${v}) 극저. 빈 건물 3차 확인.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `건물 표면온도(R8)가 ${v}로 주변 건물 대비 현저히 낮다. 열적외선 위성이 측정한 건물의 체온이 사라졌다. 야간광(R6)·주차(R7)·체온(R8) 세 가지 X-ray가 모두 같은 진단을 내린다.`;
      if (grade === "주의 ●") return `건물 표면온도(R8)가 ${v}로 다소 낮다. 건물의 체온이 저하되고 있다. 난방 사용이 줄었다는 뜻이다.`;
      return `건물 표면온도(R8)가 ${v}로 정상이다. 건물의 체온이 유지되고 있다. 난방·사용이 확인된다.`;
    },
  },

  R9: { // 괴리 경보 → X-ray 판독 종합
    name: "괴리경보", bodyPart: "X-ray판독종합", axis: 4,
    "양호 ○": { metaphor: "X-ray 판독 일치", prefix: "공식 통계와 위성 신호가 일치한다. 조작 징후 없음." },
    "주의 ●": { metaphor: "X-ray 판독 괴리", prefix: "공식 통계와 위성 신호 사이에 괴리가 감지되었다." },
    "경보 ★": { metaphor: "X-ray 판독 경보", prefix: "공식 통계가 위성 현실과 정반대다. 조작 또는 구조문제." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `X-ray 판독 일치. 괴리경보(${v}) 미발동. 부동산 데이터 신뢰 가능.`,
      "주의 ●": (v,c) => `X-ray 판독 괴리. 괴리경보(${v}) 감지. 통계 교차검증 필요.`,
      "경보 ★": (v,c) => `X-ray 판독 경보. 괴리경보(${v}) 발동. 2개월 이상 지속 괴리 — 구조문제.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `괴리 경보(R9)가 ${v}로 발동되었다. 공식 통계와 위성 X-ray가 2개월 이상 반대 방향을 가리키고 있다. 단발 괴리는 노이즈이지만, 지속 괴리는 조작이거나 구조적 문제다.`;
      if (grade === "주의 ●") return `괴리 경보(R9)가 ${v}로 감지 상태다. 일부 지표에서 공식 통계와 위성 신호가 어긋나고 있다. 아직 경보 수준은 아니지만 교차검증이 필요하다.`;
      return `괴리 경보(R9)가 ${v}로 미발동이다. X-ray 판독 결과 공식 통계와 위성 신호가 일치한다. 서류와 현실이 같은 방향이다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 5. 고용/가계 — 근육/신경 (L1~L5)
  // ════════════════════════════════════════════════════

  L1: { // 고용동향 → 근력
    name: "고용동향", bodyPart: "근력", axis: 5,
    "양호 ○": { metaphor: "근력 정상", prefix: "고용이 안정적이며 경제의 근력이 유지되고 있다." },
    "주의 ●": { metaphor: "근력 저하", prefix: "고용이 둔화되며 경제의 근력이 약해지고 있다." },
    "경보 ★": { metaphor: "근력 상실", prefix: "고용이 급격히 악화되며 경제의 근력이 빠지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근력 정상. 고용(${v}) 안정. 노동시장 순환 유지.`,
      "주의 ●": (v,c) => `근력 저하. 고용(${v}) 둔화. 일자리 창출 감소.`,
      "경보 ★": (v,c) => `근력 상실. 고용(${v}) 급감. 대량 실업 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `고용동향(L1)이 ${v} 급감했다. 경제의 근력이 빠지고 있다. 일자리는 경제의 근육이다 — 근육이 사라지면 몸을 지탱할 수 없다. 소비와 세수가 동시에 무너진다.`;
      if (grade === "주의 ●") return `고용동향(L1)이 ${v} 둔화했다. 경제의 근력이 약해지고 있다. 신규 채용이 줄고 계약직 전환이 늘어나는 것은 근육이 지방으로 바뀌는 것과 같다.`;
      return `고용동향(L1)이 ${v}로 안정적이다. 경제의 근력이 유지되고 있다. 노동시장이 정상적으로 순환하고 있다.`;
    },
  },

  L2: { // 실업급여 신청 → 통증 신호
    name: "실업급여", bodyPart: "통증신호", axis: 5,
    "양호 ○": { metaphor: "통증 없음", prefix: "실업급여 신청이 정상 수준이며 통증 신호가 없다." },
    "주의 ●": { metaphor: "통증 감지", prefix: "실업급여 신청이 증가하며 통증이 느껴지기 시작했다." },
    "경보 ★": { metaphor: "극심한 통증", prefix: "실업급여 신청이 급증하며 극심한 통증이 발생했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `통증 없음. 실업급여(${v}) 안정. 고용 안전망 정상 작동.`,
      "주의 ●": (v,c) => `통증 감지. 실업급여(${v}) 증가. 구조조정 확산 시작.`,
      "경보 ★": (v,c) => `극심한 통증. 실업급여(${v}) 급증. 대규모 해고 진행 중.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `실업급여 신청(L2)이 ${v} 급증했다. 극심한 통증 신호다. 실업급여는 이미 잘린 근육의 통증이다 — 통증이 있다는 건 이미 손상이 발생했다는 뜻이다.`;
      if (grade === "주의 ●") return `실업급여 신청(L2)이 ${v} 증가했다. 통증이 감지되기 시작했다. 고용 시장의 신경이 통증 신호를 보내고 있다.`;
      return `실업급여 신청(L2)이 ${v}로 안정적이다. 통증 신호가 없다. 고용 안전망이 정상 작동 중이다.`;
    },
  },

  L3: { // 가계부채 → 근육 부하
    name: "가계부채", bodyPart: "근육부하", axis: 5,
    "양호 ○": { metaphor: "근육 부하 정상", prefix: "가계부채가 관리 가능한 수준이며 근육이 감당하고 있다." },
    "주의 ●": { metaphor: "근육 과부하", prefix: "가계부채가 증가하며 근육에 과부하가 걸리고 있다." },
    "경보 ★": { metaphor: "근육 파열 위험", prefix: "가계부채가 감당 불가 수준이며 근육 파열이 임박했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근육 부하 정상. 가계부채(${v}) 관리 가능. DSR 안정.`,
      "주의 ●": (v,c) => `근육 과부하. 가계부채(${v}) 증가. 상환 부담 확대.`,
      "경보 ★": (v,c) => `근육 파열 위험. 가계부채(${v}) 한계. 가계 디폴트 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `가계부채(L3)가 ${v}로 한계 수준이다. 근육이 파열될 위험에 처해 있다. 소득은 줄고 빚은 늘어난다 — 근육이 감당할 수 없는 무게를 들고 있다.`;
      if (grade === "주의 ●") return `가계부채(L3)가 ${v}로 증가했다. 근육에 과부하가 걸리고 있다. 이자 부담이 소비 여력을 잠식하고 있다.`;
      return `가계부채(L3)가 ${v}로 관리 가능한 수준이다. 근육 부하가 정상 범위다. 가계의 상환 능력이 유지되고 있다.`;
    },
  },

  L4: { // 연체율 → 신경 손상
    name: "연체율", bodyPart: "신경손상", axis: 5,
    "양호 ○": { metaphor: "신경 정상", prefix: "연체율이 낮으며 신경 전달이 정상이다." },
    "주의 ●": { metaphor: "신경 이상", prefix: "연체율이 상승하며 신경에 이상 신호가 감지된다." },
    "경보 ★": { metaphor: "신경 마비", prefix: "연체율이 급등하며 신경이 마비되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `신경 정상. 연체율(${v}) 안정. 금융 신경 전달 원활.`,
      "주의 ●": (v,c) => `신경 이상. 연체율(${v}) 상승. 가계 상환 능력 약화.`,
      "경보 ★": (v,c) => `신경 마비. 연체율(${v}) 급등. 연쇄 디폴트 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `연체율(L4)이 ${v} 급등했다. 신경이 마비되고 있다. 연체는 근육(가계)이 보내는 마지막 SOS다 — 더 이상 갚을 수 없다는 신경 신호가 금융 시스템 전체로 전파된다.`;
      if (grade === "주의 ●") return `연체율(L4)이 ${v} 상승했다. 신경에 이상 신호가 감지된다. 가계의 상환 능력이 약화되기 시작했다.`;
      return `연체율(L4)이 ${v}로 안정적이다. 신경이 정상 작동 중이다. 가계의 금융 건강이 유지되고 있다.`;
    },
  },

  L5: { // 체감경기 CSI → 통증 자각
    name: "체감경기", bodyPart: "통증자각", axis: 5,
    "양호 ○": { metaphor: "통증 자각 없음", prefix: "체감경기가 양호하며 국민이 통증을 느끼지 않는다." },
    "주의 ●": { metaphor: "통증 자각 시작", prefix: "체감경기가 악화되며 국민이 통증을 느끼기 시작했다." },
    "경보 ★": { metaphor: "극심한 통증 자각", prefix: "체감경기가 급락하며 국민이 극심한 통증을 호소한다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `통증 자각 없음. CSI(${v}) 안정. 국민 체감경기 양호.`,
      "주의 ●": (v,c) => `통증 자각 시작. CSI(${v}) 하락. 체감 불황 진입.`,
      "경보 ★": (v,c) => `극심한 통증 자각. CSI(${v}) 급락. 국민 생활고 심화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `체감경기 CSI(L5)가 ${v} 급락했다. 극심한 통증을 자각하고 있다. 통계가 정상이라 해도 국민이 아프다고 말하면 아픈 것이다 — CSI는 경제의 통증 자가진단이다.`;
      if (grade === "주의 ●") return `체감경기 CSI(L5)가 ${v} 하락했다. 통증을 자각하기 시작했다. 거시 지표와 체감 사이의 괴리가 벌어지고 있다.`;
      return `체감경기 CSI(L5)가 ${v}로 안정적이다. 통증 자각이 없다. 국민의 경기 체감이 양호하다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 6. 지역균형 — 좌우대칭 (G1~G7)
  // ════════════════════════════════════════════════════

  G1: { // 지방소멸지수 → 편마비 등급
    name: "소멸지수", bodyPart: "편마비등급", axis: 6,
    "양호 ○": { metaphor: "편마비 없음", prefix: "지방소멸 위험이 낮으며 좌우 균형이 유지되고 있다." },
    "주의 ●": { metaphor: "편마비 초기", prefix: "일부 지역의 소멸 위험이 높아지며 편마비가 시작되고 있다." },
    "경보 ★": { metaphor: "편마비 진행", prefix: "다수 지역이 소멸 위험에 처하며 편마비가 진행 중이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `편마비 없음. 소멸지수(${v}) 안정. 지역 균형 유지.`,
      "주의 ●": (v,c) => `편마비 초기. 소멸지수(${v}) 상승. 취약 지역 증가.`,
      "경보 ★": (v,c) => `편마비 진행. 소멸지수(${v}) 급등. 다수 지역 소멸 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `지방소멸지수(G1)가 ${v}로 위험 수준이다. 편마비가 진행되고 있다. 한쪽 팔다리가 마비되면 걸을 수 없듯, 지방이 소멸하면 국가 경제가 한쪽으로 기울어진다.`;
      if (grade === "주의 ●") return `지방소멸지수(G1)가 ${v}로 주의가 필요하다. 편마비의 초기 증상이 나타나고 있다. 소멸위험 지역이 늘어나고 있다.`;
      return `지방소멸지수(G1)가 ${v}로 안정적이다. 편마비 증상이 없다. 지역 간 균형이 유지되고 있다.`;
    },
  },

  G2: { // 지역별 GRDP → 좌우 근력차
    name: "지역GRDP", bodyPart: "좌우근력차", axis: 6,
    "양호 ○": { metaphor: "좌우 근력 균형", prefix: "지역별 GRDP 격차가 안정적이며 좌우 근력이 균형을 이룬다." },
    "주의 ●": { metaphor: "좌우 근력 불균형", prefix: "수도권-비수도권 GRDP 격차가 벌어지며 근력 불균형이 심화되고 있다." },
    "경보 ★": { metaphor: "좌우 근력 마비", prefix: "지역 GRDP 격차가 극단적이며 한쪽 근력이 마비 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `좌우 근력 균형. GRDP 격차(${v}) 안정. 균형 발전 유지.`,
      "주의 ●": (v,c) => `좌우 근력 불균형. GRDP 격차(${v}) 확대. 수도권 쏠림 심화.`,
      "경보 ★": (v,c) => `좌우 근력 마비. GRDP 격차(${v}) 극단. 지역 경제 마비.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `지역별 GRDP 격차(G2)가 ${v}로 극단적이다. 한쪽 팔의 근력이 마비되었다. 수도권에 경제력이 집중되면 나머지 지역은 근위축이 온다.`;
      if (grade === "주의 ●") return `지역별 GRDP 격차(G2)가 ${v}로 확대되고 있다. 좌우 근력 불균형이 심화되고 있다. 수도권 집중이 가속되고 있다.`;
      return `지역별 GRDP 격차(G2)가 ${v}로 안정적이다. 좌우 근력이 균형을 이루고 있다.`;
    },
  },

  G3: { // 지역별 인구이동 → 혈류 편중
    name: "인구이동", bodyPart: "혈류편중", axis: 6,
    "양호 ○": { metaphor: "혈류 분배 균형", prefix: "인구 이동이 안정적이며 혈류가 고르게 분배되고 있다." },
    "주의 ●": { metaphor: "혈류 편중 시작", prefix: "수도권으로 인구가 유입되며 혈류가 한쪽으로 쏠리고 있다." },
    "경보 ★": { metaphor: "혈류 편중 극심", prefix: "지방 인구가 급감하며 혈류가 한쪽에만 몰리고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈류 분배 균형. 인구이동(${v}) 안정. 지역 간 이동 균형.`,
      "주의 ●": (v,c) => `혈류 편중 시작. 인구이동(${v}) 수도권 순유입 증가.`,
      "경보 ★": (v,c) => `혈류 편중 극심. 인구이동(${v}) 지방 인구 급감.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `인구이동(G3)이 ${v}로 지방 인구가 급감하고 있다. 혈류가 한쪽에만 극단적으로 몰리고 있다. 한쪽 팔에만 피가 몰리면 다른 팔은 괴사한다.`;
      if (grade === "주의 ●") return `인구이동(G3)이 ${v}로 수도권 순유입이 증가하고 있다. 혈류가 한쪽으로 쏠리기 시작했다.`;
      return `인구이동(G3)이 ${v}로 안정적이다. 혈류 분배가 균형을 이루고 있다.`;
    },
  },

  G4: { // 지역별 창폐업 → 좌우 세포활력
    name: "지역창폐업", bodyPart: "좌우세포활력", axis: 6,
    "양호 ○": { metaphor: "좌우 세포 활력 균형", prefix: "지역별 창폐업이 균형적이며 양쪽 세포가 모두 활발하다." },
    "주의 ●": { metaphor: "좌우 세포 활력 차이", prefix: "지방의 폐업이 증가하며 한쪽 세포 활력이 떨어지고 있다." },
    "경보 ★": { metaphor: "한쪽 세포 괴사", prefix: "지방의 폐업이 급증하며 한쪽 세포가 죽어가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `좌우 세포 활력 균형. 지역 창폐업(${v}) 균형. 전국 상권 건강.`,
      "주의 ●": (v,c) => `좌우 세포 활력 차이. 지역 창폐업(${v}) 격차 확대.`,
      "경보 ★": (v,c) => `한쪽 세포 괴사. 지역 창폐업(${v}) 지방 폐업 급증.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `지역별 창폐업(G4)이 ${v}로 지방 폐업이 급증하고 있다. 한쪽 세포가 괴사하고 있다. 지방의 가게가 문을 닫는 것은 세포가 죽는 것이다.`;
      if (grade === "주의 ●") return `지역별 창폐업(G4)이 ${v}로 격차가 벌어지고 있다. 한쪽 세포의 활력이 떨어지고 있다.`;
      return `지역별 창폐업(G4)이 ${v}로 균형적이다. 좌우 세포 활력이 균등하다.`;
    },
  },

  G5: { // 지방재정자립도 → 좌우 자율신경
    name: "재정자립", bodyPart: "좌우자율신경", axis: 6,
    "양호 ○": { metaphor: "자율신경 정상", prefix: "지방재정이 자립적이며 자율신경이 작동하고 있다." },
    "주의 ●": { metaphor: "자율신경 약화", prefix: "지방재정 의존도가 높아지며 자율신경이 약해지고 있다." },
    "경보 ★": { metaphor: "자율신경 마비", prefix: "지방재정이 중앙에 완전 의존하며 자율신경이 마비되었다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `자율신경 정상. 재정자립(${v}) 양호. 지방 자체 운영 가능.`,
      "주의 ●": (v,c) => `자율신경 약화. 재정자립(${v}) 하락. 중앙 의존도 상승.`,
      "경보 ★": (v,c) => `자율신경 마비. 재정자립(${v}) 극저. 중앙 완전 의존.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `지방재정자립도(G5)가 ${v}로 극저 수준이다. 자율신경이 마비되었다. 스스로 심장을 뛰게 할 수 없는 상태다 — 중앙정부의 수액 없이는 지방 경제가 작동하지 않는다.`;
      if (grade === "주의 ●") return `지방재정자립도(G5)가 ${v}로 하락하고 있다. 자율신경이 약해지고 있다. 중앙 의존도가 높아지면 지방의 자기 결정력이 사라진다.`;
      return `지방재정자립도(G5)가 ${v}로 양호하다. 자율신경이 정상 작동 중이다. 지방 자체 운영이 가능하다.`;
    },
  },

  G6: { // 지역별 야간광량 → 좌우 활력 위성
    name: "지역야간광", bodyPart: "좌우활력위성", axis: 6,
    "양호 ○": { metaphor: "좌우 활력 균형", prefix: "전국 야간광량이 고르며 좌우 활력이 균형적이다." },
    "주의 ●": { metaphor: "좌우 활력 격차", prefix: "지방 야간광량이 감소하며 활력 격차가 벌어지고 있다." },
    "경보 ★": { metaphor: "한쪽 활력 소실", prefix: "지방이 어두워지고 있다. 위성이 보여주는 편마비의 증거." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `좌우 활력 균형. 지역야간광(${v}) 고른 분포. 전국 활력 확인.`,
      "주의 ●": (v,c) => `좌우 활력 격차. 지역야간광(${v}) 지방 감소. 활력 편중.`,
      "경보 ★": (v,c) => `한쪽 활력 소실. 지역야간광(${v}) 지방 급감. 위성 편마비 확인.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `지역별 야간광량(G6)이 ${v}로 지방이 어두워지고 있다. 위성이 찍은 한반도의 밤에서 지방의 불빛이 사라지고 있다. 이것이 편마비의 위성 증거다.`;
      if (grade === "주의 ●") return `지역별 야간광량(G6)이 ${v}로 격차가 벌어지고 있다. 좌우 활력의 차이가 위성으로 관측된다.`;
      return `지역별 야간광량(G6)이 ${v}로 고르게 분포되어 있다. 좌우 활력이 균형적이다.`;
    },
  },

  G7: { // 특구별 투자유치 → 재활치료
    name: "특구투자", bodyPart: "재활치료", axis: 6,
    "양호 ○": { metaphor: "재활 치료 진행", prefix: "특구 투자유치가 활발하며 편마비 재활이 진행되고 있다." },
    "주의 ●": { metaphor: "재활 치료 부진", prefix: "특구 투자유치가 부진하며 재활이 정체되고 있다." },
    "경보 ★": { metaphor: "재활 치료 실패", prefix: "특구 투자유치가 거의 없으며 재활이 실패하고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `재활 치료 진행. 특구투자(${v}) 활발. 지방 회복 동력 확보.`,
      "주의 ●": (v,c) => `재활 치료 부진. 특구투자(${v}) 부진. 지방 회복 정체.`,
      "경보 ★": (v,c) => `재활 치료 실패. 특구투자(${v}) 미미. 지방 재활 포기 상태.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `특구 투자유치(G7)가 ${v}로 거의 없다. 재활 치료가 실패하고 있다. 편마비를 치료하려면 약해진 쪽에 집중 투자해야 하는데, 그 치료 자체가 작동하지 않고 있다.`;
      if (grade === "주의 ●") return `특구 투자유치(G7)가 ${v}로 부진하다. 재활 치료가 정체되고 있다. 지방에 새로운 혈류를 공급하는 통로가 막히고 있다.`;
      return `특구 투자유치(G7)가 ${v}로 활발하다. 재활 치료가 진행 중이다. 편마비 회복의 동력이 확보되고 있다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 7. 금융 스트레스 — 혈액의 질 (F1~F5)
  // ════════════════════════════════════════════════════

  F1: { // 회사채 스프레드 → 혈액 점도
    name: "회사채스프레드", bodyPart: "혈액점도", axis: 7,
    "양호 ○": { metaphor: "혈액 점도 정상", prefix: "회사채 스프레드가 안정적이며 혈액이 맑다." },
    "주의 ●": { metaphor: "혈액 점도 상승", prefix: "회사채 스프레드가 확대되며 혈액이 끈적해지고 있다." },
    "경보 ★": { metaphor: "혈전 위험", prefix: "회사채 스프레드가 급등하며 혈전이 형성될 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈액 점도 정상. 스프레드(${v}) 안정. 기업 자금조달 원활.`,
      "주의 ●": (v,c) => `혈액 점도 상승. 스프레드(${v}) 확대. 기업 자금조달 비용 증가.`,
      "경보 ★": (v,c) => `혈전 위험. 스프레드(${v}) 급등. 기업 자금경색 임박.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `회사채 스프레드(F1)가 ${v} 급등했다. 혈액에 혈전이 형성될 위험이다. AA등급과 BBB등급의 금리 차이가 벌어진다는 것은 시장이 신용위험을 급격히 재평가하고 있다는 뜻이다 — 피가 굳기 시작한 것이다.`;
      if (grade === "주의 ●") return `회사채 스프레드(F1)가 ${v} 확대되었다. 혈액의 점도가 올라가고 있다. 기업들의 자금조달 비용이 늘어나고 있다.`;
      return `회사채 스프레드(F1)가 ${v}로 안정적이다. 혈액의 점도가 정상이다. 기업 자금시장이 원활하게 순환하고 있다.`;
    },
  },

  F2: { // CP 금리 → 혈중 독소
    name: "CP금리", bodyPart: "혈중독소", axis: 7,
    "양호 ○": { metaphor: "혈중 독소 정상", prefix: "CP 금리가 안정적이며 단기 자금시장이 깨끗하다." },
    "주의 ●": { metaphor: "혈중 독소 상승", prefix: "CP 금리가 올라가며 단기 자금시장에 독소가 쌓이고 있다." },
    "경보 ★": { metaphor: "혈중 독소 위험", prefix: "CP 금리가 급등하며 단기 자금시장이 오염되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈중 독소 정상. CP금리(${v}) 안정. 단기 유동성 충분.`,
      "주의 ●": (v,c) => `혈중 독소 상승. CP금리(${v}) 상승. 단기 자금 경색 시작.`,
      "경보 ★": (v,c) => `혈중 독소 위험. CP금리(${v}) 급등. 단기 자금시장 마비.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `CP 금리(F2)가 ${v} 급등했다. 혈중 독소가 위험 수준이다. 기업어음 금리는 기업의 '오늘 내일'을 보여준다 — 이 금리가 뛰면 내일 월급을 줄 돈이 없다는 뜻이다.`;
      if (grade === "주의 ●") return `CP 금리(F2)가 ${v} 상승했다. 혈중 독소가 쌓이고 있다. 단기 자금시장에 경색 조짐이 나타나고 있다.`;
      return `CP 금리(F2)가 ${v}로 안정적이다. 혈중 독소가 정상 수준이다. 단기 자금시장이 원활하다.`;
    },
  },

  F3: { // 은행 BIS 비율 → 혈액 면역력
    name: "BIS비율", bodyPart: "혈액면역력", axis: 7,
    "양호 ○": { metaphor: "면역력 정상", prefix: "은행 BIS 비율이 충분하며 금융 면역력이 건강하다." },
    "주의 ●": { metaphor: "면역력 저하", prefix: "은행 BIS 비율이 하락하며 금융 면역력이 약해지고 있다." },
    "경보 ★": { metaphor: "면역 결핍", prefix: "은행 BIS 비율이 위험 수준이며 금융 면역이 무너지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `면역력 정상. BIS(${v}) 충분. 은행 자본 건전성 양호.`,
      "주의 ●": (v,c) => `면역력 저하. BIS(${v}) 하락. 은행 자본 완충 감소.`,
      "경보 ★": (v,c) => `면역 결핍. BIS(${v}) 위험. 은행 시스템 리스크.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `은행 BIS 비율(F3)이 ${v}로 위험 수준이다. 금융 면역력이 결핍되었다. BIS 비율은 은행이 충격을 흡수할 수 있는 면역 체계다 — 면역이 무너지면 작은 감염도 치명적이 된다.`;
      if (grade === "주의 ●") return `은행 BIS 비율(F3)이 ${v}로 하락하고 있다. 금융 면역력이 약해지고 있다. 은행의 자본 완충이 줄어들고 있다.`;
      return `은행 BIS 비율(F3)이 ${v}로 충분하다. 금융 면역력이 건강하다. 은행 시스템이 안정적이다.`;
    },
  },

  F4: { // 코스피 변동성 → 혈압 변동
    name: "코스피변동성", bodyPart: "혈압변동", axis: 7,
    "양호 ○": { metaphor: "혈압 안정", prefix: "코스피 변동성이 낮으며 금융 혈압이 안정적이다." },
    "주의 ●": { metaphor: "혈압 불안정", prefix: "코스피 변동성이 커지며 금융 혈압이 흔들리고 있다." },
    "경보 ★": { metaphor: "혈압 급등", prefix: "코스피 변동성이 극단적이며 금융 혈압이 위험하다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈압 안정. 변동성(${v}) 정상. 시장 심리 안정.`,
      "주의 ●": (v,c) => `혈압 불안정. 변동성(${v}) 상승. 시장 불확실성 증가.`,
      "경보 ★": (v,c) => `혈압 급등. 변동성(${v}) 극단. 패닉 매도 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `코스피 변동성(F4)이 ${v}로 극단적이다. 금융 혈압이 급등했다. 시장이 공포에 빠져있다 — 혈압이 급등하면 혈관이 터질 수 있다.`;
      if (grade === "주의 ●") return `코스피 변동성(F4)이 ${v}로 상승했다. 금융 혈압이 불안정하다. 시장의 불확실성이 커지고 있다.`;
      return `코스피 변동성(F4)이 ${v}로 안정적이다. 금융 혈압이 정상이다. 시장 심리가 안정적이다.`;
    },
  },

  F5: { // 은행채 스프레드 (CDS 대안) → 혈액 응고인자
    name: "은행채스프레드", bodyPart: "혈액응고인자", axis: 7,
    "양호 ○": { metaphor: "응고인자 정상", prefix: "은행채 스프레드가 안정적이며 혈액 응고가 정상이다." },
    "주의 ●": { metaphor: "응고인자 과잉", prefix: "은행채 스프레드가 확대되며 혈액이 과도하게 응고되고 있다." },
    "경보 ★": { metaphor: "응고 위기", prefix: "은행채 스프레드가 급등하며 혈전 형성이 가속되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `응고인자 정상. 은행채스프레드(${v}) 안정. 은행간 신뢰 유지.`,
      "주의 ●": (v,c) => `응고인자 과잉. 은행채스프레드(${v}) 확대. 은행간 불신 확산.`,
      "경보 ★": (v,c) => `응고 위기. 은행채스프레드(${v}) 급등. 금융시장 경색.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `은행채 스프레드(F5)가 ${v} 급등했다. 혈액의 응고 인자가 과활성화되었다. 은행끼리 돈을 빌려주지 않으려 한다 — 금융시장의 피가 굳어가고 있다.`;
      if (grade === "주의 ●") return `은행채 스프레드(F5)가 ${v} 확대되었다. 응고 인자가 과잉 상태다. 은행 간 신뢰가 흔들리기 시작했다.`;
      return `은행채 스프레드(F5)가 ${v}로 안정적이다. 응고 인자가 정상이다. 은행 간 자금 거래가 원활하다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 8. 에너지/자원 — 산소 공급원 (E1~E5)
  // ════════════════════════════════════════════════════

  E1: { // 유가 → 산소 가격
    name: "유가", bodyPart: "산소가격", axis: 8,
    "양호 ○": { metaphor: "산소 가격 안정", prefix: "유가가 안정적이며 에너지 비용이 관리 가능하다." },
    "주의 ●": { metaphor: "산소 가격 상승", prefix: "유가가 올라가며 경제의 호흡 비용이 증가하고 있다." },
    "경보 ★": { metaphor: "산소 가격 폭등", prefix: "유가가 급등하며 산소를 사기 어려운 상태다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `산소 가격 안정. 유가(${v}) 안정. 에너지 비용 관리 가능.`,
      "주의 ●": (v,c) => `산소 가격 상승. 유가(${v}) 상승. 물가 압력 확대.`,
      "경보 ★": (v,c) => `산소 가격 폭등. 유가(${v}) 급등. 에너지 위기 진입.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `유가(E1)가 ${v} 급등했다. 산소 가격이 폭등하고 있다. 에너지는 경제가 숨 쉬는 데 필요한 산소다 — 산소가 비싸지면 모든 세포의 활동 비용이 치솟는다.`;
      if (grade === "주의 ●") return `유가(E1)가 ${v} 상승했다. 산소 가격이 올라가고 있다. 에너지 비용 상승이 물가 전반으로 전이될 수 있다.`;
      return `유가(E1)가 ${v}로 안정적이다. 산소 가격이 적정 수준이다. 에너지 비용이 경제에 부담이 되지 않는다.`;
    },
  },

  E2: { // 전력 수급 예비율 → 산소통 잔량
    name: "전력예비율", bodyPart: "산소통잔량", axis: 8,
    "양호 ○": { metaphor: "산소통 충분", prefix: "전력 예비율이 충분하며 에너지 공급이 안정적이다." },
    "주의 ●": { metaphor: "산소통 부족", prefix: "전력 예비율이 낮아지며 에너지 공급 여유가 줄고 있다." },
    "경보 ★": { metaphor: "산소통 고갈", prefix: "전력 예비율이 위험 수준이며 블랙아웃 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `산소통 충분. 예비율(${v}) 안정. 전력 공급 안정.`,
      "주의 ●": (v,c) => `산소통 부족. 예비율(${v}) 하락. 전력 수급 불안.`,
      "경보 ★": (v,c) => `산소통 고갈. 예비율(${v}) 위험. 블랙아웃 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `전력 예비율(E2)이 ${v}로 위험 수준이다. 산소통이 거의 비었다. 블랙아웃은 경제의 질식이다 — 전기가 끊기면 모든 것이 멈춘다.`;
      if (grade === "주의 ●") return `전력 예비율(E2)이 ${v}로 낮아지고 있다. 산소통의 잔량이 줄고 있다. 하절기·동절기 피크에 대비가 필요하다.`;
      return `전력 예비율(E2)이 ${v}로 충분하다. 산소통에 여유가 있다. 전력 공급이 안정적이다.`;
    },
  },

  E3: { // LNG 재고 → 연료 비축
    name: "LNG재고", bodyPart: "연료비축", axis: 8,
    "양호 ○": { metaphor: "연료 비축 충분", prefix: "LNG 재고가 충분하며 난방·발전 연료가 확보되어 있다." },
    "주의 ●": { metaphor: "연료 비축 부족", prefix: "LNG 재고가 줄며 연료 공급이 불안해지고 있다." },
    "경보 ★": { metaphor: "연료 비축 고갈", prefix: "LNG 재고가 위험 수준이며 에너지 위기가 임박했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `연료 비축 충분. LNG(${v}) 안정. 난방·발전 안정.`,
      "주의 ●": (v,c) => `연료 비축 부족. LNG(${v}) 감소. 겨울철 공급 불안.`,
      "경보 ★": (v,c) => `연료 비축 고갈. LNG(${v}) 위험. 에너지 비상.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `LNG 재고(E3)가 ${v}로 위험 수준이다. 연료가 고갈되고 있다. LNG는 한국 발전의 핵심 연료다 — 비축이 바닥나면 발전소가 멈추고, 경제의 산소 공급이 끊긴다.`;
      if (grade === "주의 ●") return `LNG 재고(E3)가 ${v}로 감소하고 있다. 연료 비축이 부족해지고 있다. 겨울철 난방 수요 급증에 대비가 필요하다.`;
      return `LNG 재고(E3)가 ${v}로 충분하다. 연료가 안정적으로 비축되어 있다.`;
    },
  },

  E4: { // 산업용 전력사용량 → 산소 소비량
    name: "산업전력", bodyPart: "산소소비량", axis: 8,
    "양호 ○": { metaphor: "산소 소비 정상", prefix: "산업용 전력사용이 안정적이며 공급 여력 내에 있다." },
    "주의 ●": { metaphor: "산소 소비 과다", prefix: "산업용 전력사용이 급증하며 공급 여력을 압박하고 있다." },
    "경보 ★": { metaphor: "산소 소비 한계", prefix: "산업용 전력사용이 공급 한계에 도달했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `산소 소비 정상. 산업전력(${v}) 안정. 공급 여력 충분.`,
      "주의 ●": (v,c) => `산소 소비 과다. 산업전력(${v}) 급증. 예비율 압박.`,
      "경보 ★": (v,c) => `산소 소비 한계. 산업전력(${v}) 한계. 순환제한 필요.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `산업용 전력(E4)이 ${v}로 공급 한계에 도달했다. 경제가 소비하는 산소가 공급 능력을 초과하고 있다. 전력 예비율(E2)과 교차하면 블랙아웃 위험이 현실화된다.`;
      if (grade === "주의 ●") return `산업용 전력(E4)이 ${v}로 급증하고 있다. 산소 소비가 과다하다. 공급 예비율을 압박하고 있다.`;
      return `산업용 전력(E4)이 ${v}로 안정적이다. 산소 소비가 공급 여력 내에 있다.`;
    },
  },

  E5: { // 원자재 가격지수 → 영양소 가격
    name: "원자재지수", bodyPart: "영양소가격", axis: 8,
    "양호 ○": { metaphor: "영양소 가격 안정", prefix: "원자재 가격이 안정적이며 생산 비용이 관리 가능하다." },
    "주의 ●": { metaphor: "영양소 가격 상승", prefix: "원자재 가격이 올라가며 생산 비용이 증가하고 있다." },
    "경보 ★": { metaphor: "영양소 가격 폭등", prefix: "원자재 가격이 급등하며 비용 인플레이션이 확산되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `영양소 가격 안정. 원자재(${v}) 안정. 생산비용 관리 가능.`,
      "주의 ●": (v,c) => `영양소 가격 상승. 원자재(${v}) 상승. 비용 압력 확대.`,
      "경보 ★": (v,c) => `영양소 가격 폭등. 원자재(${v}) 급등. 비용 인플레 확산.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `원자재 가격지수(E5)가 ${v} 급등했다. 영양소 가격이 폭등하고 있다. 원자재는 경제 세포가 성장하는 데 필요한 영양소다 — 가격이 치솟으면 세포 분열(생산)이 멈춘다.`;
      if (grade === "주의 ●") return `원자재 가격지수(E5)가 ${v} 상승했다. 영양소 가격이 올라가고 있다. 생산 비용 상승이 기업 마진을 압박하고 있다.`;
      return `원자재 가격지수(E5)가 ${v}로 안정적이다. 영양소 가격이 적정하다. 생산 비용이 관리 가능한 수준이다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 9. 인구/노화 — 신체 나이 (A1~A5)
  // ════════════════════════════════════════════════════

  A1: { // 합계출산율 → 세포 재생률
    name: "출산율", bodyPart: "세포재생률", axis: 9,
    "양호 ○": { metaphor: "세포 재생 정상", prefix: "출산율이 안정적이며 경제의 세포가 재생되고 있다." },
    "주의 ●": { metaphor: "세포 재생 둔화", prefix: "출산율이 하락하며 경제의 세포 재생이 느려지고 있다." },
    "경보 ★": { metaphor: "세포 재생 정지", prefix: "출산율이 초저수준이며 경제의 세포 재생이 멈추고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `세포 재생 정상. 출산율(${v}) 안정. 인구 재생산 유지.`,
      "주의 ●": (v,c) => `세포 재생 둔화. 출산율(${v}) 하락. 인구 감소 가속.`,
      "경보 ★": (v,c) => `세포 재생 정지. 출산율(${v}) 초저. 인구 소멸 경로 진입.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `합계출산율(A1)이 ${v}로 세계 최저 수준이다. 세포 재생이 사실상 정지했다. 새로운 세포가 만들어지지 않으면 신체는 늙어갈 뿐이다 — 한국 경제의 생물학적 시계가 멈추고 있다.`;
      if (grade === "주의 ●") return `합계출산율(A1)이 ${v}로 하락하고 있다. 세포 재생이 둔화되고 있다. 대체출산율 2.1명에 한참 미달이다.`;
      return `합계출산율(A1)이 ${v}로 안정적이다. 세포 재생이 정상 범위다.`;
    },
  },

  A2: { // 고령화율 → 신체 나이
    name: "고령화율", bodyPart: "신체나이", axis: 9,
    "양호 ○": { metaphor: "신체 나이 적정", prefix: "고령화율이 관리 가능하며 경제의 신체 나이가 적정하다." },
    "주의 ●": { metaphor: "신체 노화 진행", prefix: "고령화가 가속되며 경제의 신체가 늙어가고 있다." },
    "경보 ★": { metaphor: "초고령 신체", prefix: "초고령사회에 진입하며 경제 신체의 노화가 심각하다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `신체 나이 적정. 고령화율(${v}) 관리 가능.`,
      "주의 ●": (v,c) => `신체 노화 진행. 고령화율(${v}) 가속. 복지비용 증가.`,
      "경보 ★": (v,c) => `초고령 신체. 고령화율(${v}) 심각. 경제 활력 급감.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `고령화율(A2)이 ${v}로 초고령사회다. 경제의 신체 나이가 심각하게 늙었다. 20%를 넘는 고령화율은 경제 신체가 노인의 몸이 되었다는 뜻이다 — 복지비용은 늘고 세수는 줄어든다.`;
      if (grade === "주의 ●") return `고령화율(A2)이 ${v}로 가속되고 있다. 경제의 신체 나이가 올라가고 있다. 생산가능인구 대비 부양비가 증가하고 있다.`;
      return `고령화율(A2)이 ${v}로 관리 가능한 수준이다. 경제의 신체 나이가 적정하다.`;
    },
  },

  A3: { // 생산가능인구 → 근육 세포 수
    name: "생산인구", bodyPart: "근육세포수", axis: 9,
    "양호 ○": { metaphor: "근육 세포 충분", prefix: "생산가능인구가 안정적이며 경제의 근육이 유지되고 있다." },
    "주의 ●": { metaphor: "근육 세포 감소", prefix: "생산가능인구가 줄며 경제의 근육이 위축되고 있다." },
    "경보 ★": { metaphor: "근육 세포 급감", prefix: "생산가능인구가 급감하며 경제의 근육이 빠르게 사라지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근육 세포 충분. 생산인구(${v}) 안정. 노동력 유지.`,
      "주의 ●": (v,c) => `근육 세포 감소. 생산인구(${v}) 하락. 노동력 부족 시작.`,
      "경보 ★": (v,c) => `근육 세포 급감. 생산인구(${v}) 급감. 경제 활동 위축.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `생산가능인구(A3)가 ${v} 급감하고 있다. 근육 세포가 빠르게 사라지고 있다. 일할 수 있는 사람이 줄어든다는 것은 경제의 근육이 소멸하는 것이다.`;
      if (grade === "주의 ●") return `생산가능인구(A3)가 ${v} 감소하고 있다. 근육 세포가 줄고 있다. 노동력 부족이 성장의 제약이 되기 시작했다.`;
      return `생산가능인구(A3)가 ${v}로 안정적이다. 근육 세포가 충분하다. 노동력이 유지되고 있다.`;
    },
  },

  A4: { // 학령인구 → 줄기세포
    name: "학령인구", bodyPart: "줄기세포", axis: 9,
    "양호 ○": { metaphor: "줄기세포 충분", prefix: "학령인구가 안정적이며 미래의 줄기세포가 확보되어 있다." },
    "주의 ●": { metaphor: "줄기세포 감소", prefix: "학령인구가 줄며 미래 인재풀이 축소되고 있다." },
    "경보 ★": { metaphor: "줄기세포 고갈", prefix: "학령인구가 급감하며 미래 인재의 씨앗이 사라지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `줄기세포 충분. 학령인구(${v}) 안정. 미래 인재 확보.`,
      "주의 ●": (v,c) => `줄기세포 감소. 학령인구(${v}) 하락. 학교 통폐합 가속.`,
      "경보 ★": (v,c) => `줄기세포 고갈. 학령인구(${v}) 급감. 교육 인프라 붕괴.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `학령인구(A4)가 ${v} 급감하고 있다. 줄기세포가 고갈되고 있다. 줄기세포는 미래의 모든 세포가 될 수 있는 가능성이다 — 학생이 사라지면 산업·군사·사회 모든 영역의 미래가 사라진다.`;
      if (grade === "주의 ●") return `학령인구(A4)가 ${v} 감소하고 있다. 줄기세포가 줄고 있다. 학교 통폐합이 가속되며 지역 소멸과 연동된다.`;
      return `학령인구(A4)가 ${v}로 안정적이다. 줄기세포가 충분히 확보되어 있다.`;
    },
  },

  A5: { // 이민 순유입 → 수혈
    name: "이민순유입", bodyPart: "수혈", axis: 9,
    "양호 ○": { metaphor: "수혈 진행", prefix: "이민 순유입이 양호하며 외부로부터 새 피가 수혈되고 있다." },
    "주의 ●": { metaphor: "수혈 부족", prefix: "이민 순유입이 부진하며 수혈이 부족하다." },
    "경보 ★": { metaphor: "수혈 중단", prefix: "이민이 순유출로 전환되며 수혈이 중단되었다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `수혈 진행. 이민순유입(${v}) 양호. 인구 보충 작동.`,
      "주의 ●": (v,c) => `수혈 부족. 이민순유입(${v}) 부진. 인구 보충 미흡.`,
      "경보 ★": (v,c) => `수혈 중단. 이민순유입(${v}) 유출 전환. 인구 이탈.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `이민 순유입(A5)이 ${v}로 유출 전환되었다. 수혈이 중단되었다. 인구가 줄어드는 신체에 외부 수혈마저 끊기면 회복의 마지막 통로가 닫힌다.`;
      if (grade === "주의 ●") return `이민 순유입(A5)이 ${v}로 부진하다. 수혈이 부족하다. 저출산으로 인한 인구 감소를 이민으로 보충하지 못하고 있다.`;
      return `이민 순유입(A5)이 ${v}로 양호하다. 수혈이 진행 중이다. 외부로부터 새로운 인구가 유입되고 있다.`;
    },
  },
};


// ━━━ 2. 경보 이모지/색상 매핑 ━━━

const ALERT_MAP = {
  0: { emoji: "🟢", color: "00A651", label: "0단계: 정상 (관찰 유지)" },
  1: { emoji: "🟡", color: "FFC107", label: "1단계: 주의 (잠복기 관찰 강화)" },
  2: { emoji: "🔴", color: "FF0000", label: "2단계: 경보 (미세석회 침착 가속)" },
  3: { emoji: "🔴", color: "8B0000", label: "3단계: 위기 (이중봉쇄 진행)" },
};


// ━━━ 3. DIAH 트리거 서사 템플릿 ━━━

const DIAH_NARRATIVE = {
  H: {
    name: "돈맥경화",
    dormant: (ctx) => `기준금리가 ${ctx.baseRate || "미확인"}이며 국채금리는 ${ctx.i6Grade === "양호 ○" ? "안정세" : "상승세"}다. 초미세 자본의 말단 도달 비용은 ${ctx.i6Grade === "양호 ○" ? "완화 추세" : "증가 중"}이나, ${ctx.o6Grade !== "양호 ○" ? "소비(O6) 위축이 지속되는 점에서 흡수 장애의 잠복 가능성은 남아 있다." : "아직 흡수 차단 수준은 아니다."}`,
    active: (ctx) => `금리 상승과 유동성 경색이 결합하여 초미세 자본이 말단에 도달하지 못하고 있다. 돈맥경화 트리거가 발동했다.`,
  },
  A: {
    name: "물가폭등",
    dormant: (ctx) => `CPI ${ctx.o2Value}로 ${ctx.o2Grade === "양호 ○" ? "안정적" : "미열 수준"}이다. 배출되지 못한 압력이 축적되는 양상은 ${ctx.o2Grade === "경보 ★" ? "관측된다." : "관측되지 않는다."}`,
    active: (ctx) => `물가가 ${ctx.o2Value}로 급등하며 배출 압력이 임계점을 넘었다. 물가폭등 트리거가 발동했다.`,
  },
  D: {
    name: "소득절벽",
    dormant: (ctx) => `경상수지 ${ctx.i1Value} ${ctx.i1Grade === "양호 ○" ? "흑자" : ""}로 거시적 유입은 ${ctx.i1Grade === "양호 ○" ? "풍부하다" : "위축되고 있다"}. 그러나 ${ctx.i4Grade !== "양호 ○" ? `환율 ${ctx.i4Value}의 고공행진은 수입 의존 가계의 실질 구매력을 잠식하고 있다.` : "이 산소가 말단까지 순환하는지는 별도 관찰이 필요하다."}`,
    active: (ctx) => `소득 유입이 급감하며 비상금고를 녹여 쓰는 상태다. 소득절벽 트리거가 발동했다.`,
  },
  I: {
    name: "빈부격차",
    dormant: (ctx) => `${ctx.o4Grade !== "양호 ○" ? "주가 급등과 " : ""}수출 대기업과 내수 소상공인의 격차가 ${ctx.o6Grade !== "양호 ○" ? "확대되고 있다." : "관찰 중이다."} ${ctx.o6Grade !== "양호 ○" ? `경상수지 호조와 소비 위축(${ctx.o6Value})의 동시 진행은 산소가 말단까지 순환하지 못하는 구조적 불균형을 시사한다.` : ""} 빈부격차는 시작이자 끝인 악순환 고리다.`,
    active: (ctx) => `자산 보유자와 비보유자 사이의 격차가 임계점을 넘었다. 빈부격차 트리거가 발동했다.`,
  },
};


// ━━━ 4. 7M 기전 표 (고정) ━━━

const M7_TABLE = [
  { stage: "0M", name: "정상", body: "무증상",              econ: "거시지표 양호" },
  { stage: "1M", name: "폐열", body: "내강폐쇄/파열/출혈",  econ: "자본시장 급성 경색" },
  { stage: "2M", name: "둔화", body: "관절/근육 기능저하",   econ: "경기 둔화/고용 악화" },
  { stage: "3M", name: "피폐", body: "수용체/신호차단",      econ: "정책 무반응" },
  { stage: "4M", name: "경화", body: "섬유화/석회화",        econ: "구조적 경직" },
  { stage: "5M", name: "범파", body: "세포과증식/비대",      econ: "버블/비대화" },
  { stage: "6M", name: "단절", body: "신경단절/괴사",        econ: "시스템 단절" },
  { stage: "7M", name: "붕괴", body: "뼈/치아 구조붕괴",     econ: "국가 구조 붕괴" },
];


// ━━━ 5. 부록 (고정 텍스트) ━━━

const APPENDIX = [
  { title: "1. 기존 경제학의 한계", text: "기존 경제학은 양(量)만 보고 흐름(流)을 보지 않았다. GDP가 성장해도 서민의 삶이 나아지지 않는 이유를 설명하지 못한다. DIAH-7M은 '어디가 막혔는가'를 묻는다." },
  { title: "2. DIAH-7M의 질문", text: "이 시스템의 핵심 질문은 단 하나다. '어디가 막혔는가?' 경제의 흐름이 어디에서 막히고 있는지를 진단하면, 어디를 뚫어야 하는지가 명확해진다." },
  { title: "3. 신체와 경제는 같은 법칙을 따른다", text: "인체는 37조 개의 세포로 구성되며, 202개 질병이 DIAH 트리거와 7M 기전으로 분류된다. 경제도 수천만 경제 주체(가계/소상공인, 대기업, 정부)로 구성되며, 같은 흐름 법칙을 따른다." },
  { title: "4. 구조적 동형(Structural Isomorphism)", text: "이것은 비유가 아니다. 같은 설계도다. 인체의 칼슘 대사와 경제의 자본 흐름은 구조적으로 동일한 패턴을 따른다. 막히면 죽는다는 법칙은 세포에도, 경제에도 동일하게 적용된다." },
  { title: "5. DIAH 트리거의 동일성", text: "D(결핍)는 인체에서 칼슘 결핍, 경제에서 소득절벽이다. I(염증)는 인체에서 만성 염증, 경제에서 빈부격차다. A(산증)는 인체에서 대사성 산증, 경제에서 물가폭등이다. H(저산소)는 인체에서 조직 저산소증, 경제에서 돈맥경화다." },
  { title: "6. 7M 기전의 동일성", text: "1M(폐열)부터 7M(붕괴)까지, 인체에서 내강이 막혀 터지고, 관절이 둔해지고, 수용체가 덮이고, 조직이 경화되고, 세포가 과증식하고, 신경이 단절되고, 뼈가 무너지는 과정은 경제에서 자본시장 경색, 경기 둔화, 정책 무반응, 구조 경직, 버블, 시스템 단절, 국가 구조 붕괴와 정확히 대응한다." },
  { title: "7. 이중봉쇄의 동일성", text: "CAM(수용체 차단) + DLT(통로 차단) = 이중봉쇄는 인체에서 사망, 경제에서 국가 붕괴를 의미한다. 공급과 배출이 동시에 차단되면 어떤 시스템이든 생존할 수 없다." },
  { title: "8. 자연의 보편 법칙", text: "뉴턴이 사과와 달이 같은 힘으로 움직인다고 본 것처럼, DIAH-7M은 세포와 경제가 같은 흐름 법칙으로 작동한다고 본다. 이것이 인체국가경제론의 핵심이다." },
  { title: "9. 본 보고서의 의의", text: "이 보고서는 예측이 아니라 진단이다. 현재 경제의 흐름 상태를 객관적으로 측정하고, 어디가 막혀 있는지를 보여준다. 예측은 틀릴 수 있지만, 진단은 현재를 정확히 읽는다." },
];


// ━━━ 6. 경보 상향 규칙 (고정) ━━━

const ALERT_RULES = [
  { condition: "7게이지 중 2개 이상 주의", action: "1단계(주의)로 상향 검토" },
  { condition: "7게이지 중 1개 이상 경보 + 1개 이상 주의", action: "2단계(경보)로 상향 검토" },
  { condition: "DIAH 트리거 2개 이상 동시 발동", action: "3단계(위기)로 상향 검토" },
];


// ━━━ 7. 가족력 (고정 — 과거 데이터 불변) ━━━

const FAMILY_HISTORY_PAST = {
  "1997": {
    year: "1997년 11월",
    data: { 경상수지: "-23억$ (적자)", 외환보유고: "~300억$", 환율: "~1,700원 (폭등)", 국채금리: ">20% (폭등)", 물가: "~6% (급등)", 주가: "~400pt (폭락)", "DIAH 트리거": "D+H 동시발동", 진단명: "급성 심근경색" },
    narrative: (nowMonth) => `1997년(D+H / 급성 심근경색): 외환위기 당시 소득절벽(D)과 돈맥경화(H)가 동시 발동하여 급성 심근경색을 일으켰다. 현재와의 차이점은 외환보유고와 경상수지(흑자 기조)가 안정적이라는 것이다. 그러나 당시에도 위기 직전까지 거시지표는 양호했다는 점을 기억해야 한다.`,
  },
  "2008": {
    year: "2008년 10월",
    data: { 경상수지: "-56억$ (적자)", 외환보유고: "~2,000억$", 환율: "~1,500원 (급등)", 국채금리: "~6% (급등)", 물가: "~5% (상승)", 주가: "~1,000pt (급락)", "DIAH 트리거": "H+A 동시발동", 진단명: "패혈증 쇼크" },
    narrative: (nowMonth) => `2008년(H+A / 패혈증 쇼크): 글로벌 금융위기 시 돈맥경화(H)와 물가폭등(A)이 결합하여 패혈증 쇼크가 발생했다. 현재와 비교하면 금리와 물가 수준이 크게 다르나, 잠복기 후 급성 발현이라는 패턴은 동일하다.`,
  },
  common: "두 사례 모두 미세석회가 오랜 기간 조용히 침착된 후 급성 발현으로 전환되었다는 공통점이 있다. 현재의 0단계 정상 판정이 안전을 보장하는 것은 아니다.",
};


// ━━━ 8. 섹션 0 작동원리 (고정) ━━━

// ━━━ v2.8 신규: 교차신호 서사 템플릿 (6쌍) ━━━

const CROSS_SIGNAL_NARRATIVES = {
  '거시↔고용': {
    organ: '심폐 → 근육/신경',
    trigger: '거시경제(심장)의 박동이 약해지면 고용(근육)에 힘이 빠진다.',
    risk: '실물경기 침체가 고용시장으로 전이',
    historical: '2008 금융위기 — GDP 급락 → 대량 실업 확산',
  },
  '거시↔금융': {
    organ: '심폐 ↔ 혈액',
    trigger: '심장(거시)과 혈액(금융)이 동시에 나빠지면 전신 순환이 멈춘다.',
    risk: '실물↔금융 악순환 — 가장 위험한 복합 경로',
    historical: '2008 금융위기 — 서브프라임 → 리먼 → 실물 붕괴',
  },
  '거시↔에너지': {
    organ: '심폐 ← 산소통',
    trigger: '산소 공급(에너지)이 끊기면 심폐(거시)가 직접 타격받는다.',
    risk: '에너지 충격이 실물 경제를 직격',
    historical: '1973 오일쇼크, 2008 유가 $147 → 실물 위기 가속',
  },
  '고용↔금융': {
    organ: '근육 ↔ 혈액',
    trigger: '근육 손상(고용 악화)과 혈액 오염(금융 불안)이 동시 발생하면 회복이 어렵다.',
    risk: '가계부채 부실이 금융시스템으로 전이',
    historical: '가계 연체 → 은행 부실채권 증가 → 신용경색',
  },
  '금융↔에너지': {
    organ: '혈액 ← 산소통',
    trigger: '산소 공급(에너지) 위기가 혈액의 질(금융)을 오염시킨다.',
    risk: '에너지 가격 급등이 금융 시장 불안을 촉발',
    historical: '유가 급등 → 기업 수익성 악화 → 회사채 스프레드 확대',
  },
  '부동산↔금융': {
    organ: '뼈 → 혈액',
    trigger: '뼈(부동산)에 골절이 발생하면 내출혈(금융 손실)이 전신으로 퍼진다.',
    risk: 'PF/부동산 부실이 금융 시장으로 전이',
    historical: '2022 레고랜드 PF — 강원도 ABCP 디폴트 → 채권시장 동결',
  },
};

// ━━━ v2.8 신규: 구조축(축9) 등급별 서사 템플릿 ━━━

const STRUCTURAL_TEMPLATES = {
  3: { // 🔴위기
    headline: '이 경제의 신체 나이가 위기 수준이다',
    body: '인구 구조가 심각한 경보 상태다. 출산율 급락, 고령화 가속, 생산인구 감소가 동시에 진행되고 있으며, 이는 10년 이상의 장기 구조적 위험으로, 순환 건강(축1~8)의 단기 대응으로는 해결이 불가능하다. 인체 비유: 뼈와 근육은 아직 움직이지만, 신체의 생물학적 나이가 실제 나이보다 훨씬 높은 상태. 세포 재생력(출산율)이 바닥이고, 조직의 노화(고령화)가 가속화되고 있다.',
  },
  2: { // 🟠경보
    headline: '인구 구조에 경보 신호가 감지된다',
    body: '주요 인구 지표에서 경보 수준의 악화가 확인된다. 현재 추세가 지속되면 5~10년 내 구조적 위기로 전환될 가능성이 높다. 신체 나이가 실제 나이보다 높아지기 시작한 단계.',
  },
  1: { // 🟡주의
    headline: '인구 구조에 주의가 필요하다',
    body: '인구 관련 일부 지표에서 악화 추세가 관찰된다. 아직 위기 수준은 아니지만 장기 모니터링이 필요하다.',
  },
  0: { // 🟢양호/🔵관심
    headline: '인구 구조가 안정적이다',
    body: '주요 인구 지표가 안정적 범위 내에 있다.',
  },
};

const SECTION_0 = {
  principle: "경제는 인체와 같은 흐름 시스템이다. 막히면 죽는다.",
  body1: "빚이자란 카드빚이자, 대출이자, 임대료 같은 것이다. 하나하나는 눈에 보이지 않지만, 전신에 쌓여 경제를 굳힌다. 이것이 미세석회다. 대기업과 정부의 빚이자, 자산버블처럼 눈에 보이는 것은 거시석회다. 그러나 진짜 위기를 일으키는 것은 미세석회, 즉 가계 빚이자의 전신 침착이다.",
  body2: "원인은 네 갈래(DIAH)지만 수렴점은 하나다. 빚이 비상금고에서 유출되고, 빚이자가 석회로 침착되며, 통로가 봉쇄되어 공급과 배출이 동시에 붕괴한다.",
  rule: "미세석회는 하루아침에 쌓이지 않는다. 수십 년간 조용히 누적되다가, 어느 순간 임계점을 넘으면 한꺼번에 기능이 마비된다. 위기는 트리거 하나가 아니라 복합 작용으로 온다.",
  camDlt: "CAM은 미세석회가 수용체를 덮어 신호를 차단하는 것이다. 경제적으로는 정책 금리를 낮춰도 말단이 반응하지 않는 인슐린 저항 상태다. DLT는 미세석회가 미세혈관 통로를 막아 세포의 산소·포도당 공급과 CO₂·독소 배출을 동시에 차단하는 것이다. 둘 다 발생하면 이중봉쇄다.",
  diahDef: "D(소득절벽)는 들어올 자본이 부족해 비상금고를 녹여 쓰는 것이다. I(빈부격차)는 마찰이 미세경로를 수축시켜 자본 회전을 둔화시키는 것이다. A(물가폭등)는 배출되지 못한 압력이 축적되어 기능이 마비되는 것이다. H(돈맥경화)는 초미세 자본이 공급되어도 말단이 흡수하지 못하는 것이다.",
  warning: "미세석회는 무증상으로 쌓인다. 0단계는 아직 진단 기준에 도달하지 않았다는 뜻이지, 석회가 없다는 뜻이 아니다. 1997년과 2008년 모두 위기 직전까지 거시지표는 양호했다.",
};


// ══════════════════════════════════════════════════════════════
// ██ 메인 변환 함수: generateNarrative(judgmentResult, rawData, meta) → D 객체
// ══════════════════════════════════════════════════════════════

/**
 * @param {Object} result - 판정엔진 v5.0/v5.1 runJudgment() 출력
 * @param {Object} rawData - 원시 입력 데이터 (값/변동 문자열용)
 * @param {Object} meta - 추가 메타 정보
 *   meta.month         "2025년 12월"
 *   meta.writeDate     "2026년 2월 7일"
 *   meta.engineVersion "DIAH-7M 판정엔진 v5.1 + 서사엔진 v2.8"
 *   meta.dataNote      "일부 지표 2025년 11월 확정치 사용"
 *   meta.baseRate       "2.50%" (기준금리)
 *   meta.oneLiner       "경상수지 사상 최대에도..." (한줄 진단 — 선택, 자동생성도 가능)
 *   meta.prevMonths     { m1: "10월", m2: "11월", m3: "12월" }
 *   meta.sec2_titleSuffix  "[심폐계] 제목 후반부"
 *   meta.sec3_titleSuffix  "[순환계-말단] 제목 후반부"
 *   meta.sec4_titleSuffix  "잠복 상태, 관찰 필요"
 *   meta.prognosis      { A: {...}, B: {...}, C: {...} }
 *   meta.watchVars      [...] 
 *   meta.prescriptions  [...]
 *   meta.timeseriesOverride [...] (시계열 데이터 직접 입력)
 *   meta.familyHistoryNow {...} (현재 가족력 컬럼)
 */
function generateNarrative(result, rawData, meta) {
  // ── v2.8: v5.1 → v2.7 호환 심(shim) ──
  // v5.1 gauges: { code: { value, score, threshold } }
  // v2.7 expects: { code: { available, value, change, grade } }
  const _rawG = result.gauges || {};
  const _scoreToGrade = (s) => s === '★' ? '경보 ★' : s === '●' ? '주의 ●' : '양호 ○';
  
  const g = {};
  for (const [code, gData] of Object.entries(_rawG)) {
    if (gData && typeof gData === 'object') {
      g[code] = {
        available: true,
        value: gData.value,
        change: rawData?.[code]?.change ?? rawData?.[code]?.value ?? null,
        grade: gData.grade || _scoreToGrade(gData.score || '○'),
        name: METAPHOR[code]?.name || code,
      };
    }
  }

  // v5.1 alert/blockade 호환 (v5.1은 이 필드가 없으므로 diah에서 유도)
  const _diahRaw = result.diah || {};
  const _triggerList = _diahRaw.triggers || _diahRaw.active || [];
  const _triggerCount = _triggerList.length;
  const al = result.alert || {
    level: _triggerCount >= 3 ? 2 : _triggerCount >= 1 ? 1 : 0,
    label: _triggerCount >= 3 ? 'Lv.2 복합경보' : _triggerCount >= 1 ? 'Lv.1 단일경보' : 'Lv.0 정상',
  };
  const bl = result.blockade || {
    type: _triggerCount >= 3 ? '이중봉쇄' : _triggerCount >= 2 ? '신호봉쇄' : '미발동',
    label: _triggerCount >= 3 ? 'CAM+DLT 이중봉쇄' : _triggerCount >= 2 ? 'CAM 신호봉쇄' : '봉쇄 미발동',
    cam: _triggerCount >= 2 ? '경보' : _triggerCount >= 1 ? '주의' : '양호',
    dlt: _triggerCount >= 3 ? '경보' : _triggerCount >= 2 ? '주의' : '양호',
    dual: _triggerCount >= 3,
  };

  // v5.1 diah 호환
  const diah = (() => {
    if (_diahRaw.label && _diahRaw.active) return _diahRaw; // v5.0 형식 (label + active 모두 존재)
    // v5.1 형식 → v2.7 호환
    return {
      ..._diahRaw,
      label: _diahRaw.formula || _triggerList.join('+') || '미발동',
      active: _triggerList,
    };
  })();

  // v5.1 m7 호환
  const _m7Raw = result.m7 || {};
  const m7 = (() => {
    if (_m7Raw.current !== undefined) return _m7Raw; // v5.0 형식
    // v5.1 형식 → v2.7 호환
    const pathways = _m7Raw.pathways || [];
    const lastP = pathways.length > 0 ? pathways[pathways.length - 1] : '0M';
    const lastNum = parseInt(lastP) || 0;
    const nextP = lastNum < 7 ? `${lastNum + 1}M` : '7M';
    return {
      ..._m7Raw,
      current: lastP,
      next: nextP,
    };
  })();

  // ── v2.8 신규: v5.1 등급 추출 (v5.0 호환) ──
  const _isV51 = !!(result.cyclicalGrade && result.structuralGrade);
  const _grades = _isV51 ? {
    cyclicalLevel: result.cyclicalGrade.level,
    cyclicalCode: result.cyclicalGrade.code,
    eff: result.cyclicalGrade.eff,
    maxAxisCode: result.cyclicalGrade.maxAxisCode,
    boost: result.cyclicalGrade.boost,
    crisisCount: result.cyclicalGrade.crisisCount,
    alertCount: result.cyclicalGrade.alertCount,
    cautionCount: result.cyclicalGrade.cautionCount,
    structuralLevel: result.structuralGrade.level,
    structuralCode: result.structuralGrade.code,
    display: result.overallGrade.display,
  } : {
    cyclicalLevel: result.overallGrade?.level || '미판정',
    cyclicalCode: result.overallGrade?.code || 0,
    eff: null, maxAxisCode: null, boost: null,
    crisisCount: null, alertCount: null, cautionCount: null,
    structuralLevel: null, structuralCode: null,
    display: result.overallGrade?.level || '미판정',
  };

  // ── v2.8 신규: 교차신호 서사 생성 ──
  // crossSignals가 { active: [...], inactive: [] } 객체이거나 배열일 수 있음
  const _crossSignalsRaw = Array.isArray(result.crossSignals)
    ? result.crossSignals
    : (result.crossSignals?.active || []);
  const _crossSignals = _crossSignalsRaw.map(cs => {
    const tmpl = CROSS_SIGNAL_NARRATIVES[cs.pair] || {
      organ: '축간 연동', trigger: `${cs.pair}에서 교차 신호 감지`, risk: '축간 전이 위험',
    };
    let severityDesc;
    if (cs.severity >= 5) severityDesc = '매우 강한 교차 — 전이가 진행 중';
    else if (cs.severity >= 4) severityDesc = '강한 교차 — 전이 감시 필요';
    else if (cs.severity >= 3) severityDesc = '중간 교차 — 전이 가능성';
    else severityDesc = '약한 교차 — 모니터링 단계';
    let boostDesc;
    if (cs.boost >= 1.0) boostDesc = '전이 확인 (+1.0)';
    else if (cs.boost >= 0.5) boostDesc = '전이 가능성 (+0.5)';
    else boostDesc = '미적용';
    return {
      pair: cs.pair, severity: cs.severity, severityDesc, boostDesc,
      organ: tmpl.organ, narrative: tmpl.trigger, risk: tmpl.risk,
      historical: tmpl.historical || null,
    };
  });

  // ── v2.8 신규: 구조축(축9) 전용 서사 생성 ──
  const _structuralNarrative = (() => {
    if (!_isV51 || !_grades.structuralCode) return null;
    const code = Math.min(3, Math.floor(_grades.structuralCode));
    const tmpl = STRUCTURAL_TEMPLATES[code] || STRUCTURAL_TEMPLATES[0];
    return {
      headline: tmpl.headline,
      body: tmpl.body,
      separator: '※ 구조등급은 순환등급(축1~8)과 독립적으로 평가됩니다.',
    };
  })();

  // 12게이지 코드 (순서 고정)
  const INPUT_CODES = ["I1", "I2", "I3", "I4", "I5", "I6"];
  const OUTPUT_CODES = ["O1", "O2", "O3", "O4", "O5", "O6"];
  const ALL_CODES = [...INPUT_CODES, ...OUTPUT_CODES];
  // 7게이지 (자동) — 종합판정 테이블용
  const SEVEN_CODES = ["I1", "I3", "I4", "I6", "O2", "O4", "O6"];
  // 5게이지 (보조) — 보조 분석용
  const FIVE_CODES = ["I2", "I5", "O1", "O3", "O5"];

  // ── 축2 무역/제조업 (동맥) 코드 ──
  const AXIS2_SAT = ["S1", "S2", "S3"];  // 위성 게이지
  const AXIS2_TRAD = ["T1", "T2", "T3"]; // 통계 게이지
  const AXIS2_CODES = [...AXIS2_SAT, ...AXIS2_TRAD];

  // 축3 골목시장 — 미세혈관
  const AXIS3_CODES = ["M1", "M2", "M3", "M4", "M5"];

  // 축4 부동산 X-ray — 뼈
  const AXIS4_MARKET = ["R1", "R2", "R3", "R4"];           // 4A 시세
  const AXIS4_SAT = ["R5", "R6", "R7", "R8"];              // 4B/4C 위성 팩트체크
  const AXIS4_ALERT = ["R9"];                                // 4D 괴리경보
  const AXIS4_CODES = [...AXIS4_MARKET, ...AXIS4_SAT, ...AXIS4_ALERT];

  // 축5 고용/가계 — 근육/신경
  const AXIS5_CODES = ["L1", "L2", "L3", "L4", "L5"];

  // 축6 지역균형 — 좌우대칭
  const AXIS6_CODES = ["G1", "G2", "G3", "G4", "G5", "G6", "G7"];

  // 축7 금융 스트레스 — 혈액의 질
  const AXIS7_CODES = ["F1", "F2", "F3", "F4", "F5"];

  // 축8 에너지/자원 — 산소 공급원
  const AXIS8_CODES = ["E1", "E2", "E3", "E4", "E5"];

  // 축9 인구/노화 — 신체 나이
  const AXIS9_CODES = ["A1", "A2", "A3", "A4", "A5"];

  // 헬퍼: 값 포맷
  function fmtValue(code) {
    const gauge = g[code];
    if (!gauge || !gauge.available) return "N/A";
    const v = gauge.value;
    const def = METAPHOR[code];
    if (!def) return String(v);
    // 코드별 포맷
    if (code === "I1") return `${v}억$`;
    if (code === "I2") return `${v}%`;
    if (code === "I3") return `${v}억$`;
    if (code === "I4") return `${v}원`;
    if (code === "I5") return `${v}bp`;
    if (code === "I6") return `${v}%`;
    if (code === "O1") return `${v}%`;
    if (code === "O2") return `${v}%`;
    if (code === "O3") return `${v}%`;
    if (code === "O4") return `${v}pt`;
    if (code === "O5") return `${v}%`;
    if (code === "O6") return `${v}%`;
    // 축2 무역/제조업
    if (code === "S1") return `${v}일`;
    if (code === "S2") return `${v}%`;
    if (code === "S3") return `${v}%`;
    if (code === "T1") return `${v}만TEU`;
    if (code === "T2") return `${v}pt`;
    if (code === "T3") return `${v}%`;
    // 축3 골목시장/미세혈관
    if (code === "M1") return `${v}배`;   // 개업/폐업 비율
    if (code === "M2") return `${v}만명`;  // 유동인구
    if (code === "M3") return `${v}조원`;  // 카드매출
    if (code === "M4") return `${v}만원/㎡`; // 상가임대료
    if (code === "M5") return `${v}등급`;  // 상권등급
    // 축4 부동산/뼈
    if (code === "R1") return `${v}만원/㎡`;  // 실거래가
    if (code === "R2") return `${v}호`;       // 미분양
    if (code === "R3") return `${v}%`;        // 전세가율
    if (code === "R4") return `${v}건`;       // 경매건수
    if (code === "R5") return `${v}m`;        // SAR 높이변화
    if (code === "R6") return `${v}%`;        // 야간광량(신축)
    if (code === "R7") return `${v}%`;        // 주차점유율
    if (code === "R8") return `${v}℃`;       // 표면온도
    if (code === "R9") return `${v}개월`;     // 괴리지속기간
    // 축5 고용/가계
    if (code === "L1") return `${v}만명`;     // 고용동향(취업자수 변동)
    if (code === "L2") return `${v}만건`;     // 실업급여 신청
    if (code === "L3") return `${v}조원`;     // 가계부채
    if (code === "L4") return `${v}%`;        // 연체율
    if (code === "L5") return `${v}pt`;       // CSI
    // 축6 지역균형
    if (code === "G1") return `${v}개지역`;   // 소멸위험 지역 수
    if (code === "G2") return `${v}배`;       // 수도권/비수도권 GRDP 비율
    if (code === "G3") return `${v}만명`;     // 수도권 순유입
    if (code === "G4") return `${v}배`;       // 수도권/지방 창폐업 비율
    if (code === "G5") return `${v}%`;        // 재정자립도
    if (code === "G6") return `${v}%`;        // 야간광 지방/수도권 비율
    if (code === "G7") return `${v}건`;       // 특구 투자유치 건수
    // 축7 금융 스트레스
    if (code === "F1") return `${v}bp`;       // 회사채 스프레드
    if (code === "F2") return `${v}%`;        // CP 금리
    if (code === "F3") return `${v}%`;        // BIS 비율
    if (code === "F4") return `${v}%`;        // 코스피 변동성(VIX)
    if (code === "F5") return `${v}bp`;       // 은행채 스프레드
    // 축8 에너지/자원
    if (code === "E1") return `${v}$/bbl`;    // 유가
    if (code === "E2") return `${v}%`;        // 전력 예비율
    if (code === "E3") return `${v}만톤`;     // LNG 재고
    if (code === "E4") return `${v}GWh`;      // 산업용 전력
    if (code === "E5") return `${v}pt`;       // 원자재 가격지수
    // 축9 인구/노화
    if (code === "A1") return `${v}명`;       // 합계출산율
    if (code === "A2") return `${v}%`;        // 고령화율
    if (code === "A3") return `${v}만명`;     // 생산가능인구
    if (code === "A4") return `${v}만명`;     // 학령인구
    if (code === "A5") return `${v}만명`;     // 이민 순유입
    return String(v);
  }
  function fmtChange(code) {
    const gauge = g[code];
    if (!gauge || gauge.change === null || gauge.change === undefined) return "";
    const c = gauge.change;
    const sign = c > 0 ? "+" : "";
    if (code === "I1") return `${sign}${c}억$`;
    if (code === "I2") return `${sign}${c}%p`;
    if (code === "I3") return `${sign}${c}%`;
    if (code === "I4") return `${sign}${c}%`;
    if (code === "I5") return `${sign}${c}bp`;
    if (code === "I6") return `${sign}${c}%p`;
    if (code === "O1") return `${sign}${c}%p`;
    if (code === "O2") return `${sign}${c}%p`;
    if (code === "O3") return `${sign}${c}%p`;
    if (code === "O4") return `${sign}${c}%`;
    if (code === "O5") return `${sign}${c}%p`;
    if (code === "O6") return `${sign}${c}%p`;
    // 축2 무역/제조업
    if (code === "S1") return `${sign}${c}일`;
    if (code === "S2") return `${sign}${c}%p`;
    if (code === "S3") return `${sign}${c}%p`;
    if (code === "T1") return `${sign}${c}%`;
    if (code === "T2") return `${sign}${c}pt`;
    if (code === "T3") return `${sign}${c}%p`;
    // 축3 골목시장/미세혈관
    if (code === "M1") return `${sign}${c}배`;
    if (code === "M2") return `${sign}${c}%`;
    if (code === "M3") return `${sign}${c}%`;
    if (code === "M4") return `${sign}${c}%`;
    if (code === "M5") return `${sign}${c}단계`;
    // 축4 부동산/뼈
    if (code === "R1") return `${sign}${c}%`;
    if (code === "R2") return `${sign}${c}%`;
    if (code === "R3") return `${sign}${c}%p`;
    if (code === "R4") return `${sign}${c}%`;
    if (code === "R5") return `${sign}${c}m`;
    if (code === "R6") return `${sign}${c}%p`;
    if (code === "R7") return `${sign}${c}%p`;
    if (code === "R8") return `${sign}${c}℃`;
    if (code === "R9") return `${sign}${c}개월`;
    // 축5 고용/가계
    if (code === "L1") return `${sign}${c}만명`;
    if (code === "L2") return `${sign}${c}%`;
    if (code === "L3") return `${sign}${c}%`;
    if (code === "L4") return `${sign}${c}%p`;
    if (code === "L5") return `${sign}${c}pt`;
    // 축6 지역균형
    if (code === "G1") return `${sign}${c}개지역`;
    if (code === "G2") return `${sign}${c}배`;
    if (code === "G3") return `${sign}${c}만명`;
    if (code === "G4") return `${sign}${c}배`;
    if (code === "G5") return `${sign}${c}%p`;
    if (code === "G6") return `${sign}${c}%p`;
    if (code === "G7") return `${sign}${c}건`;
    // 축7 금융 스트레스
    if (code === "F1") return `${sign}${c}bp`;
    if (code === "F2") return `${sign}${c}%p`;
    if (code === "F3") return `${sign}${c}%p`;
    if (code === "F4") return `${sign}${c}%p`;
    if (code === "F5") return `${sign}${c}bp`;
    // 축8 에너지/자원
    if (code === "E1") return `${sign}${c}$/bbl`;
    if (code === "E2") return `${sign}${c}%p`;
    if (code === "E3") return `${sign}${c}만톤`;
    if (code === "E4") return `${sign}${c}%`;
    if (code === "E5") return `${sign}${c}pt`;
    // 축9 인구/노화
    if (code === "A1") return `${sign}${c}명`;
    if (code === "A2") return `${sign}${c}%p`;
    if (code === "A3") return `${sign}${c}만명`;
    if (code === "A4") return `${sign}${c}만명`;
    if (code === "A5") return `${sign}${c}만명`;
    return `${sign}${c}`;
  }
  function getGrade(code) {
    return g[code]?.grade || "N/A";
  }
  function gradeToJudge(grade) {
    if (grade.includes("양호")) return "정상";
    if (grade.includes("주의")) return "주의";
    if (grade.includes("경보")) return "경보";
    return "N/A";
  }

  // ── 경보 ──
  const alertInfo = ALERT_MAP[al.level] || ALERT_MAP[0];

  // ── 게이지 테이블 (섹션1) — 7게이지 자동 ──
  const gaugeTable = SEVEN_CODES.map(code => ({
    cat: ["I1","I2","I3","I4","I5","I6"].includes(code) ? "Input" : "Output",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  // ── 보조 5게이지 테이블 ──
  const auxGaugeTable = FIVE_CODES.filter(c => g[c]?.available).map(code => ({
    cat: ["I2","I5"].includes(code) ? "Input" : "Output",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  // 등급 카운트 (12게이지 전체)
  const gradeCount = { ok: 0, warn: 0, alert: 0 };
  ALL_CODES.filter(c => g[c]?.available).forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) gradeCount.alert++;
    else if (gr.includes("주의")) gradeCount.warn++;
    else gradeCount.ok++;
  });

  // ── 섹션1 서사 (기준 DOCX v3 수준) ──
  const totalAvail = ALL_CODES.filter(c => g[c]?.available).length;
  const warnCodes  = ALL_CODES.filter(c => g[c]?.available && getGrade(c).includes("주의"));
  const alertCodes = ALL_CODES.filter(c => g[c]?.available && getGrade(c).includes("경보"));

  // 병명 자동 생성: 경보 패턴 → 한의학적 병명
  const _hasH    = (getGrade("I4") !== "양호 ○" || getGrade("I6") !== "양호 ○"); // 혈압/금리
  const _hasD    = getGrade("I1") === "경보 ★"; // 경상수지 적자
  const _hasCold = getGrade("O4") === "경보 ★" && getGrade("O6") === "경보 ★"; // 주가+소비 동반
  const _hasHeat = getGrade("O2") === "경보 ★"; // 물가 급등
  let _clinicalName = "";
  if (bl.dual) _clinicalName = "이중봉쇄 — 경제 급사 위험";
  else if (_hasCold && _hasH) _clinicalName = "하한(下寒) 증후군 — 전신 냉각 진행 중";
  else if (_hasHeat && _hasH) _clinicalName = "열독(熱毒) 증후군 — 인플레 독소 누적";
  else if (_hasD) _clinicalName = "소득절벽 — 외부 산소 공급 차단 위험";
  else if (alertCodes.length >= 3) _clinicalName = "복합 경보 — 다발성 흐름 장애";
  else if (alertCodes.length >= 1) _clinicalName = `${alertCodes.map(c => METAPHOR[c]?.bodyPart || c).join("·")} 경보 상태`;
  else if (warnCodes.length >= 2) _clinicalName = "잠복기 — 미세석회 침착 주시 필요";
  else _clinicalName = "전신 순환 안정 — 무증상 정상 범위";

  const sec1_alertNarrative = _clinicalName;

  // 병리적 연결고리 — Input 경보→Output 영향 추적
  const _pathLines = [];
  if (getGrade("I4") === "경보 ★") {
    const _i4v = fmtValue("I4");
    _pathLines.push(`환율 ${_i4v} 급등(혈압 위기)은 수입물가를 끌어올리고 외국인 자본 이탈을 자극한다.`);
  }
  if (getGrade("I1") !== "양호 ○") {
    _pathLines.push(`경상수지 위축(폐 기능 저하)은 달러 공급 감소로 이어져 환율 추가 상승 압력을 만든다.`);
  }
  if (getGrade("O4") === "경보 ★") {
    _pathLines.push(`주가 하락(혈류 감소)은 자산효과 소멸로 소비 심리를 직격하고 내수를 위축시킨다.`);
  }
  if (getGrade("O6") === "경보 ★") {
    _pathLines.push(`소비 급감(말단 괴사)은 2년 이상 지속 시 구조적 3M(피폐·정책 무반응) 진입을 예고한다.`);
  }
  if (getGrade("O2") !== "양호 ○") {
    _pathLines.push(`물가 상승(체온 상승)은 환율발 수입물가 경로로 추가 자극될 수 있어 A(물가폭등) 트리거 잠복 관찰이 필요하다.`);
  }
  if (_pathLines.length === 0) _pathLines.push("현재 주요 게이지 간 연쇄 악화 경로는 감지되지 않는다. 단월 변동에 유의하며 추이를 관찰한다.");

  let sec1_detail = (() => {
    const _parts = [];
    // 전체 판정 요약
    _parts.push(`현재 ${totalAvail}개 게이지 중 경보 ${alertCodes.length}개, 주의 ${warnCodes.length}개, 양호 ${gradeCount.ok}개다.`);
    // 경보 게이지 인체비유 상세
    if (alertCodes.length > 0) {
      const _alertDescs = alertCodes.map(c => {
        const m = METAPHOR[c];
        const mInfo = m?.[getGrade(c)] || m?.["양호 ○"];
        return `${m?.bodyPart || c}(${c}: ${fmtValue(c)})이 ${mInfo?.metaphor || '경보 수준'}이다`;
      });
      _parts.push(_alertDescs.join(". ") + ".");
    }
    // CAM/DLT 상태
    _parts.push(`CAM(자본대사·동맥) ${bl.cam}, DLT(말단순환·정맥) ${bl.dlt}${bl.dual ? " — 이중봉쇄 발생. 급사 위험 단계." : bl.cam !== "양호" || bl.dlt !== "양호" ? ". 단독봉쇄 상태." : ". 이중봉쇄 미발생."}`);
    // DIAH 상태
    _parts.push(`DIAH 트리거: ${diah.label}.`);
    return _parts.join(" ");
  })();

  // sec1_pathology: 병리적 연결고리 서사
  const sec1_pathology = _pathLines.join(" ");

  // ── 섹션2 심폐계 (Input 6게이지) ──
  const sec2_gauges = INPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  // 심폐계 종합
  const inputGrades = INPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(c => getGrade(c));
  const inputKeywords = INPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    const info = m[gr] || m["양호 ○"];
    return `${m.bodyPart} ${gr.includes("양호") ? "안정" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  // ── 섹션3 순환계-말단 (Output 6게이지) ──
  const sec3_gauges = OUTPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = (() => {
      let info = m[grade] || m["양호 ○"];
      // 값이 음수인데 양호 등급이면 비유를 주의 수준으로 보정
      if (code === "O6" && g[code].value < 0 && grade === "양호 ○") info = m["주의 ●"];
      if (code === "O1" && g[code].value < 0 && grade === "양호 ○") info = m["주의 ●"];
      return info;
    })();
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  // ── 섹션4 DIAH ──

  // ══════════════════════════════════════
  // 축2. 무역/제조업 — 동맥 혈류
  // ══════════════════════════════════════
  const axis2_available = AXIS2_CODES.filter(c => g[c]?.available);
  const axis2_gauges = axis2_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  // 축2 게이지 테이블 (종합판정 보조)
  const axis2_gaugeTable = axis2_available.map(code => ({
    cat: AXIS2_SAT.includes(code) ? "위성" : "통계",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  // 축2 종합 키워드
  const axis2_keywords = axis2_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  // 축2 gradeCount
  const axis2_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis2_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis2_gradeCount.alert++;
    else if (gr.includes("주의")) axis2_gradeCount.warn++;
    else axis2_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축3. 골목시장 — 미세혈관
  // ══════════════════════════════════════
  const axis3_available = AXIS3_CODES.filter(c => g[c]?.available);
  const axis3_gauges = axis3_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis3_gaugeTable = axis3_available.map(code => ({
    cat: "골목",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis3_keywords = axis3_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis3_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis3_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis3_gradeCount.alert++;
    else if (gr.includes("주의")) axis3_gradeCount.warn++;
    else axis3_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축4. 부동산 X-ray — 뼈
  // ══════════════════════════════════════
  const axis4_available = AXIS4_CODES.filter(c => g[c]?.available);
  const axis4_gauges = axis4_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis4_gaugeTable = axis4_available.map(code => ({
    cat: AXIS4_MARKET.includes(code) ? "시세" : AXIS4_SAT.includes(code) ? "위성" : "괴리",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis4_keywords = axis4_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis4_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis4_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis4_gradeCount.alert++;
    else if (gr.includes("주의")) axis4_gradeCount.warn++;
    else axis4_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축5. 고용/가계 — 근육/신경
  // ══════════════════════════════════════
  const axis5_available = AXIS5_CODES.filter(c => g[c]?.available);
  const axis5_gauges = axis5_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis5_gaugeTable = axis5_available.map(code => ({
    cat: "가계",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis5_keywords = axis5_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis5_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis5_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis5_gradeCount.alert++;
    else if (gr.includes("주의")) axis5_gradeCount.warn++;
    else axis5_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축6. 지역균형 — 좌우대칭
  // ══════════════════════════════════════
  const axis6_available = AXIS6_CODES.filter(c => g[c]?.available);
  const axis6_gauges = axis6_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis6_gaugeTable = axis6_available.map(code => ({
    cat: "지역",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis6_keywords = axis6_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis6_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis6_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis6_gradeCount.alert++;
    else if (gr.includes("주의")) axis6_gradeCount.warn++;
    else axis6_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축7. 금융 스트레스 — 혈액의 질
  // ══════════════════════════════════════
  const axis7_available = AXIS7_CODES.filter(c => g[c]?.available);
  const axis7_gauges = axis7_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis7_gaugeTable = axis7_available.map(code => ({
    cat: "금융",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis7_keywords = axis7_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis7_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis7_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis7_gradeCount.alert++;
    else if (gr.includes("주의")) axis7_gradeCount.warn++;
    else axis7_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축8. 에너지/자원 — 산소 공급원
  // ══════════════════════════════════════
  const axis8_available = AXIS8_CODES.filter(c => g[c]?.available);
  const axis8_gauges = axis8_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });
  const axis8_gaugeTable = axis8_available.map(code => ({
    cat: "에너지",
    code: `${code} ${METAPHOR[code]?.name || code}`,
    raw: fmtValue(code), change: fmtChange(code),
    grade: getGrade(code), judge: gradeToJudge(getGrade(code)),
  }));
  const axis8_keywords = axis8_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c]; const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });
  const axis8_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis8_available.forEach(code => { const gr = getGrade(code); if (gr.includes("경보")) axis8_gradeCount.alert++; else if (gr.includes("주의")) axis8_gradeCount.warn++; else axis8_gradeCount.ok++; });

  // ══════════════════════════════════════
  // 축9. 인구/노화 — 신체 나이
  // ══════════════════════════════════════
  const axis9_available = AXIS9_CODES.filter(c => g[c]?.available);
  const axis9_gauges = axis9_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });
  const axis9_gaugeTable = axis9_available.map(code => ({
    cat: "인구",
    code: `${code} ${METAPHOR[code]?.name || code}`,
    raw: fmtValue(code), change: fmtChange(code),
    grade: getGrade(code), judge: gradeToJudge(getGrade(code)),
  }));
  const axis9_keywords = axis9_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c]; const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });
  const axis9_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis9_available.forEach(code => { const gr = getGrade(code); if (gr.includes("경보")) axis9_gradeCount.alert++; else if (gr.includes("주의")) axis9_gradeCount.warn++; else axis9_gradeCount.ok++; });

  // ── 섹션4 DIAH (원래 위치) ──
  const diahContext = {
    baseRate: meta.baseRate || "미확인",
    i6Grade: getGrade("I6"), o6Grade: getGrade("O6"), o6Value: fmtValue("O6"),
    o2Grade: getGrade("O2"), o2Value: fmtValue("O2"),
    i1Grade: getGrade("I1"), i1Value: fmtValue("I1"),
    i4Grade: getGrade("I4"), i4Value: fmtValue("I4"),
    o4Grade: getGrade("O4"),
  };
  const sec4_triggers = ["H", "A", "D", "I"].map(code => {
    const dn = DIAH_NARRATIVE[code];
    const isActive = diah.active.includes(code);
    return {
      code, name: dn.name,
      text: isActive ? dn.active(diahContext) : dn.dormant(diahContext),
    };
  });

  // DIAH 종합
  let sec4_summary = `DIAH 종합: 트리거 ${diah.label}`;
  if (diah.active.length === 0) {
    const dormantHints = [];
    if (getGrade("I6") !== "양호 ○" || getGrade("I4") !== "양호 ○") dormantHints.push("H/D 잠복 관찰");
    if (getGrade("O6") !== "양호 ○") dormantHints.push("소비 위축 지속");
    if (dormantHints.length > 0) sec4_summary += `이나 ${dormantHints.join(", ")} 필요.`;
  }

  // ── 섹션5 7M ──
  const currentM = typeof m7.current === "object" ? m7.current.m : (m7.current || "0M");
  const currentMData = M7_TABLE.find(m => m.stage === currentM) || M7_TABLE[0];
  const nextM = typeof m7.next === "object" ? m7.next.m : (m7.next || "1M");
  const nextMData = M7_TABLE.find(m => m.stage === nextM) || M7_TABLE[1];

  // ── 출처 테이블 (고정 구조) ──
  const sources = [
    { data: "경상수지",     source: "ECOS", org: "한국은행",   period: "" },
    { data: "외환보유고",   source: "ECOS", org: "한국은행",   period: "" },
    { data: "환율",         source: "ECOS", org: "한국은행",   period: "" },
    { data: "국채금리",     source: "ECOS", org: "한국은행",   period: "" },
    { data: "소비자물가",   source: "KOSIS", org: "통계청",    period: "" },
    { data: "주가(KOSPI)",  source: "KRX",  org: "한국거래소", period: "" },
    { data: "소매판매",     source: "KOSIS", org: "통계청",    period: "" },
    // 축2 무역/제조업 출처
    { data: "선박 입출항",   source: "AIS",   org: "UN Global Platform", period: "" },
    { data: "야간광량",     source: "VIIRS", org: "NOAA",      period: "" },
    { data: "NO₂ 농도",    source: "GEMS",  org: "환경위성",   period: "" },
    { data: "컨테이너 TEU", source: "해수부", org: "해양수산부",  period: "" },
    { data: "제조업 BSI",   source: "ECOS",  org: "한국은행",   period: "" },
    { data: "산업용 전력",   source: "전력거래소", org: "전력거래소", period: "" },
    // 축3 골목시장 출처
    { data: "개폐업 현황",   source: "상가DB",    org: "소상공인진흥공단", period: "" },
    { data: "유동인구",      source: "열린데이터", org: "서울시",         period: "" },
    { data: "카드매출",      source: "로컬데이터", org: "행안부",         period: "" },
    { data: "상가 임대차",   source: "실거래가",   org: "국토부",         period: "" },
    { data: "상권 등급",     source: "상권정보",   org: "소진공",         period: "" },
    // 축4 부동산 출처
    { data: "아파트 실거래가", source: "실거래가",   org: "국토부",         period: "" },
    { data: "미분양 통계",    source: "실거래가",   org: "국토부",         period: "" },
    { data: "전세가율",       source: "KB부동산",   org: "KB",            period: "" },
    { data: "경매 건수",      source: "경매정보",   org: "대법원",         period: "" },
    { data: "건물 높이(SAR)", source: "Sentinel-1", org: "ESA/Copernicus", period: "" },
    { data: "야간광(신축)",   source: "VIIRS",      org: "NOAA",          period: "" },
    { data: "주차장 점유",    source: "Sentinel-2", org: "ESA/Copernicus", period: "" },
    { data: "건물 표면온도",  source: "Landsat",    org: "USGS/NASA",     period: "" },
    { data: "괴리 경보",      source: "자체엔진",   org: "DIAH-7M",       period: "" },
    // 축5 고용/가계 출처
    { data: "고용동향",       source: "KOSIS",     org: "통계청",         period: "" },
    { data: "실업급여",       source: "고용부",    org: "고용노동부",     period: "" },
    { data: "가계부채",       source: "ECOS",      org: "한국은행",       period: "" },
    { data: "연체율",         source: "금감원",    org: "금융감독원",     period: "" },
    { data: "체감경기 CSI",   source: "ECOS",      org: "한국은행",       period: "" },
    // 축6 지역균형 출처
    { data: "지방소멸지수",   source: "소멸지수",  org: "한국고용정보원",  period: "" },
    { data: "지역별 GRDP",   source: "KOSIS",     org: "통계청",         period: "" },
    { data: "지역별 인구이동", source: "전입전출",  org: "통계청",         period: "" },
    { data: "지역별 창폐업",  source: "상가정보",  org: "소진공",         period: "" },
    { data: "지방재정자립도", source: "지방재정365", org: "행안부",        period: "" },
    { data: "지역별 야간광",  source: "VIIRS",     org: "NOAA",          period: "" },
    { data: "특구 투자유치",  source: "산업부",    org: "산업통상자원부",  period: "" },
    // 축7 금융 스트레스 출처
    { data: "회사채 스프레드", source: "금투협",    org: "금융투자협회",    period: "" },
    { data: "CP 금리",        source: "ECOS",      org: "한국은행",       period: "" },
    { data: "은행 BIS 비율",  source: "금감원",    org: "금융감독원",     period: "" },
    { data: "코스피 변동성",  source: "KRX",       org: "한국거래소",     period: "" },
    { data: "은행채 스프레드", source: "금투협",    org: "금융투자협회",    period: "" },
    // 축8 에너지/자원 출처
    { data: "유가 Dubai",     source: "Opinet",    org: "한국석유공사",    period: "" },
    { data: "전력 예비율",    source: "전력거래소",  org: "전력거래소",     period: "" },
    { data: "LNG 재고",      source: "가스공사",    org: "한국가스공사",    period: "" },
    { data: "산업용 전력",    source: "전력거래소",  org: "전력거래소",     period: "" },
    { data: "원자재 가격지수", source: "ECOS",      org: "한국은행",       period: "" },
    // 축9 인구/노화 출처
    { data: "합계출산율",     source: "KOSIS",     org: "통계청",         period: "" },
    { data: "고령화율",       source: "KOSIS",     org: "통계청",         period: "" },
    { data: "생산가능인구",   source: "KOSIS",     org: "통계청",         period: "" },
    { data: "학령인구",       source: "교육부",    org: "교육부",         period: "" },
    { data: "이민 순유입",    source: "법무부",    org: "법무부",         period: "" },
  ];

  // ══════════════════════════════════════
  // D 객체 조립
  // ══════════════════════════════════════

  const D = {
    // 메타
    month: meta.month,
    writeDate: meta.writeDate || new Date().toLocaleDateString('ko-KR', { year:'numeric', month:'long', day:'numeric' }),
    engineVersion: meta.engineVersion || "DIAH-7M 판정엔진 v5.0 + 서사엔진 v2.7",
    dataNote: meta.dataNote || "",

    // 경보
    alertEmoji: alertInfo.emoji,
    alertLevel: alertInfo.label,
    alertColor: alertInfo.color,
    oneLiner: meta.oneLiner || `${alertInfo.label.split(":")[0]} 판정`,
    camStatus: `${bl.cam === "양호" ? "🟢" : "🔴"} ${bl.cam}`,
    dltStatus: `${bl.dlt === "양호" ? "🟢" : "🔴"} ${bl.dlt}`,
    dualBlockade: bl.dual ? "발생" : "미발생",
    diahStatus: diah.label,

    // 섹션1
    gauges: gaugeTable,
    auxGauges: auxGaugeTable,
    sec1_alertNarrative,
    sec1_detail,
    sec1_pathology,  // 병리적 연결고리 서사 (v2.8 신규)

    // 섹션2
    sec2_title: `2. [심폐계] ${meta.sec2_titleSuffix || "Input 게이지 분석"}`,
    sec2_gauges,
    sec2_summary: meta.sec2_summary || `심폐계 종합: ${inputKeywords.join(", ")}`,
    sec2_summaryNarrative: meta.sec2_summaryNarrative || "심폐계 종합 서사를 meta에서 입력하세요.",

    // 섹션3
    sec3_title: `3. [순환계-말단] ${meta.sec3_titleSuffix || "Output 게이지 분석"}`,
    sec3_gauges,
    sec3_summary: meta.sec3_summary || "순환계 종합",
    sec3_summaryNarrative: meta.sec3_summaryNarrative || "순환계 종합 서사를 meta에서 입력하세요.",

    // ── 축2 무역/제조업 (동맥 혈류) ──
    axis2_title: meta.axis2_titleSuffix
      ? `[동맥] ${meta.axis2_titleSuffix}`
      : `[동맥] 무역/제조업 — 수출 동맥의 혈류 점검`,
    axis2_gauges,
    axis2_gaugeTable,
    axis2_summary: meta.axis2_summary || (axis2_available.length > 0
      ? `동맥 종합: ${axis2_keywords.join(", ")}`
      : "축2 데이터 미입력"),
    axis2_summaryNarrative: meta.axis2_summaryNarrative || (axis2_available.length > 0
      ? `${axis2_gradeCount.ok}개 양호, ${axis2_gradeCount.warn}개 주의, ${axis2_gradeCount.alert}개 경보. ${axis2_gradeCount.alert > 0 ? "동맥 혈류에 경보 신호가 감지되었다." : axis2_gradeCount.warn > 0 ? "동맥 혈류에 주의 신호가 관찰된다." : "동맥 혈류가 원활하다."}`
      : "축2 데이터 미입력"),
    axis2_available: axis2_available.length > 0,

    // ── 축3 골목시장 (미세혈관) ──
    axis3_title: meta.axis3_titleSuffix
      ? `[미세혈관] ${meta.axis3_titleSuffix}`
      : `[미세혈관] 골목시장 — 경제의 모세혈관 점검`,
    axis3_gauges,
    axis3_gaugeTable,
    axis3_summary: meta.axis3_summary || (axis3_available.length > 0
      ? `미세혈관 종합: ${axis3_keywords.join(", ")}`
      : "축3 데이터 미입력"),
    axis3_summaryNarrative: meta.axis3_summaryNarrative || (axis3_available.length > 0
      ? `${axis3_gradeCount.ok}개 양호, ${axis3_gradeCount.warn}개 주의, ${axis3_gradeCount.alert}개 경보. ${axis3_gradeCount.alert > 0 ? "미세혈관에 괴사 신호가 감지되었다. 골목 경제가 위험하다." : axis3_gradeCount.warn > 0 ? "미세혈관에 순환 장애 징후가 관찰된다." : "미세혈관 순환이 원활하다. 골목 상권이 살아있다."}`
      : "축3 데이터 미입력"),
    axis3_available: axis3_available.length > 0,

    // ── 축4 부동산 X-ray (뼈) ──
    axis4_title: meta.axis4_titleSuffix
      ? `[뼈] ${meta.axis4_titleSuffix}`
      : `[뼈] 부동산 X-ray — 골밀도 측정과 위성 팩트체크`,
    axis4_gauges,
    axis4_gaugeTable,
    axis4_summary: meta.axis4_summary || (axis4_available.length > 0
      ? `골격 종합: ${axis4_keywords.join(", ")}`
      : "축4 데이터 미입력"),
    axis4_summaryNarrative: meta.axis4_summaryNarrative || (axis4_available.length > 0
      ? `${axis4_gradeCount.ok}개 양호, ${axis4_gradeCount.warn}개 주의, ${axis4_gradeCount.alert}개 경보. ${axis4_gradeCount.alert > 0 ? "골격에 골절 또는 괴리 신호가 감지되었다. 부동산 구조 안정성 경보." : axis4_gradeCount.warn > 0 ? "골격에 약화 징후가 관찰된다. 골밀도 추적 필요." : "골격이 견고하다. 부동산 X-ray 정상."}`
      : "축4 데이터 미입력"),
    axis4_available: axis4_available.length > 0,

    // ── 축5 고용/가계 (근육/신경) ──
    axis5_title: meta.axis5_titleSuffix
      ? `[근육/신경] ${meta.axis5_titleSuffix}`
      : `[근육/신경] 고용/가계 — 경제의 근력과 통증 점검`,
    axis5_gauges,
    axis5_gaugeTable,
    axis5_summary: meta.axis5_summary || (axis5_available.length > 0
      ? `근육/신경 종합: ${axis5_keywords.join(", ")}`
      : "축5 데이터 미입력"),
    axis5_summaryNarrative: meta.axis5_summaryNarrative || (axis5_available.length > 0
      ? `${axis5_gradeCount.ok}개 양호, ${axis5_gradeCount.warn}개 주의, ${axis5_gradeCount.alert}개 경보. ${axis5_gradeCount.alert > 0 ? "근육/신경에 심각한 손상이 감지되었다. 가계 경제가 위험하다." : axis5_gradeCount.warn > 0 ? "근육/신경에 과부하 징후가 관찰된다." : "근육/신경이 건강하다. 고용과 가계가 안정적이다."}`
      : "축5 데이터 미입력"),
    axis5_available: axis5_available.length > 0,

    // ── 축6 지역균형 (좌우대칭) ──
    axis6_title: meta.axis6_titleSuffix
      ? `[좌우대칭] ${meta.axis6_titleSuffix}`
      : `[좌우대칭] 지역균형 — 편마비 진단과 재활 점검`,
    axis6_gauges,
    axis6_gaugeTable,
    axis6_summary: meta.axis6_summary || (axis6_available.length > 0
      ? `좌우대칭 종합: ${axis6_keywords.join(", ")}`
      : "축6 데이터 미입력"),
    axis6_summaryNarrative: meta.axis6_summaryNarrative || (axis6_available.length > 0
      ? `${axis6_gradeCount.ok}개 양호, ${axis6_gradeCount.warn}개 주의, ${axis6_gradeCount.alert}개 경보. ${axis6_gradeCount.alert > 0 ? "편마비가 진행 중이다. 지역 균형이 심각하게 무너지고 있다." : axis6_gradeCount.warn > 0 ? "좌우 불균형 징후가 관찰된다. 수도권 쏠림이 심화되고 있다." : "좌우 균형이 유지되고 있다. 지역 발전이 안정적이다."}`
      : "축6 데이터 미입력"),
    axis6_available: axis6_available.length > 0,

    // ── 축7 금융 스트레스 (혈액의 질) ──
    axis7_title: meta.axis7_titleSuffix
      ? `[혈액의 질] ${meta.axis7_titleSuffix}`
      : `[혈액의 질] 금융 스트레스 — 혈액 점도·독소·면역 점검`,
    axis7_gauges,
    axis7_gaugeTable,
    axis7_summary: meta.axis7_summary || (axis7_available.length > 0
      ? `혈액의 질 종합: ${axis7_keywords.join(", ")}`
      : "축7 데이터 미입력"),
    axis7_summaryNarrative: meta.axis7_summaryNarrative || (axis7_available.length > 0
      ? `${axis7_gradeCount.ok}개 양호, ${axis7_gradeCount.warn}개 주의, ${axis7_gradeCount.alert}개 경보. ${axis7_gradeCount.alert > 0 ? "혈액에 혈전·독소가 위험 수준이다. 금융 시스템 경색 위험." : axis7_gradeCount.warn > 0 ? "혈액의 질이 악화되고 있다. 금융 스트레스 누적 중." : "혈액의 질이 양호하다. 금융시장이 안정적이다."}`
      : "축7 데이터 미입력"),
    axis7_available: axis7_available.length > 0,

    // ── 축8 에너지/자원 (산소 공급원) ──
    axis8_title: meta.axis8_titleSuffix
      ? `[산소 공급원] ${meta.axis8_titleSuffix}`
      : `[산소 공급원] 에너지/자원 — 산소 가격·비축·소비 점검`,
    axis8_gauges,
    axis8_gaugeTable,
    axis8_summary: meta.axis8_summary || (axis8_available.length > 0
      ? `산소 공급원 종합: ${axis8_keywords.join(", ")}`
      : "축8 데이터 미입력"),
    axis8_summaryNarrative: meta.axis8_summaryNarrative || (axis8_available.length > 0
      ? `${axis8_gradeCount.ok}개 양호, ${axis8_gradeCount.warn}개 주의, ${axis8_gradeCount.alert}개 경보. ${axis8_gradeCount.alert > 0 ? "산소 공급에 위기가 발생했다. 에너지 비상." : axis8_gradeCount.warn > 0 ? "산소 공급에 불안 징후가 있다." : "산소 공급이 안정적이다. 에너지 수급 양호."}`
      : "축8 데이터 미입력"),
    axis8_available: axis8_available.length > 0,

    // ── 축9 인구/노화 (신체 나이) — ⚠️ 구조축 [v2.8] ──
    axis9_title: meta.axis9_titleSuffix
      ? `[신체 나이] ${meta.axis9_titleSuffix}`
      : `[신체 나이] 인구/노화 — 세포 재생·근육·줄기세포 점검 ⚠️구조축`,
    axis9_type: 'structural',  // v2.8 신규: 구조축 타입 플래그
    axis9_gauges,
    axis9_gaugeTable,
    axis9_summary: meta.axis9_summary || (axis9_available.length > 0
      ? `신체 나이 종합: ${axis9_keywords.join(", ")}`
      : "축9 데이터 미입력"),
    axis9_summaryNarrative: meta.axis9_summaryNarrative || (axis9_available.length > 0
      ? `${axis9_gradeCount.ok}개 양호, ${axis9_gradeCount.warn}개 주의, ${axis9_gradeCount.alert}개 경보. ${axis9_gradeCount.alert > 0 ? "경제의 신체가 급속히 노화하고 있다. 인구 위기 심각." : axis9_gradeCount.warn > 0 ? "신체 노화가 진행 중이다. 인구 구조 변화에 주의." : "신체 나이가 적정하다. 인구 구조가 안정적이다."}`
      : "축9 데이터 미입력"),
    axis9_structuralNarrative: _structuralNarrative,  // v2.8 신규: 구조축 전용 서사
    axis9_available: axis9_available.length > 0,

    // 섹션4
    sec4_title: `4. DIAH 트리거 분석: ${meta.sec4_titleSuffix || "상태 점검"}`,
    sec4_verdict: `판정: ${diah.label}`,
    sec4_triggers,
    sec4_summary,

    // 섹션5
    sec5_current: currentM,
    sec5_currentName: currentMData.name,
    sec5_currentText: meta.sec5_currentText || `석회 작용이 기전 발현 수준에 ${currentM === "0M" ? "도달하지 않았다. 경제의 구조적 통로는 아직 개통 상태를 유지하고 있다." : "진입했다."}`,
    sec5_nextM: nextM,
    sec5_nextName: `${nextMData.name} (${nextMData.body.split("/")[0]})`,
    sec5_nextText: meta.sec5_nextText || `${currentM}에서 ${nextM}으로의 진입 조건은 거시석회의 급성 파열이다.`,

    // 섹션6 (예후는 정성 판단 필요 → meta에서 입력)
    sec6_intro: meta.sec6_intro || (() => {
      if (alertCodes.length >= 3) return "복수 경보 게이지가 동시 발동 중이다. 향후 3개월은 분기점이다. 세 가지 경로 중 어디로 향하는지 관찰한다.";
      if (alertCodes.length >= 1) return "경보 게이지가 발생했다. 현재 흐름이 지속되면 악화, 전환 조건이 충족되면 개선으로 분기한다.";
      if (warnCodes.length >= 2) return "복수 주의 신호가 감지되었다. 잠복 단계로, 추세 방향에 따라 세 경로 중 하나로 수렴한다.";
      return "주요 게이지가 안정적이다. 다만 구조적 취약성이 잠복하므로 3가지 경로를 사전에 점검한다.";
    })(),
    sec6_paths: meta.prognosis || (() => {
      // 자동 확률 계산: 경보/주의 수 + DIAH 활성 여부 기반
      const _alertN = alertCodes.length;
      const _warnN  = warnCodes.length;
      const _diahN  = diah.active.length;
      // 기본 확률 (개선/유지/악화)
      let pA = 30, pB = 50, pC = 20;
      if (_alertN >= 3 || _diahN >= 2) { pA = 10; pB = 40; pC = 50; }
      else if (_alertN >= 2 || _diahN >= 1) { pA = 20; pB = 45; pC = 35; }
      else if (_alertN === 1) { pA = 25; pB = 50; pC = 25; }
      else if (_warnN >= 3) { pA = 30; pB = 50; pC = 20; }
      else { pA = 40; pB = 45; pC = 15; }
      // 경보 코드 기반 경로 설명 자동 생성
      const _alertDesc = alertCodes.length > 0
        ? alertCodes.map(c => `${METAPHOR[c]?.name || c}(${c})` ).join(", ") + " 경보 해소"
        : "현재 추이 유지";
      const _warnDesc = warnCodes.length > 0
        ? warnCodes.map(c => `${METAPHOR[c]?.name || c}` ).join("·") + " 주의 신호 지속"
        : "현재 상태 유지";
      const _worstDesc = alertCodes.length > 0
        ? alertCodes.map(c => `${METAPHOR[c]?.name || c}(${c}) 악화` ).join(", ")
        : warnCodes.map(c => `${METAPHOR[c]?.name || c} 경보 전환` ).join(", ") || "주요 지표 추가 악화";
      // Input 최강 경보 코드 → 관찰변수
      const _topAlert = alertCodes[0] || warnCodes[0];
      const _watchMain = _topAlert ? `${_topAlert}(${METAPHOR[_topAlert]?.name || _topAlert})` : "핵심 지표 추이";
      return [
        { label: "경로 A — 개선", prob: `${pA}%`, text: `조건: ${_alertDesc} + 정책 효과 발현. 경과: 경보 게이지 정상 복귀 → CAM/DLT 봉쇄 해제 → 종합 등급 하향. 확률: ${pA}% (${_alertN === 0 ? "현 추이 유지 시 가장 가능성 높음" : "정책·외부 여건 동시 개선 필요"}).` },
        { label: "경로 B — 유지", prob: `${pB}%`, text: `조건: ${_warnDesc}. 경과: 경보 게이지 횡보 → ${_warnN > 0 ? "주의 수준 장기 유지 → 만성 피로 누적" : "현 상태 유지"}. 확률: ${pB}% (현재 가장 가능성 높은 시나리오).` },
        { label: "경로 C — 악화", prob: `${pC}%`, text: `조건: ${_worstDesc}. 경과: ${_diahN > 0 ? `DIAH ${diah.label} 심화 →` : "경보 게이지 추가 확대 →"} CAM 또는 DLT 봉쇄 → 이중봉쇄 위험. 위험 신호: ${_watchMain} 연속 악화 + DIAH 트리거 추가 활성. 확률: ${pC}%.` },
      ];
    })(),
    sec6_watchVars: meta.watchVars || (() => {
      const _vars = [];
      alertCodes.slice(0, 3).forEach(c => _vars.push(`${c}(${METAPHOR[c]?.name || c}) — 경보 지속 여부`));
      warnCodes.slice(0, 2).forEach(c => _vars.push(`${c}(${METAPHOR[c]?.name || c}) — 경보 전환 여부`));
      if (_vars.length === 0) _vars.push("I4 환율", "O6 소매판매", "O4 주가");
      return _vars;
    })(),

    // 섹션7 (시계열은 이전 데이터 필요 → meta에서 입력)
    sec7_data: meta.timeseriesOverride || [],
    sec7_months: meta.prevMonths ? [meta.prevMonths.m1, meta.prevMonths.m2, meta.prevMonths.m3] : ["N-2", "N-1", "N"],
    sec7_narrative: meta.sec7_narrative || "시계열 서사를 meta에서 입력하세요.",

    // v2.8+: 모드별 시계열 구조체 (보고서생성기 v3.1 호환)
    sec7_monthly: meta.sec7_monthly || {
      title: "7. 시계열 추이: 직전 3개월 변화",
      cols: meta.prevMonths ? [meta.prevMonths.m1, meta.prevMonths.m2, meta.prevMonths.m3] : ["N-2월", "N-1월", "N월"],
      data: meta.timeseriesOverride || [],
    },
    sec7_quarterly: meta.sec7_quarterly || {
      title: "7. 시계열 추이: 직전 4분기 변화",
      cols: ["Q-2", "Q-1", "Q0"],
      data: [],
    },
    sec7_annual: meta.sec7_annual || {
      title: "7. 시계열 추이: 직전 3개년 변화",
      cols: ["Y-2", "Y-1", "Y0"],
      data: [],
    },

    // 섹션8
    sec8_data: (() => {
      const items = ["경상수지", "외환보유고", "환율", "국채금리", "물가", "주가", "DIAH 트리거", "진단명"];
      const nowData = meta.familyHistoryNow || {};
      return items.map(item => ({
        item,
        y1997: FAMILY_HISTORY_PAST["1997"].data[item] || "",
        y2008: FAMILY_HISTORY_PAST["2008"].data[item] || "",
        now: nowData[item] || "",
      }));
    })(),
    sec8_narrative1997: FAMILY_HISTORY_PAST["1997"].narrative(meta.month),
    sec8_narrative2008: FAMILY_HISTORY_PAST["2008"].narrative(meta.month),
    sec8_common: FAMILY_HISTORY_PAST.common,

    // 섹션9 — 처방 자동생성 (DIAH + 경보 코드 기반)
    sec9_title: meta.sec9_title || (() => {
      if (diah.active.includes('H')) return '9. 명의의 처방: "유동성 함정 탈출 — 말단 혈관 개통"';
      if (diah.active.includes('D')) return '9. 명의의 처방: "소득절벽 차단 — 외부 산소 공급 확보"';
      if (diah.active.includes('A')) return '9. 명의의 처방: "물가 독소 배출 — 체온 안정화"';
      if (diah.active.includes('I')) return '9. 명의의 처방: "사회 염증 완화 — 격차 해소"';
      if (alertCodes.length > 0) return `9. 명의의 처방: "${alertCodes.map(c => METAPHOR[c]?.bodyPart || c).join('·')} 집중 치료"`;
      return '9. 명의의 처방: "미세혈관 개통을 위한 예방적 처방"';
    })(),
    sec9_intro: meta.sec9_intro || (() => {
      if (diah.active.length > 0) {
        return `현재 이 유기체에는 ${diah.label} 트리거가 활성화되어 있다. 단일 처방으로는 부족하며, 원인-경로-말단을 동시에 겨냥하는 복합 처방이 필요하다.`;
      }
      if (alertCodes.length > 0) {
        return `경보 게이지가 감지되었다. 지금은 예방 처방의 적기다. 흐름이 굳기 전에 미세혈관을 개통해야 한다.`;
      }
      return "현재 안정적이나, 미세석회는 무증상으로 쌓인다. 선제적 흐름 관리가 필요하다.";
    })(),
    sec9_prescriptions: meta.prescriptions || (() => {
      const _rxList = [];
      // 처방 1: 가장 나쁜 output 게이지 대응
      const _worstOut = OUTPUT_CODES.filter(c => g[c]?.available).sort((a,b) => {
        const gr = c => getGrade(c).includes("경보") ? 2 : getGrade(c).includes("주의") ? 1 : 0;
        return gr(b) - gr(a);
      })[0];
      if (_worstOut) {
        const _rxGrade = getGrade(_worstOut);
        const _rxM = METAPHOR[_worstOut];
        _rxList.push({
          title: `처방 1: ${_rxM?.bodyPart || _worstOut} ${_rxGrade.includes("경보") ? "응급 처치" : "주의 관리"} — ${_rxM?.name || _worstOut} 정상화`,
          text: `${_rxM?.["경보 ★"]?.prefix || _rxM?.["주의 ●"]?.prefix || ""} ${_rxGrade.includes("경보") ? `${_worstOut}(${fmtValue(_worstOut)})이 경보 수준이다. 즉각적 정책 투입이 필요하다.` : `${_worstOut}(${fmtValue(_worstOut)}) 주의 신호가 지속된다. 선제적 모니터링과 완화 조치가 필요하다.`}`,
        });
      }
      // 처방 2: 가장 나쁜 input 게이지 대응
      const _worstIn = INPUT_CODES.filter(c => g[c]?.available).sort((a,b) => {
        const gr = c => getGrade(c).includes("경보") ? 2 : getGrade(c).includes("주의") ? 1 : 0;
        return gr(b) - gr(a);
      })[0];
      if (_worstIn && _worstIn !== _worstOut) {
        const _rxM2 = METAPHOR[_worstIn];
        const _rxGrade2 = getGrade(_worstIn);
        _rxList.push({
          title: `처방 2: ${_rxM2?.bodyPart || _worstIn} 관리 — ${_rxM2?.name || _worstIn} ${_rxGrade2.includes("경보") ? "경보 대응" : "안정화"}`,
          text: `${_rxM2?.diagnosisTemplate?.[_rxGrade2]?.(fmtValue(_worstIn), fmtChange(_worstIn)) || `${_worstIn}(${fmtValue(_worstIn)}) 관리가 필요하다.`} 이 지표가 추가 악화되면 CAM(자본대사) 봉쇄로 전이될 수 있다.`,
        });
      }
      // 처방 3: 이중봉쇄 예방 또는 산소 공급 유지
      const _bestIn = INPUT_CODES.filter(c => g[c]?.available && getGrade(c) === "양호 ○")[0];
      if (_bestIn) {
        const _rxM3 = METAPHOR[_bestIn];
        _rxList.push({
          title: `처방 3: ${_rxM3?.bodyPart || _bestIn} 강점 유지 — 산소 공급 경로 보존`,
          text: `현재 ${_rxM3?.name || _bestIn}(${_bestIn})이 양호하다. 이 강점을 유지하는 것이 경제 생존의 마지막 보루다. ${_rxM3?.["양호 ○"]?.prefix || ""} 정책 우선순위에서 이 경로를 보호해야 한다.`,
        });
      }
      if (_rxList.length === 0) {
        _rxList.push({ title: "처방 1: 흐름 모니터링 강화", text: "현재 안정적이나, 잠복기 미세석회 침착을 예방하기 위해 핵심 게이지 주간 모니터링을 권고한다." });
      }
      return _rxList;
    })(),
    sec9_rules: ALERT_RULES,

    // 섹션10
    sec10_sources: sources.map((s, i) => ({ ...s, period: meta.sourcePeriods?.[i] || meta.month })),
    sec10_disclaimer: "본 보고서는 DIAH-7M 경제건강검진 시스템에 의해 자동 생성된 진단 결과서입니다. 투자 권유나 정책 제안이 아니며, 참고용으로만 활용하시기 바랍니다. 개별 경제 주체의 의사결정에 대한 책임은 본인에게 있습니다.",

    // 부록
    appendix: APPENDIX,

    // ── v2.8 신규: 종합등급 이원 구조 ──
    _v28_engineVersion: 'v2.8',
    _v28_isV51: _isV51,

    // 순환등급 (축1~8)
    _v28_cyclicalLevel: _grades.cyclicalLevel,
    _v28_cyclicalCode: _grades.cyclicalCode,
    _v28_eff: _grades.eff,
    _v28_maxAxisCode: _grades.maxAxisCode,
    _v28_boost: _grades.boost,
    _v28_crisisCount: _grades.crisisCount,
    _v28_alertCount: _grades.alertCount,
    _v28_cautionCount: _grades.cautionCount,

    // 구조등급 (축9)
    _v28_structuralLevel: _grades.structuralLevel,
    _v28_structuralCode: _grades.structuralCode,

    // 종합 표시
    _v28_gradeDisplay: _grades.display,
    _v28_coverGrade: _isV51
      ? `순환 건강: ${_grades.cyclicalLevel} | 구조 건강: ${_grades.structuralLevel}`
      : _grades.cyclicalLevel,

    // 종합 진단 서사 (이원 구조)
    _v28_overallNarrative: (() => {
      const lines = [];
      lines.push(`■ 순환 건강: ${_grades.cyclicalLevel}`);
      if (_grades.eff !== null) {
        lines.push(`  유효등급(eff) = ${_grades.eff} (최고위기축 ${_grades.maxAxisCode} + 교차부스트 ${_grades.boost})`);
        const parts = [];
        if (_grades.crisisCount > 0) parts.push(`위기 ${_grades.crisisCount}축`);
        if (_grades.alertCount > 0) parts.push(`경보 ${_grades.alertCount}축`);
        if (_grades.cautionCount > 0) parts.push(`주의 ${_grades.cautionCount}축`);
        if (parts.length > 0) lines.push(`  순환축 현황: ${parts.join(', ')}`);
      }
      if (_grades.cyclicalCode >= 3) lines.push('  → 다수의 장기에서 동시에 위험 신호가 감지. 전신 건강검진 결과 중증 상태.');
      else if (_grades.cyclicalCode >= 2) lines.push('  → 일부 장기에서 경보 수준의 이상 발견. 집중 관찰과 대응 필요.');
      else if (_grades.cyclicalCode >= 1) lines.push('  → 몇몇 지표에서 주의 신호 감지. 현재는 관리 가능한 수준.');
      else lines.push('  → 순환 건강 안정적. 주요 장기가 정상 범위 내에서 기능.');
      if (_grades.structuralLevel) {
        lines.push('');
        lines.push(`■ 구조 건강: ${_grades.structuralLevel}`);
        if (_grades.structuralCode >= 3) {
          lines.push('  → 인구 고령화(신체 나이)가 위기 수준. 순환 건강과 독립적인 장기 체력 평가.');
          lines.push('  → 10년+ 시계의 구조 개혁 없이는 순환 건강이 양호해도 장기 지속 어려움.');
        } else if (_grades.structuralCode >= 2) lines.push('  → 인구 구조에서 경보 수준의 변화 진행 중.');
        else if (_grades.structuralCode >= 1) lines.push('  → 인구 구조에 주의 필요하지만 아직 안정적.');
        else lines.push('  → 인구 구조 양호.');
      }
      return lines.join('\n');
    })(),

    // 교차신호 서사 (6쌍 기본)
    _v28_crossSignals: _crossSignals,
    _v28_crossSignalCount: _crossSignals.length,
    _v28_crossSignalSummary: _crossSignals.length > 0
      ? `교차신호 ${_crossSignals.length}건 감지: ${_crossSignals.map(c => `${c.pair}(${c.severityDesc})`).join(', ')}`
      : '교차신호 미감지',
  };

  // ── v2.8+2D: 교차신호 고도화 통합 (선택적 로딩) ──
  try {
    const enhance2D = require('./DIAH-7M_교차신호_2D_v1_0.js');
    const e2d = enhance2D(result);

    D._v28_2D_available = true;
    D._v28_2D_summary = e2d.summary;

    // 확장 교차신호 (15쌍)
    D._v28_2D_crossSignals = e2d.crossSignals2D;
    D._v28_2D_crossSignalCount = e2d.summary.totalPairs;

    // 캐스케이드 서사
    D._v28_2D_cascades = e2d.cascades.map(cc => ({
      name: cc.name,
      path: cc.path,
      organ: cc.organ,
      severity: cc.severity,
      totalSeverity: cc.totalSeverity,
      leadMonths: cc.leadTotalMonths,
      historicalRef: cc.historicalRef,
      narrative: `연쇄 전이 경로 "${cc.name}" 활성: ${cc.path} [${cc.severity}]. ` +
        `총 리드타임 ${cc.leadTotalMonths}개월. 역사적 사례: ${cc.historicalRef || '없음'}.`,
    }));
    D._v28_2D_cascadeCount = e2d.cascades.length;

    // 선행지표 경고
    D._v28_2D_leadTimeAlerts = e2d.leadTimeAlerts.map(al => ({
      source: al.source,
      target: al.target,
      sourceLevel: al.sourceLevel,
      leadMonths: al.leadMonths,
      confidence: al.confidence,
      warning: al.warning,
    }));
    D._v28_2D_leadTimeCount = e2d.leadTimeAlerts.length;

    // 조합경보 역사 매칭
    D._v28_2D_comboHistory = e2d.comboHistory;
    D._v28_2D_comboHistoryCount = e2d.comboHistory.length;

    // 부스트 (참조용, 실제 등급에는 v5.1 기본값 사용)
    D._v28_2D_boost = e2d.boost2D;

    // 종합 2D 서사
    D._v28_2D_narrative = e2d.summary.narrative;
    D._v28_2D_riskLevel = e2d.summary.riskLevel;

  } catch (e) {
    // 2D 모듈 미설치 시 기본값
    D._v28_2D_available = false;
  }

  return D;
}


// ━━━ 모듈 내보내기 ━━━
if (typeof module !== "undefined") {
  module.exports = {
    generateNarrative,
    METAPHOR,
    GAUGE_NARRATIVE,  // v2 코드 59개 — report-grammar.js에서 로드
    SECTION_0,
    M7_TABLE,
    APPENDIX,
    ALERT_MAP,
    DIAH_NARRATIVE,
    FAMILY_HISTORY_PAST,
    CROSS_SIGNAL_NARRATIVES,
    STRUCTURAL_TEMPLATES,
  };
}
