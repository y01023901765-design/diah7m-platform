// ══════════════════════════════════════════════════════════════
// DIAH-7M 서사엔진 v2.8
// 판정엔진 v5.1 출력 → 보고서생성기 v3.1 D 객체 변환
//
// 역할: 숫자 판정을 인체 비유 서사로 변환
// 패턴: "값 — '인체비유' [등급]" + "→ 진단:" + "▶ 종합:"
// 원본: 2026년 1월 확정본 양식에서 추출한 서사 규칙
//
// v2.7 → v2.8 변경:
//   P1: overallGrade 구조 변경 (순환/구조 이원 등급) 호환
//   P2: 축9 구조축 전용 서사 (순환등급과 독립)
//   P3: 교차신호 축4↔축7(부동산↔금융) 서사 추가
//   P4: 종합 진단 서사 이원 구조 (순환+구조)
//   P5: 보고서 표지 등급 이원 표시
// v2.8 → v2.9 (report-grammar 연결):
//   GAUGE_NARRATIVE: v2 코드 59개 서사 (report-grammar.js에서 import)
//   3-Layer 확장: blindSpot(사각지대) + actionSignals(행동시그널) 추가
// ══════════════════════════════════════════════════════════════
//
// ┌─────────────────────────────────────────────────────────────┐
// │  ⚠️  서사 작성 전 필독 — 인체국가경제론 핵심 등식           │
// │  이것을 모르면 서사가 꼬인다 (doctrine-theory.md 0절 참조)  │
// └─────────────────────────────────────────────────────────────┘
//
// ── 혈관 → 경제 구조 매핑 ──────────────────────────────────────
//   대동맥·대정맥  → 대기업·금융기관   → 금리·세금 지원 쉽게 도달
//   세동맥·세정맥  → 중소기업·자영업   → 정책 효과 희석
//   미세혈관       → 골목경제          → 정책 대부분 미도달 → H(저산소)
//   세포           → 가계·소상공인     → 직접 도달 불가 → 세포 괴사(H 최악)
//
// ── 물질 → 경제 등식 (인체국가경제론 고유 발견) ─────────────────
//   칼슘     = 현금(유동성)         → 흐르는 것
//   뼈       = 비상금고(저축)       → 저장되는 것
//   미세석회 = 빚 이자              → 굳어서 막힘. 원금(대출)과 다름. 절대 안 돌아온다
//   CO₂      = 인플레이션 압력      → 쌓여서 썩게 함. 미세석회(이자)와 성격이 다름
//
// ── DIAH 의학 정의 ────────────────────────────────────────────
//   D(Deficiency/결핍)  = 수입 감소       → 유동성 공급↓
//   I(Inflammation/염증) = 긴급 지출 증가  → 유동성 소진↑
//   A(Acidosis/산증)    = 화폐가치 하락   → 유동성 효율↓
//   H(Hypoxia/저산소)   = 생산 중단       → 유동성 생성↓  ← "말단 미도달" 아님
//
// ── 5단계 인과 순서 ───────────────────────────────────────────
//   1요인(깔때기) → 2시작(유출) → 3봉쇄(이중봉쇄) → 4발현(7M) → 5궤멸
//                              ↘ [압력 축적: CO₂ 배출 실패 → A 산증]
//   - 이중봉쇄 = 7M의 원인. 7M 기전의 하나가 아님
//   - 7M = 단독 또는 복합 발현. 1M→7M 순서 진행 아님
// ──────────────────────────────────────────────────────────────

// ── report-grammar.js에서 v2 코드 기반 서사 데이터 로드 ──
let GAUGE_NARRATIVE = {};
try {
  const grammar = require('./report-grammar');
  GAUGE_NARRATIVE = grammar.GAUGE_NARRATIVE || {};
} catch (e) {
  console.warn('[narrative-engine] report-grammar 로드 실패 (GAUGE_NARRATIVE 빈 객체 사용):', e.message);
}

// ━━━ 1. 게이지별 인체 비유 매핑 (등급별 3단계) ━━━

const METAPHOR = {
  I1: { // 경상수지 → 폐 기능 (산소 공급)
    name: "경상수지", bodyPart: "폐",
    "양호 ○": { metaphor: "폐 기능 양호", prefix: "산소 공급이 원활하다." },
    "주의 ●": { metaphor: "폐 기능 약화", prefix: "산소 공급이 둔화되고 있다." },
    "경보 ★": { metaphor: "폐 기능 위험", prefix: "산소 공급이 급격히 감소하고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `폐 기능 양호. 비상금고 소진 속도 안정적.${c.includes('+') ? ' 산소 공급 증가세.' : ''}`,
      "주의 ●": (v,c) => `폐 기능 약화 징후. 산소 공급량(${v}) 감소에 주의 필요.`,
      "경보 ★": (v,c) => `폐 기능 경보. 산소 공급(${v})이 위험 수준. D(소득절벽) 트리거 잠복 강화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const base = `비상금고 소진 속도는 ${grade === "양호 ○" ? "안정적" : grade === "주의 ●" ? "다소 불안정" : "위험 수준"}이다. 경상수지(I1)가 ${v}를 기록했다.`;
      return base;
    },
  },

  I2: { // 단기외채비율 → 혈액 점도
    name: "단기외채비율", bodyPart: "혈액점도",
    "양호 ○": { metaphor: "혈액 점도 정상", prefix: "혈액이 원활하게 흐르고 있다." },
    "주의 ●": { metaphor: "혈액 점도 상승", prefix: "혈액이 끈적해지고 있다." },
    "경보 ★": { metaphor: "혈액 점도 위험", prefix: "혈액이 굳어가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈액 점도 정상. 단기외채 비율(${v}) 안전 범위.`,
      "주의 ●": (v,c) => `혈액 점도 상승. 단기외채(${v})가 높아져 거시석회 파열 가능성 증가.`,
      "경보 ★": (v,c) => `혈액 점도 위험. 단기외채(${v})가 임계점 접근. 급성 유동성 위기 가능성.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `단기외채비율(I2)은 ${v}로 ${grade === "양호 ○" ? "안전 범위 내에 있다. 거시석회(기업·정부 빚이자) 파열 가능성은 낮다." : "상승하고 있다. 거시석회 파열 위험이 증가하고 있다."}`;
    },
  },

  I3: { // 외환보유고 → 저장 혈액
    name: "외환보유고", bodyPart: "혈액저장",
    "양호 ○": { metaphor: "저장 혈액 충분", prefix: "국가 체력 저장분이 안정적이다." },
    "주의 ●": { metaphor: "저장 혈액 감소", prefix: "국가 체력 저장분이 줄어들고 있다." },
    "경보 ★": { metaphor: "저장 혈액 부족", prefix: "국가 체력 저장분이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `국가 체력 저장분 안정. 위기 대응 여력 충분.`,
      "주의 ●": (v,c) => `저장 혈액 감소 추세(${c}). 외환보유고 관리 주의 필요.`,
      "경보 ★": (v,c) => `저장 혈액 급감(${c}). 위기 대응 여력 위축. 비상금고 경보.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `외환보유고(I3)는 ${v}로 ${c.includes('-') ? '감소' : '안정'}했으며 세계 9위 수준을 유지하고 있다.`;
    },
  },

  I4: { // 환율 → 혈압
    name: "환율", bodyPart: "혈압",
    "양호 ○": { metaphor: "혈압 안정", prefix: "혈압이 안정적이다." },
    "주의 ●": { metaphor: "혈압 상승", prefix: "혈압이 올라가고 있다." },
    "경보 ★": { metaphor: "혈압 위험", prefix: "혈압이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈압 안정. 환율 변동 범위 내 정상 작동.`,
      "주의 ●": (v,c) => `혈압 상승 지속. ${v} 고환율은 만성 고혈압 상태.`,
      "경보 ★": (v,c) => `혈압 위험. 환율 ${v} 급등은 급성 고혈압. 수입 의존 가계 타격 심화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const dir = c.includes('+') || c.includes('상승') ? '상승' : c.includes('-') ? '하락' : '유지';
      return `환율(I4)은 ${v}으로 전월비 ${c} ${dir}했다. ${grade !== "양호 ○" ? '혈압이 올라가고 있다.' : '혈압이 안정적이다.'}`;
    },
  },

  I5: { // 신용스프레드 → 혈관 탄력
    name: "신용스프레드", bodyPart: "혈관탄력",
    "양호 ○": { metaphor: "혈관 탄력 양호", prefix: "혈관이 유연하게 작동하고 있다." },
    "주의 ●": { metaphor: "혈관 탄력 저하", prefix: "혈관이 경직되기 시작했다." },
    "경보 ★": { metaphor: "혈관 경화", prefix: "혈관이 굳어지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈관 탄력 양호. 신용스프레드(${v}) 정상 범위.`,
      "주의 ●": (v,c) => `혈관 탄력 저하. 신용스프레드(${v}) 확대는 자금 조달 경색 초기 징후.`,
      "경보 ★": (v,c) => `혈관 경화 경보. 신용스프레드(${v}) 급확대는 H(돈맥경화) 트리거 접근 신호.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `신용스프레드(I5)는 ${v}로 ${grade === "양호 ○" ? "혈관이 유연하게 작동하고 있다. 기업 자금 조달에 경색 신호는 없다." : "확대되고 있다. 기업 자금 조달 비용이 증가하고 있다."}`;
    },
  },

  I6: { // 국채금리 → 심박수
    name: "국채금리", bodyPart: "심박수",
    "양호 ○": { metaphor: "심박수 안정", prefix: "심박수가 안정적이다." },
    "주의 ●": { metaphor: "심박수 상승", prefix: "심박수가 빨라지고 있다." },
    "경보 ★": { metaphor: "심박수 위험", prefix: "심박수가 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `심박수 안정. 자금 조달 비용 정상 범위.`,
      "주의 ●": (v,c) => `심박수 점진적 상승. 소상공인과 자영업의 자금 조달 비용 증가 중. 봉쇄 수준은 아님.`,
      "경보 ★": (v,c) => `심박수 위험 수준. 금리 급등으로 자금 조달 경색. H(돈맥경화) 트리거 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `국채금리(I6)가 ${v}로 전월 대비 ${c} 변동했다. ${grade === "양호 ○" ? '심박수가 안정적이다.' : '심박수가 빨라지고 있다.'}`;
    },
  },

  O1: { // 산업생산 → 근육 활력
    name: "산업생산", bodyPart: "근육",
    "양호 ○": { metaphor: "근육 활력 양호", prefix: "근육의 힘이 유지되고 있다." },
    "주의 ●": { metaphor: "근육 활력 약화", prefix: "근육이 뻣뻣해지기 시작했다." },
    "경보 ★": { metaphor: "근육 활력 저하", prefix: "근육이 뻣뻣해지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근육 활력 양호. 실물경제 생산 활동 정상.`,
      "주의 ●": (v,c) => `근육 활력 약화. 산업생산(${v}) 둔화는 미세석회 침착 초기 징후.`,
      "경보 ★": (v,c) => `근육 활력 급격 저하. 내수 기반 제조업의 미세석회 침착 가속 징후.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `가장 심각한 것은 산업생산(O1)이다. 전년 동기 대비 ${v}로, 근육이 뻣뻣해지고 있다. 미세석회(가계 빚이자)가 실물경제의 활력을 갉아먹고 있는 직접적 증거다.`;
      if (grade === "주의 ●") return `산업생산(O1)이 ${v}로 둔화세를 보이고 있다. 근육 활력이 약해지기 시작했다.`;
      return `산업생산(O1)이 ${v}로 양호한 수준을 유지하고 있다.`;
    },
  },

  O2: { // 물가 → 체온
    name: "물가", bodyPart: "체온",
    "양호 ○": { metaphor: "체온 안정", prefix: "체온이 안정적이다." },
    "주의 ●": { metaphor: "체온 미열", prefix: "체온이 다소 올라가 미열 수준이다." },
    "경보 ★": { metaphor: "체온 고열", prefix: "체온이 고열 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `체온 안정. 물가 목표 범위 내 정상 작동.`,
      "주의 ●": (v,c) => `체온 미열. 물가(${v}) 상승 추세에 서민 체감 물가는 헤드라인보다 높다.`,
      "경보 ★": (v,c) => `체온 고열. 물가(${v}) 급등은 A(물가폭등) 트리거 발동 위험. 배출 압력 축적 중.`,
    },
    narrativeTemplate: (v, c, grade) => {
      return `물가(O2)는 소비자물가 상승률 ${v}로, ${grade === "양호 ○" ? '한국은행 목표치 부합으로 체온이 안정되었다.' : grade === "주의 ●" ? '미열 수준이다.' : '고열 상태다.'}`;
    },
  },

  O3: { // 실업률 → 세포 괴사율
    name: "실업률", bodyPart: "세포괴사",
    "양호 ○": { metaphor: "세포 활력 양호", prefix: "세포(고용)가 건강하게 유지되고 있다." },
    "주의 ●": { metaphor: "세포 괴사 시작", prefix: "세포(일자리)가 죽어가기 시작했다." },
    "경보 ★": { metaphor: "세포 괴사 가속", prefix: "세포(일자리)가 빠르게 죽어가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `세포 활력 양호. 실업률(${v}) 완전고용 수준.`,
      "주의 ●": (v,c) => `세포 괴사 시작. 실업률(${v}) 상승은 미세석회가 세포를 죽이기 시작했다는 신호.`,
      "경보 ★": (v,c) => `세포 괴사 가속. 실업률(${v}) 급등은 시스템적 위기. 6M(단절) 경로 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade !== "양호 ○") return `실업률(O3)이 ${v}로 상승하며 세포(일자리)가 죽어가고 있다. 미세석회(가계 빚이자)가 경제 세포를 괴사시키는 직접적 증거다.`;
      return `실업률(O3)은 ${v}로 완전고용에 가까운 수준을 유지하고 있다. 세포(일자리) 활력은 양호하다.`;
    },
  },

  O4: { // 주가 → 혈색/안면
    name: "주가", bodyPart: "안면",
    "양호 ○": { metaphor: "혈색 안정", prefix: "혈색이 안정적이다." },
    "주의 ●": { metaphor: "안면 홍조", prefix: "안면이 붉게 달아오르고 있다." },
    "경보 ★": { metaphor: "안면 홍조 급성", prefix: "안면이 위험하게 달아올랐다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈색 안정. 급격한 변동 없이 안정적 순환 유지.`,
      "주의 ●": (v,c) => `안면 홍조. 주가 급등은 거시석회(자산버블) 팽창 신호.`,
      "경보 ★": (v,c) => `안면 홍조 급성. 자산버블 팽창이 실물경제와 괴리. 1M(폐열) 진입 잠재적 뇌관.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "주의 ●" || grade === "경보 ★") return `주가(O4)에서 ${grade === "경보 ★" ? "경보" : "주의"} 신호가 감지된다. 코스피가 ${v}를 기록하며 ${c} 변동했다. 안면이 붉게 달아오르고 있다.`;
      return `주가(O4)가 코스피 ${v}로 ${c} 변동하며 혈색이 안정적이다.`;
    },
  },

  O5: { // 주택가격 → 부종 수치
    name: "주택가격", bodyPart: "부종",
    "양호 ○": { metaphor: "부종 없음", prefix: "조직의 체액 균형이 정상이다." },
    "주의 ●": { metaphor: "부종 시작", prefix: "조직에 체액이 고이기 시작했다." },
    "경보 ★": { metaphor: "부종 심화", prefix: "조직이 심하게 부어올랐다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `부종 없음. 주택가격(${v}) 안정 범위. 거시석회(자산버블) 팽창 신호 없음.`,
      "주의 ●": (v,c) => `부종 시작. 주택가격(${v}) 상승은 거시석회 팽창 초기 징후.`,
      "경보 ★": (v,c) => `부종 심화. 주택가격(${v}) 급등은 거시석회 과잉 팽창. 5M(범파) 경로 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade !== "양호 ○") return `주택가격(O5)이 전월비 ${v} 변동하며 부종이 ${grade === "경보 ★" ? "심화되고" : "시작되고"} 있다. 거시석회(자산버블)가 부동산 부문에서 팽창하고 있다.`;
      return `주택가격(O5)은 전월비 ${v}로 안정적이다. 부종(자산버블) 신호는 관측되지 않는다.`;
    },
  },

  O6: { // 소비 → 손끝 체온
    name: "소비", bodyPart: "손끝",
    "양호 ○": { metaphor: "손끝 체온 유지", prefix: "말단 순환이 유지되고 있다." },
    "주의 ●": { metaphor: "손끝 체온 하락", prefix: "손끝 체온이 차가워지고 있다." },
    "경보 ★": { metaphor: "손끝 체온 경보", prefix: "손끝이 얼어붙고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => {
        const numVal = parseFloat(v);
        if (numVal < 0) return "손끝 체온 지속 하락. 미세석회 침착의 조용한 증거.";
        return "손끝 체온 유지. 소비 여력 정상 범위.";
      },
      "주의 ●": (v,c) => `손끝 체온 지속 하락. 미세석회 침착의 조용한 증거.`,
      "경보 ★": (v,c) => `손끝 체온 경보. 미세석회가 말단 순환을 심각하게 잠식. DLT 접근.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const numVal = parseFloat(v);
      if (numVal < 0) return `소비(O6)는 전월비 ${v}로 내수 부진이 이어지고 있다. 손끝 체온이 차갑다. 수출이 호조를 기록하는 동안 가계의 지갑은 닫혀 있다. 미세석회(가계 빚이자)가 말단의 소비 여력을 잠식한 결과다.`;
      return `소비(O6)는 전월비 ${v}로 내수가 안정적이다. 말단 순환이 유지되고 있다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 2. 무역/제조업 — 동맥 혈류 (S1~S3, T1~T3)
  // ════════════════════════════════════════════════════

  S1: { // 해운수지(백만$, T5_SHIPPING) → 동맥 맥박
    name: "해운수지", bodyPart: "동맥맥박", axis: 2,
    "양호 ○": { metaphor: "동맥 맥박 정상", prefix: "해운수지 흑자가 유지되며 무역 동맥의 맥박이 고르다." },
    "주의 ●": { metaphor: "동맥 맥박 약화", prefix: "해운수지가 축소되며 무역 동맥의 맥박이 약해지고 있다." },
    "경보 ★": { metaphor: "동맥 맥박 위험", prefix: "해운수지가 적자로 전환되며 무역 동맥 혈류가 역류하고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 맥박 정상. 해운수지(${v}백만$) 흑자 유지. 물류·무역 수지 순환 원활.`,
      "주의 ●": (v,c) => `동맥 맥박 약화. 해운수지(${v}백만$) 축소. 해상 물류 경쟁력 저하 초기 징후.`,
      "경보 ★": (v,c) => `동맥 맥박 위험. 해운수지(${v}백만$) 적자. 해운 비용이 수출 수익을 잠식.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `해운수지(S1)가 ${v}백만$로 적자가 됐다. 무역 동맥의 혈류가 역류하고 있다. 수출로 벌어들이는 것보다 해운 비용으로 나가는 것이 더 많다 — 동맥에서 피가 새고 있다. 해운 경쟁력 약화와 글로벌 운임 상승이 복합 작용한 결과다.`;
      if (grade === "주의 ●") return `해운수지(S1)가 ${v}백만$로 축소됐다. 무역 동맥의 맥박이 약해지고 있다. 해상 운임 상승 혹은 물동량 감소가 수지를 압박하는 초기 신호다.`;
      return `해운수지(S1)가 ${v}백만$로 흑자를 유지하고 있다. 무역 동맥의 맥박이 고르게 뛰고 있다. 해운 경쟁력이 유지되며 물류 혈류가 정상 순환하고 있다.`;
    },
  },

  S2: { // 야간광량 (항만/공단) → 동맥 활력
    name: "야간광량", bodyPart: "동맥활력", axis: 2,
    "양호 ○": { metaphor: "동맥 활력 양호", prefix: "항만·공단의 야간 활동이 활발하다." },
    "주의 ●": { metaphor: "동맥 활력 저하", prefix: "항만·공단의 야간 활동이 둔화되고 있다." },
    "경보 ★": { metaphor: "동맥 활력 위험", prefix: "항만·공단의 야간 활동이 급감했다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 활력 양호. 항만·공단 야간광량(${v}) 안정. 가동률 정상.`,
      "주의 ●": (v,c) => `동맥 활력 저하. 야간광량(${v}) 감소는 공단 가동률 하락 신호.`,
      "경보 ★": (v,c) => `동맥 활력 경보. 야간광량(${v}) 급감. 공단 셧다운 가능성.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `위성이 포착한 항만·공단 야간광량(S2)이 ${v} 급감했다. 동맥의 활력이 급속히 떨어지고 있다. 공장의 불이 꺼지면 수출의 심장이 멈추는 것이다.`;
      if (grade === "주의 ●") return `항만·공단 야간광량(S2)이 ${v} 감소했다. 동맥의 활력이 다소 저하되었다. 계절적 요인인지 구조적 위축인지 확인이 필요하다.`;
      return `항만·공단 야간광량(S2)이 ${v}로 안정적이다. 동맥의 활력이 유지되고 있다. 위성이 확인하는 실물 가동 신호다.`;
    },
  },

  S3: { // NO₂ 농도 (공단 상공) → 동맥 배기
    name: "NO₂농도", bodyPart: "동맥배기", axis: 2,
    "양호 ○": { metaphor: "동맥 배기 정상", prefix: "공단 상공의 배기가스 농도가 정상 가동을 시사한다." },
    "주의 ●": { metaphor: "동맥 배기 감소", prefix: "공단 상공의 배기가스가 줄어들며 생산 둔화를 시사한다." },
    "경보 ★": { metaphor: "동맥 배기 급감", prefix: "공단 상공의 배기가스가 급감하며 생산 중단 징후다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 배기 정상. NO₂ 농도(${v}) 안정. 제조업 가동 확인.`,
      "주의 ●": (v,c) => `동맥 배기 감소. NO₂(${v}) 하락은 공단 가동 위축 신호.`,
      "경보 ★": (v,c) => `동맥 배기 경보. NO₂(${v}) 급감. 공단 생산라인 중단 가능성.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `환경위성이 측정한 공단 상공 NO₂(S3)가 ${v} 급감했다. 공장이 돌아가면 배기가스가 나온다 — 배기가 사라진다는 것은 동맥이 멈추고 있다는 뜻이다.`;
      if (grade === "주의 ●") return `공단 상공 NO₂(S3)가 ${v} 감소했다. 동맥의 배기가 줄어들고 있다. 생산 둔화의 위성 증거다.`;
      return `공단 상공 NO₂(S3)가 ${v}로 정상 범위다. 동맥이 활발히 작동하며 배기를 내뿜고 있다. 위성이 확인하는 제조업 가동 지표다.`;
    },
  },

  T1: { // 수출입 컨테이너 TEU → 혈류 총량
    name: "컨테이너", bodyPart: "혈류총량", axis: 2,
    "양호 ○": { metaphor: "혈류 총량 정상", prefix: "수출입 물동량이 충분히 순환하고 있다." },
    "주의 ●": { metaphor: "혈류 총량 감소", prefix: "수출입 물동량이 줄어들며 혈류가 둔화되고 있다." },
    "경보 ★": { metaphor: "혈류 총량 위험", prefix: "수출입 물동량이 급감하며 혈류 부족 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈류 총량 정상. 컨테이너 물동량(${v}) 안정. 무역 순환 원활.`,
      "주의 ●": (v,c) => `혈류 총량 감소. TEU(${v}) 하락. 수출입 둔화 초기 단계.`,
      "경보 ★": (v,c) => `혈류 총량 경보. TEU(${v}) 급감. 무역 순환 위축 심화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `수출입 컨테이너(T1)가 ${v}로 급감했다. 동맥을 흐르는 혈류의 총량이 위험 수준으로 줄었다. 수출 의존 경제의 생명선이 가늘어지고 있다.`;
      if (grade === "주의 ●") return `수출입 컨테이너(T1)가 ${v}로 소폭 감소했다. 동맥의 혈류 총량이 다소 줄었다. 글로벌 수요 둔화가 한국 무역에 영향을 미치기 시작했다.`;
      return `수출입 컨테이너(T1)가 ${v}로 안정적이다. 동맥의 혈류 총량이 충분하다. 무역 순환이 원활하게 유지되고 있다.`;
    },
  },

  T2: { // 제조업 BSI/PMI → 제조 체감
    name: "제조업BSI", bodyPart: "제조체감", axis: 2,
    "양호 ○": { metaphor: "동맥 탄력 양호", prefix: "제조업 체감이 확장 국면이다." },
    "주의 ●": { metaphor: "동맥 탄력 저하", prefix: "제조업 체감이 위축 국면에 접어들고 있다." },
    "경보 ★": { metaphor: "동맥 탄력 경직", prefix: "제조업 체감이 급격히 위축되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 탄력 양호. BSI(${v}) 확장 국면. 제조업 자신감 유지.`,
      "주의 ●": (v,c) => `동맥 탄력 저하. BSI(${v}) 기준선 접근. 제조업 체감 위축 시작.`,
      "경보 ★": (v,c) => `동맥 탄력 경직. BSI(${v}) 급락. 제조업 심리 냉각.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `제조업 BSI(T2)가 ${v}로 급락했다. 동맥의 탄력이 경직되었다. 제조업 현장이 느끼는 체감 경기가 급속히 냉각되고 있다.`;
      if (grade === "주의 ●") return `제조업 BSI(T2)가 ${v}로 기준선에 근접했다. 동맥의 탄력이 다소 줄었다. 확장에서 위축으로 전환되는 경계에 있다.`;
      return `제조업 BSI(T2)가 ${v}로 확장 국면을 유지하고 있다. 동맥의 탄력이 양호하다. 제조업 현장의 자신감이 살아 있다.`;
    },
  },

  T3: { // 산업용 전력사용량 → 동맥 가동률
    name: "산업전력", bodyPart: "동맥가동률", axis: 2,
    "양호 ○": { metaphor: "동맥 가동률 정상", prefix: "산업용 전력이 정상적으로 소비되고 있다." },
    "주의 ●": { metaphor: "동맥 가동률 저하", prefix: "산업용 전력 사용이 줄어들며 가동률이 하락하고 있다." },
    "경보 ★": { metaphor: "동맥 가동률 위험", prefix: "산업용 전력 사용이 급감하며 가동률이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `동맥 가동률 정상. 산업전력(${v}) 안정. 제조라인 가동 확인.`,
      "주의 ●": (v,c) => `동맥 가동률 저하. 산업전력(${v}) 감소. 공장 가동 둔화 실측.`,
      "경보 ★": (v,c) => `동맥 가동률 경보. 산업전력(${v}) 급감. 제조라인 정지 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      const numVal = parseFloat(v);
      if (numVal < 0 || grade === "경보 ★") return `산업용 전력(T3)이 ${v} 감소했다. 전기는 거짓말을 하지 않는다 — 공장이 돌아가면 전기를 쓰고, 서면 꺼진다. 동맥의 가동률이 실측으로 하락 확인되었다.`;
      if (grade === "주의 ●") return `산업용 전력(T3)이 ${v}로 소폭 감소했다. 동맥의 가동률이 다소 떨어졌다. 전력사용량은 조작이 불가능한 실물 가동 지표다.`;
      return `산업용 전력(T3)이 ${v}로 안정적이다. 동맥의 가동률이 유지되고 있다. 전력거래소 데이터가 확인하는 실측 신호다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 3. 골목시장 — 미세혈관 (M1~M5)
  // ════════════════════════════════════════════════════

  M1: { // 재고지수 → 미세혈관 압력(재고 과잉은 생산 위축 신호)
    name: "재고지수", bodyPart: "내수재고압력", axis: 3,
    "양호 ○": { metaphor: "재고 정상 소화", prefix: "재고지수가 안정적이며 생산-소비 균형이 유지되고 있다." },
    "주의 ●": { metaphor: "재고 압력 상승", prefix: "재고가 쌓이며 생산 라인이 조여들고 있다." },
    "경보 ★": { metaphor: "재고 과잉 경보", prefix: "재고가 급증하며 생산 감축이 불가피한 상황이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `재고 정상 소화. 재고지수(${v}) 안정. 생산-소비 균형 유지.`,
      "주의 ●": (v,c) => `재고 압력 상승. 재고지수(${v}) 증가. 내수 소화 속도 둔화.`,
      "경보 ★": (v,c) => `재고 과잉 경보. 재고지수(${v}) 급증. 생산 감축·조업단축 압력.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `재고지수(O5)가 ${v} 급증했다. 팔리지 않는 재고가 쌓이고 있다. 재고 과잉은 생산 감축으로 이어지고, 생산 감축은 고용 축소로 연결된다 — 내수 위축의 악순환이 시작되는 신호다.`;
      if (grade === "주의 ●") return `재고지수(O5)가 ${v} 증가했다. 생산된 제품이 소비보다 빨리 쌓이고 있다. 재고가 늘면 기업은 생산을 줄이고, 그 결과는 고용과 임금에 직접 영향을 준다.`;
      return `재고지수(O5)가 ${v}로 안정적이다. 생산과 소비의 균형이 유지되고 있다. 재고 과잉 없이 내수 순환이 원활한 상태다.`;
    },
  },

  M2: { // 출하지수 → 내수 혈류량(출하=실물 소비 도달)
    name: "출하지수", bodyPart: "내수출하혈류", axis: 3,
    "양호 ○": { metaphor: "출하 혈류 정상", prefix: "출하지수가 안정적이며 생산물이 시장에 원활히 흐르고 있다." },
    "주의 ●": { metaphor: "출하 혈류 감소", prefix: "출하가 줄며 생산물의 시장 도달이 약해지고 있다." },
    "경보 ★": { metaphor: "출하 혈류 급감", prefix: "출하가 급감하며 내수 순환이 막히고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `출하 혈류 정상. 출하지수(${v}) 안정. 내수 공급 순환 유지.`,
      "주의 ●": (v,c) => `출하 혈류 감소. 출하지수(${v}) 하락. 내수 공급 위축 시작.`,
      "경보 ★": (v,c) => `출하 혈류 급감. 출하지수(${v}) 급락. 내수 공급 경색 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `출하지수(O6)가 ${v} 급감했다. 생산된 물건이 시장에 도달하지 못하고 있다. 출하 감소는 소비 감소의 실물 확인이다 — 통계보다 빠른 내수 경색 신호다.`;
      if (grade === "주의 ●") return `출하지수(O6)가 ${v} 감소했다. 내수 혈류가 약해지고 있다. 출하량 감소는 기업의 판매 둔화와 직결되며, 고용·임금 하락 압력으로 이어진다.`;
      return `출하지수(O6)가 ${v}로 안정적이다. 생산물이 시장에 원활히 흐르고 있다. 내수 공급 순환이 정상 수준을 유지하고 있다.`;
    },
  },

  M3: { // 산업생산지수 → 내수 산소교환(생산=경제 대사 활동량)
    name: "산업생산지수", bodyPart: "생산대사활동", axis: 3,
    "양호 ○": { metaphor: "생산 대사 정상", prefix: "산업생산이 유지되며 경제의 산소 교환이 원활하다." },
    "주의 ●": { metaphor: "생산 대사 둔화", prefix: "산업생산이 줄며 경제 대사가 느려지고 있다." },
    "경보 ★": { metaphor: "생산 대사 마비", prefix: "산업생산이 급감하며 경제 산소가 부족해지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `생산 대사 정상. 산업생산지수(${v}) 안정. 경제 활동량 유지.`,
      "주의 ●": (v,c) => `생산 대사 둔화. 산업생산지수(${v}) 감소. 경제 활동 위축 시작.`,
      "경보 ★": (v,c) => `생산 대사 마비. 산업생산지수(${v}) 급감. 산업 전반 활동 경색.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `산업생산지수(O3)가 ${v} 급감했다. 경제의 산소 교환이 거의 멈추고 있다. 전산업 생산이 동시에 줄어드는 것은 — 단순한 업황 부진이 아니라 경제 전체의 대사가 느려지는 신호다.`;
      if (grade === "주의 ●") return `산업생산지수(O3)가 ${v} 감소했다. 경제의 대사 활동이 둔화되고 있다. 생산 감소는 출하→재고→고용으로 이어지는 연쇄 위축의 시작점이다.`;
      return `산업생산지수(O3)가 ${v}로 안정적이다. 경제 대사 활동이 정상 수준을 유지하고 있다. 전산업 생산이 균형 있게 이루어지고 있다.`;
    },
  },

  M4: { // 설비가동률 → 생산 능력 활용도
    name: "설비가동률", bodyPart: "생산능력활용", axis: 3,
    "양호 ○": { metaphor: "설비 가동 정상", prefix: "설비가동률이 유지되며 생산 능력이 온전히 활용되고 있다." },
    "주의 ●": { metaphor: "설비 가동 저하", prefix: "가동률이 떨어지며 유휴 설비가 늘고 있다." },
    "경보 ★": { metaphor: "설비 가동 경보", prefix: "가동률이 급락하며 공장 라인이 멈추고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `설비 가동 정상. 설비가동률(${v}) 유지. 생산 능력 정상 활용.`,
      "주의 ●": (v,c) => `설비 가동 저하. 설비가동률(${v}) 하락. 유휴 설비 증가 시작.`,
      "경보 ★": (v,c) => `설비 가동 경보. 설비가동률(${v}) 급락. 공장 라인 가동 중단 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `설비가동률(O4)이 ${v} 급락했다. 공장 라인이 멈추고 있다. 가동률 하락은 수요 없는 생산 능력의 증거다 — 멈춘 설비는 곧 감원과 투자 철수로 이어진다.`;
      if (grade === "주의 ●") return `설비가동률(O4)이 ${v} 하락했다. 유휴 설비가 늘고 있다. 가동률 저하는 기업 수익성 악화와 직결되며, 투자 축소 압력으로 이어진다.`;
      return `설비가동률(O4)이 ${v}로 안정적이다. 생산 설비가 정상적으로 가동되고 있다. 산업 생산 능력이 효율적으로 활용되고 있다.`;
    },
  },

  M5: { // 상권 등급 변화 → 미세혈관 등급
    name: "상권등급", bodyPart: "미세혈관등급", axis: 3,
    "양호 ○": { metaphor: "미세혈관 등급 양호", prefix: "상권 등급이 유지·상승하며 혈관 건강이 양호하다." },
    "주의 ●": { metaphor: "미세혈관 등급 하락", prefix: "상권 등급이 하락하며 혈관 건강이 악화되고 있다." },
    "경보 ★": { metaphor: "미세혈관 등급 위험", prefix: "상권이 급격히 퇴화하며 혈관이 사라지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `미세혈관 등급 양호. 상권등급(${v}) 유지. 골목 상권 자생력 확인.`,
      "주의 ●": (v,c) => `미세혈관 등급 하락. 상권등급(${v}) 하향. 골목 위축 가속화 징후.`,
      "경보 ★": (v,c) => `미세혈관 등급 위험. 상권등급(${v}) 급락. 상권 소멸 단계 진입.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `상권 등급(M5)이 ${v} 급락했다. 미세혈관의 등급이 위험 수준이다. 등급 하락은 단순한 숫자가 아니라 그 골목에서 살아가는 사람들의 삶이 무너지고 있다는 뜻이다.`;
      if (grade === "주의 ●") return `상권 등급(M5)이 ${v} 하향되었다. 미세혈관의 등급이 떨어지고 있다. 상권 등급은 개폐업·유동인구·매출을 종합한 건강 지표로, 하락 추세가 이어지면 회복이 어렵다.`;
      return `상권 등급(M5)이 ${v}로 유지되고 있다. 미세혈관의 등급이 양호하다. 골목 상권의 종합 건강 지표가 안정적이다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 4. 부동산 X-ray — 뼈 (R1~R9)
  // ════════════════════════════════════════════════════

  R1: { // 아파트 실거래가 → 골밀도 수치
    name: "실거래가", bodyPart: "골밀도수치", axis: 4,
    "양호 ○": { metaphor: "골밀도 정상", prefix: "실거래가가 안정적이며 뼈의 밀도가 유지되고 있다." },
    "주의 ●": { metaphor: "골밀도 감소", prefix: "실거래가가 하락하며 뼈가 약해지기 시작했다." },
    "경보 ★": { metaphor: "골밀도 위험", prefix: "실거래가가 급락하며 골다공증이 진행되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `골밀도 정상. 실거래가(${v}) 안정. 부동산 자산 가치 유지.`,
      "주의 ●": (v,c) => `골밀도 감소. 실거래가(${v}) 하락. 자산 가치 침식 시작.`,
      "경보 ★": (v,c) => `골밀도 위험. 실거래가(${v}) 급락. 자산 골다공증 진행.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `아파트 실거래가(R1)가 ${v} 급락했다. 뼈의 밀도가 빠르게 빠지고 있다. 부동산은 가계 자산의 뼈대다 — 골밀도가 떨어지면 작은 충격에도 골절이 온다.`;
      if (grade === "주의 ●") return `아파트 실거래가(R1)가 ${v} 하락했다. 골밀도가 서서히 감소하고 있다. 아직 골절 수준은 아니지만, 뼈가 약해지는 추세를 주시해야 한다.`;
      return `아파트 실거래가(R1)가 ${v}로 안정적이다. 골밀도가 정상 범위를 유지하고 있다. 부동산 자산의 뼈대가 견고하다.`;
    },
  },

  R2: { // 시멘트 생산 → 건설 골격 강도(착공·건설 활동 선행지표)
    name: "시멘트생산", bodyPart: "건설골격강도", axis: 4,
    "양호 ○": { metaphor: "건설 골격 정상", prefix: "시멘트 생산이 유지되며 건설 활동이 정상적으로 이루어지고 있다." },
    "주의 ●": { metaphor: "건설 골격 약화", prefix: "시멘트 생산이 줄며 건설 활동이 위축되고 있다." },
    "경보 ★": { metaphor: "건설 골격 붕괴", prefix: "시멘트 생산이 급감하며 건설 착공이 사실상 멈추고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `건설 골격 정상. 시멘트생산(${v}) 안정. 착공·건설 활동 유지.`,
      "주의 ●": (v,c) => `건설 골격 약화. 시멘트생산(${v}) 감소. 건설 위축 시작.`,
      "경보 ★": (v,c) => `건설 골격 붕괴. 시멘트생산(${v}) 급감. 착공 경색 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `시멘트 생산(I2)이 ${v} 급감했다. 건설의 골격이 무너지고 있다. 시멘트는 거짓말하지 않는다 — 공사가 시작되면 시멘트가 쓰이고, 멈추면 창고에 쌓인다. 건설 투자 급감의 실물 신호다.`;
      if (grade === "주의 ●") return `시멘트 생산(I2)이 ${v} 감소했다. 건설 골격이 약해지고 있다. 건설 활동 위축은 건자재·인력·금융에 연쇄적으로 영향을 미친다.`;
      return `시멘트 생산(I2)이 ${v}로 안정적이다. 건설 골격이 견고하게 유지되고 있다. 착공과 건설 활동이 정상 수준이다.`;
    },
  },

  R3: { // 철강재 생산 → 건설/산업 구조체 강도
    name: "철강재생산", bodyPart: "구조체강도", axis: 4,
    "양호 ○": { metaphor: "구조체 강도 정상", prefix: "철강재 생산이 유지되며 건설·제조 기반이 탄탄하다." },
    "주의 ●": { metaphor: "구조체 강도 약화", prefix: "철강재 생산이 줄며 산업 구조체가 약해지고 있다." },
    "경보 ★": { metaphor: "구조체 강도 경보", prefix: "철강재 생산이 급감하며 건설·제조 기반이 흔들리고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `구조체 강도 정상. 철강재생산(${v}) 안정. 건설·제조 기반 유지.`,
      "주의 ●": (v,c) => `구조체 강도 약화. 철강재생산(${v}) 감소. 건설·제조 위축 시작.`,
      "경보 ★": (v,c) => `구조체 강도 경보. 철강재생산(${v}) 급감. 건설·제조 기반 경색.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `철강재 생산(I3)이 ${v} 급감했다. 산업 구조체가 흔들리고 있다. 철강은 건물·교량·자동차의 뼈대다 — 생산 급감은 건설과 제조업 동시 위축의 실물 신호다.`;
      if (grade === "주의 ●") return `철강재 생산(I3)이 ${v} 감소했다. 산업 구조체의 강도가 약해지고 있다. 철강 수요 감소는 건설 투자와 제조업 설비 투자 동반 위축을 의미한다.`;
      return `철강재 생산(I3)이 ${v}로 안정적이다. 산업 구조체가 정상 강도를 유지하고 있다. 건설·제조 기반이 견고하다.`;
    },
  },

  R4: { // 자동차 생산 → 제조 근력(수출·내수 복합 지표)
    name: "자동차생산", bodyPart: "제조근력", axis: 4,
    "양호 ○": { metaphor: "제조 근력 정상", prefix: "자동차 생산이 유지되며 제조 근력이 살아있다." },
    "주의 ●": { metaphor: "제조 근력 약화", prefix: "자동차 생산이 줄며 제조 근력이 빠지고 있다." },
    "경보 ★": { metaphor: "제조 근력 경보", prefix: "자동차 생산이 급감하며 제조업 근력이 심각하게 손상되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `제조 근력 정상. 자동차생산(${v}) 안정. 수출·내수 제조 유지.`,
      "주의 ●": (v,c) => `제조 근력 약화. 자동차생산(${v}) 감소. 제조업 위축 시작.`,
      "경보 ★": (v,c) => `제조 근력 경보. 자동차생산(${v}) 급감. 제조업 근력 손상 심각.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `자동차 생산(I4)이 ${v} 급감했다. 제조업 근력이 심각하게 손상되고 있다. 자동차는 수출과 내수를 동시에 반영하는 복합 지표다 — 생산 급감은 수출 둔화와 내수 위축이 동시에 진행되고 있다는 뜻이다.`;
      if (grade === "주의 ●") return `자동차 생산(I4)이 ${v} 감소했다. 제조 근력이 약해지고 있다. 자동차 생산은 부품·소재·물류 전 산업에 영향을 미치는 파급력 높은 지표다.`;
      return `자동차 생산(I4)이 ${v}로 안정적이다. 제조 근력이 정상적으로 유지되고 있다. 수출과 내수 수요가 균형 있게 뒷받침되고 있다.`;
    },
  },

  R5: { // 건물 높이 변화 (SAR) → X-ray 공정률
    name: "SAR높이", bodyPart: "X-ray공정률", axis: 4,
    "양호 ○": { metaphor: "X-ray 공정률 일치", prefix: "SAR 측정 건물 높이가 공식 공정률과 일치한다." },
    "주의 ●": { metaphor: "X-ray 공정률 괴리", prefix: "SAR 높이 변화와 공식 공정률 사이에 괴리가 감지되었다." },
    "경보 ★": { metaphor: "X-ray 공정률 허위", prefix: "SAR가 보여주는 현실과 공식 공정률이 완전히 다르다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `X-ray 공정률 일치. SAR 높이(${v}) 정상. 건설 진행 확인.`,
      "주의 ●": (v,c) => `X-ray 공정률 괴리. SAR 높이(${v}) 불일치. 공정률 과대보고 의심.`,
      "경보 ★": (v,c) => `X-ray 공정률 허위. SAR 높이(${v}) 정지. 공사 중단 은폐 경보.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `SAR 건물 높이(R5)가 ${v}로 변화가 없다. 공식 공정률은 진행 중이라 보고했지만, 위성 X-ray는 공사가 멈춰있다고 말한다. 서류는 조작할 수 있지만 위성은 거짓말을 못 한다.`;
      if (grade === "주의 ●") return `SAR 건물 높이(R5)가 ${v}로 공식 공정률과 괴리가 있다. X-ray 판독 결과 공정률이 과대 보고되었을 가능성이 있다.`;
      return `SAR 건물 높이(R5)가 ${v}로 공식 공정률과 일치한다. X-ray 상 건설이 정상적으로 진행 중이다.`;
    },
  },

  R6: { // 도시열섬이상(UHI °C, R6_UHI) → 체온계 (Landsat 위성)
    name: "도시열섬이상", bodyPart: "체온계위성", axis: 4,
    "양호 ○": { metaphor: "체온 정상", prefix: "도시 열섬 강도가 기준치 이하로 도시 체온이 정상이다." },
    "주의 ●": { metaphor: "체온 상승", prefix: "도시 열섬 강도가 높아지며 체온이 상승하고 있다." },
    "경보 ★": { metaphor: "고열 감지", prefix: "도시 열섬이 극단적이며 고열이 감지된다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `체온 정상. 도시열섬(${v}) 정상. 냉각 인프라 작동.`,
      "주의 ●": (v,c) => `체온 상승. 도시열섬(${v}) 상승. 과밀·에너지 소비 과다.`,
      "경보 ★": (v,c) => `고열 감지. 도시열섬(${v}) 극단. 열 취약계층 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `도시열섬이상(R6)이 ${v}로 극단적이다. 위성(Landsat)이 측정한 도시 표면온도가 급등했다. 고열은 에너지 소비 과다·녹지 부족·과밀 집적의 복합 신호다.`;
      if (grade === "주의 ●") return `도시열섬이상(R6)이 ${v}로 상승하고 있다. 도시 체온이 정상보다 높다. 과밀 개발과 녹지 감소가 원인이다.`;
      return `도시열섬이상(R6)이 ${v}로 정상 범위다. 도시 체온이 유지되고 있다.`;
    },
  },

  R7: { // 주차장 점유율 → X-ray 생활흔적
    name: "주차점유", bodyPart: "X-ray생활흔적", axis: 4,
    "양호 ○": { metaphor: "생활흔적 확인", prefix: "주차장 점유율이 정상이며 실제 거주가 확인된다." },
    "주의 ●": { metaphor: "생활흔적 희미", prefix: "주차장 점유율이 낮으며 거주 실태가 의심된다." },
    "경보 ★": { metaphor: "생활흔적 소멸", prefix: "주차장이 텅 비어있다. 거주 실태와 보고가 불일치한다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `생활흔적 확인. 주차점유(${v}) 정상. 실거주 확인.`,
      "주의 ●": (v,c) => `생활흔적 희미. 주차점유(${v}) 저조. 공실 의심.`,
      "경보 ★": (v,c) => `생활흔적 소멸. 주차점유(${v}) 극저. 유령단지 2차 확인.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `주차장 점유율(R7)이 ${v}로 텅 비어있다. 위성이 내려다본 주차장에 차가 없다. 야간광(R6)과 함께 유령단지를 이중으로 확인하는 2차 X-ray다.`;
      if (grade === "주의 ●") return `주차장 점유율(R7)이 ${v}로 예상보다 낮다. 생활흔적이 희미하다. 공식 입주율과 실제 거주 사이에 간극이 있을 수 있다.`;
      return `주차장 점유율(R7)이 ${v}로 정상이다. 위성으로 확인한 생활흔적이 뚜렷하다.`;
    },
  },

  R8: { // 건물 표면온도 → X-ray 체온
    name: "표면온도", bodyPart: "X-ray체온", axis: 4,
    "양호 ○": { metaphor: "건물 체온 정상", prefix: "건물 표면온도가 정상이며 난방·사용이 확인된다." },
    "주의 ●": { metaphor: "건물 체온 저하", prefix: "건물 표면온도가 낮으며 사용률이 의심된다." },
    "경보 ★": { metaphor: "건물 체온 소실", prefix: "건물이 차갑다. 난방이 되지 않는 빈 건물이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `건물 체온 정상. 표면온도(${v}) 안정. 사용·거주 확인.`,
      "주의 ●": (v,c) => `건물 체온 저하. 표면온도(${v}) 낮음. 공실 확대 의심.`,
      "경보 ★": (v,c) => `건물 체온 소실. 표면온도(${v}) 극저. 빈 건물 3차 확인.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `건물 표면온도(R8)가 ${v}로 주변 건물 대비 현저히 낮다. 열적외선 위성이 측정한 건물의 체온이 사라졌다. 야간광(R6)·주차(R7)·체온(R8) 세 가지 X-ray가 모두 같은 진단을 내린다.`;
      if (grade === "주의 ●") return `건물 표면온도(R8)가 ${v}로 다소 낮다. 건물의 체온이 저하되고 있다. 난방 사용이 줄었다는 뜻이다.`;
      return `건물 표면온도(R8)가 ${v}로 정상이다. 건물의 체온이 유지되고 있다. 난방·사용이 확인된다.`;
    },
  },

  R9: { // 괴리 경보 → X-ray 판독 종합
    name: "괴리경보", bodyPart: "X-ray판독종합", axis: 4,
    "양호 ○": { metaphor: "X-ray 판독 일치", prefix: "공식 통계와 위성 신호가 일치한다. 조작 징후 없음." },
    "주의 ●": { metaphor: "X-ray 판독 괴리", prefix: "공식 통계와 위성 신호 사이에 괴리가 감지되었다." },
    "경보 ★": { metaphor: "X-ray 판독 경보", prefix: "공식 통계가 위성 현실과 정반대다. 조작 또는 구조문제." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `X-ray 판독 일치. 괴리경보(${v}) 미발동. 부동산 데이터 신뢰 가능.`,
      "주의 ●": (v,c) => `X-ray 판독 괴리. 괴리경보(${v}) 감지. 통계 교차검증 필요.`,
      "경보 ★": (v,c) => `X-ray 판독 경보. 괴리경보(${v}) 발동. 2개월 이상 지속 괴리 — 구조문제.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `괴리 경보(R9)가 ${v}로 발동되었다. 공식 통계와 위성 X-ray가 2개월 이상 반대 방향을 가리키고 있다. 단발 괴리는 노이즈이지만, 지속 괴리는 조작이거나 구조적 문제다.`;
      if (grade === "주의 ●") return `괴리 경보(R9)가 ${v}로 감지 상태다. 일부 지표에서 공식 통계와 위성 신호가 어긋나고 있다. 아직 경보 수준은 아니지만 교차검증이 필요하다.`;
      return `괴리 경보(R9)가 ${v}로 미발동이다. X-ray 판독 결과 공식 통계와 위성 신호가 일치한다. 서류와 현실이 같은 방향이다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 5. 소비심리 — 신경/통증자각 (L5=S2_CSI)
  // ════════════════════════════════════════════════════

  L1: { // 고용동향 → 근력
    name: "고용동향", bodyPart: "근력", axis: 8,
    "양호 ○": { metaphor: "근력 정상", prefix: "고용이 안정적이며 경제의 근력이 유지되고 있다." },
    "주의 ●": { metaphor: "근력 저하", prefix: "고용이 둔화되며 경제의 근력이 약해지고 있다." },
    "경보 ★": { metaphor: "근력 상실", prefix: "고용이 급격히 악화되며 경제의 근력이 빠지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근력 정상. 고용(${v}) 안정. 노동시장 순환 유지.`,
      "주의 ●": (v,c) => `근력 저하. 고용(${v}) 둔화. 일자리 창출 감소.`,
      "경보 ★": (v,c) => `근력 상실. 고용(${v}) 급감. 대량 실업 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `고용동향(L1)이 ${v} 급감했다. 경제의 근력이 빠지고 있다. 일자리는 경제의 근육이다 — 근육이 사라지면 몸을 지탱할 수 없다. 소비와 세수가 동시에 무너진다.`;
      if (grade === "주의 ●") return `고용동향(L1)이 ${v} 둔화했다. 경제의 근력이 약해지고 있다. 신규 채용이 줄고 계약직 전환이 늘어나는 것은 근육이 지방으로 바뀌는 것과 같다.`;
      return `고용동향(L1)이 ${v}로 안정적이다. 경제의 근력이 유지되고 있다. 노동시장이 정상적으로 순환하고 있다.`;
    },
  },

  L2: { // 경제활동참가율변동(L2_PARTICIPATION) → 호흡 깊이
    name: "경활율변동", bodyPart: "호흡깊이", axis: 8,
    "양호 ○": { metaphor: "호흡 깊음", prefix: "경제활동참가율이 상승하며 노동시장 호흡이 깊어지고 있다." },
    "주의 ●": { metaphor: "호흡 얕아짐", prefix: "경제활동참가율이 정체되며 노동시장 호흡이 얕아지고 있다." },
    "경보 ★": { metaphor: "호흡 급감", prefix: "경제활동참가율이 하락하며 노동시장 호흡이 끊기고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `호흡 깊음. 경활율(${v}) 상승. 더 많은 인구가 노동시장 참여.`,
      "주의 ●": (v,c) => `호흡 얕아짐. 경활율(${v}) 정체. 구직 포기자 발생 우려.`,
      "경보 ★": (v,c) => `호흡 급감. 경활율(${v}) 하락. 대규모 구직 단념 진행 중.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `경제활동참가율(L2)이 ${v} 하락했다. 노동시장의 호흡이 끊기고 있다. 참가율 하락은 근육이 몸 안으로 줄어드는 것과 같다 — 숨을 쉬지 않으면 근육도 살도 사라진다. 구직 단념자 급증은 통계 실업률을 낮게 보이게 만드는 함정이다.`;
      if (grade === "주의 ●") return `경제활동참가율(L2)이 ${v} 정체됐다. 노동시장 호흡이 얕아지고 있다. 일할 의지를 잃기 시작한 사람들이 통계 밖으로 빠져나가고 있다.`;
      return `경제활동참가율(L2)이 ${v}로 상승했다. 노동시장의 호흡이 깊어지고 있다. 더 많은 인구가 경제에 참여하며 생산 가능 인력이 늘고 있다.`;
    },
  },

  L3: { // 임금(전년비) → 근육 탄력 [L3_WAGE: ECOS 901Y027, MoM%]
    name: "임금(전년비)", bodyPart: "근육탄력", axis: 8,
    "양호 ○": { metaphor: "근육 탄력 정상", prefix: "임금이 상승하며 근육의 탄력이 유지되고 있다." },
    "주의 ●": { metaphor: "근육 탄력 저하", prefix: "임금 상승이 둔화되며 근육의 탄력이 저하되고 있다." },
    "경보 ★": { metaphor: "근육 경직", prefix: "임금이 하락하며 근육이 경직되고 있다. 소비 여력이 직접 축소된다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `근육 탄력 정상. 임금(${v}) 상승. 실질구매력 유지.`,
      "주의 ●": (v,c) => `근육 탄력 저하. 임금(${v}) 정체. 실질임금 하락 위험.`,
      "경보 ★": (v,c) => `근육 경직. 임금(${v}) 하락. 가계 소비 여력 축소.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `임금(L3)이 ${v}로 하락했다. 근육이 경직되고 있다. 소득이 줄면 소비가 줄고, 소비가 줄면 생산이 줄어든다 — 하방 악순환의 첫 단추다.`;
      if (grade === "주의 ●") return `임금(L3)이 ${v}로 정체됐다. 근육의 탄력이 저하되고 있다. 실질임금이 물가 상승률에 못 미치면 생활수준이 하락한다.`;
      return `임금(L3)이 ${v}로 상승했다. 근육의 탄력이 유지되고 있다. 실질구매력이 받쳐지며 소비 기반이 견고하다.`;
    },
  },

  L4: { // 연체율 → 신경 손상
    name: "연체율", bodyPart: "신경손상", axis: 8,
    "양호 ○": { metaphor: "신경 정상", prefix: "연체율이 낮으며 신경 전달이 정상이다." },
    "주의 ●": { metaphor: "신경 이상", prefix: "연체율이 상승하며 신경에 이상 신호가 감지된다." },
    "경보 ★": { metaphor: "신경 마비", prefix: "연체율이 급등하며 신경이 마비되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `신경 정상. 연체율(${v}) 안정. 금융 신경 전달 원활.`,
      "주의 ●": (v,c) => `신경 이상. 연체율(${v}) 상승. 가계 상환 능력 약화.`,
      "경보 ★": (v,c) => `신경 마비. 연체율(${v}) 급등. 연쇄 디폴트 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `연체율(L4)이 ${v} 급등했다. 신경이 마비되고 있다. 연체는 근육(가계)이 보내는 마지막 SOS다 — 더 이상 갚을 수 없다는 신경 신호가 금융 시스템 전체로 전파된다.`;
      if (grade === "주의 ●") return `연체율(L4)이 ${v} 상승했다. 신경에 이상 신호가 감지된다. 가계의 상환 능력이 약화되기 시작했다.`;
      return `연체율(L4)이 ${v}로 안정적이다. 신경이 정상 작동 중이다. 가계의 금융 건강이 유지되고 있다.`;
    },
  },

  L5: { // 체감경기 CSI → 통증 자각
    name: "체감경기", bodyPart: "통증자각", axis: 5,
    "양호 ○": { metaphor: "통증 자각 없음", prefix: "체감경기가 양호하며 국민이 통증을 느끼지 않는다." },
    "주의 ●": { metaphor: "통증 자각 시작", prefix: "체감경기가 악화되며 국민이 통증을 느끼기 시작했다." },
    "경보 ★": { metaphor: "극심한 통증 자각", prefix: "체감경기가 급락하며 국민이 극심한 통증을 호소한다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `통증 자각 없음. CSI(${v}) 안정. 국민 체감경기 양호.`,
      "주의 ●": (v,c) => `통증 자각 시작. CSI(${v}) 하락. 체감 불황 진입.`,
      "경보 ★": (v,c) => `극심한 통증 자각. CSI(${v}) 급락. 국민 생활고 심화.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `체감경기 CSI(L5)가 ${v} 급락했다. 극심한 통증을 자각하고 있다. 통계가 정상이라 해도 국민이 아프다고 말하면 아픈 것이다 — CSI는 경제의 통증 자가진단이다.`;
      if (grade === "주의 ●") return `체감경기 CSI(L5)가 ${v} 하락했다. 통증을 자각하기 시작했다. 거시 지표와 체감 사이의 괴리가 벌어지고 있다.`;
      return `체감경기 CSI(L5)가 ${v}로 안정적이다. 통증 자각이 없다. 국민의 경기 체감이 양호하다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 9. 대외수지 — 외화혈관 (G1~G7) [gauge-adapter Axis9 배정]
  // ════════════════════════════════════════════════════

  G1: { // 서비스수지(FDI대리, T3_FDI) → 외화 유입맥
    name: "서비스수지", bodyPart: "외화유입맥", axis: 9,
    "양호 ○": { metaphor: "외화 유입 정상", prefix: "서비스수지가 흑자를 유지하며 외화가 유입되고 있다." },
    "주의 ●": { metaphor: "외화 유입 둔화", prefix: "서비스수지가 악화되며 외화 유입이 줄어들고 있다." },
    "경보 ★": { metaphor: "외화 유출", prefix: "서비스수지 적자가 확대되며 외화가 빠져나가고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `외화 유입 정상. 서비스수지(${v}) 흑자. 관광·지적재산권·FDI 유입 양호.`,
      "주의 ●": (v,c) => `외화 유입 둔화. 서비스수지(${v}) 악화. 서비스교역 경쟁력 저하.`,
      "경보 ★": (v,c) => `외화 유출 경보. 서비스수지(${v}) 적자 확대. 서비스교역 구조적 취약.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `서비스수지(G1)가 ${v}로 적자가 확대됐다. 외화가 빠져나가고 있다. 관광·지적재산권·금융서비스 등 비가시 무역에서의 취약성이 드러나고 있다.`;
      if (grade === "주의 ●") return `서비스수지(G1)가 ${v}로 악화되고 있다. 외화 유입이 줄어드는 신호다.`;
      return `서비스수지(G1)가 ${v}로 안정적이다. 외화 유입이 정상 범위에서 유지되고 있다.`;
    },
  },

  G2: { // 운송수지(화물, I5_CARGO) → 물류 혈관
    name: "운송수지", bodyPart: "물류혈관", axis: 9,
    "양호 ○": { metaphor: "물류 혈관 정상", prefix: "운송수지가 흑자를 유지하며 물류 혈관이 원활하다." },
    "주의 ●": { metaphor: "물류 혈관 약화", prefix: "운송수지가 악화되며 물류 혈관이 약해지고 있다." },
    "경보 ★": { metaphor: "물류 혈관 막힘", prefix: "운송수지 적자가 확대되며 물류 혈관이 막히고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `물류 혈관 정상. 운송수지(${v}) 흑자. 화물운송 수익 양호.`,
      "주의 ●": (v,c) => `물류 혈관 약화. 운송수지(${v}) 악화. 해운·항공 경쟁력 저하.`,
      "경보 ★": (v,c) => `물류 혈관 경보. 운송수지(${v}) 적자. 운송비 지출 급증.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `운송수지(G2)가 ${v}로 적자가 확대됐다. 물류 혈관이 막히고 있다. 수출의 물리적 통로에 비용이 누적되면 수출 경쟁력이 직접 훼손된다.`;
      if (grade === "주의 ●") return `운송수지(G2)가 ${v}로 악화되고 있다. 화물 운송 비용이 늘어나는 신호다.`;
      return `운송수지(G2)가 ${v}로 안정적이다. 물류 혈관이 정상 작동 중이다.`;
    },
  },

  G3: { // 항공운송수지(I6_AIRPORT) → 항공 혈관
    name: "항공수지", bodyPart: "항공혈관", axis: 9,
    "양호 ○": { metaphor: "항공 혈관 정상", prefix: "항공운송수지가 흑자를 유지하며 항공 물류가 원활하다." },
    "주의 ●": { metaphor: "항공 혈관 약화", prefix: "항공운송수지가 악화되며 항공 물류가 둔화되고 있다." },
    "경보 ★": { metaphor: "항공 혈관 막힘", prefix: "항공운송수지 적자가 확대되며 항공 물류가 막히고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `항공 혈관 정상. 항공수지(${v}) 흑자. 여객·화물 항공 수익 양호.`,
      "주의 ●": (v,c) => `항공 혈관 약화. 항공수지(${v}) 악화. 항공 운송비 상승.`,
      "경보 ★": (v,c) => `항공 혈관 경보. 항공수지(${v}) 적자. 항공 운송 구조적 취약.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `항공운송수지(G3)가 ${v}로 적자가 확대됐다. 항공 혈관이 막히고 있다. 반도체·첨단제품 등 고부가가치 항공화물 경로가 취약해지고 있다.`;
      if (grade === "주의 ●") return `항공운송수지(G3)가 ${v}로 악화되고 있다. 항공 물류 비용이 증가하는 신호다.`;
      return `항공운송수지(G3)가 ${v}로 안정적이다. 항공 물류가 정상 작동 중이다.`;
    },
  },

  G4: { // 운수창고취업자(I7_RAILROAD) → 물류 근육
    name: "운수취업자", bodyPart: "물류근육", axis: 9,
    "양호 ○": { metaphor: "물류 근육 정상", prefix: "운수·창고업 취업자가 증가하며 물류 근육이 강화되고 있다." },
    "주의 ●": { metaphor: "물류 근육 약화", prefix: "운수·창고업 취업자가 감소하며 물류 근육이 약해지고 있다." },
    "경보 ★": { metaphor: "물류 근육 마비", prefix: "운수·창고업 취업자가 급감하며 물류 근육이 마비 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `물류 근육 정상. 운수취업자(${v}) 증가. 물류 노동력 안정.`,
      "주의 ●": (v,c) => `물류 근육 약화. 운수취업자(${v}) 감소. 물류 인프라 약화.`,
      "경보 ★": (v,c) => `물류 근육 마비. 운수취업자(${v}) 급감. 물류 인프라 붕괴.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `운수·창고업 취업자(G4)가 ${v}로 급감했다. 물류 근육이 마비 수준이다. 물류 인프라를 지탱하는 사람이 떠나면 공급망은 서서히 멈춘다.`;
      if (grade === "주의 ●") return `운수·창고업 취업자(G4)가 ${v}로 감소하고 있다. 물류 근육이 약해지는 신호다.`;
      return `운수·창고업 취업자(G4)가 ${v}로 안정적이다. 물류 근육이 정상 작동 중이다.`;
    },
  },

  G5: { // 미국경기(OECD CLI, E2_US_PMI) → 외부 산소
    name: "미국경기", bodyPart: "외부산소", axis: 9,
    "양호 ○": { metaphor: "외부 산소 풍부", prefix: "미국 경기가 호조를 보이며 외부 산소가 풍부하다." },
    "주의 ●": { metaphor: "외부 산소 감소", prefix: "미국 경기가 둔화되며 외부 산소가 줄어들고 있다." },
    "경보 ★": { metaphor: "외부 산소 부족", prefix: "미국 경기가 위축되며 외부 산소가 부족해지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `외부 산소 풍부. 미국PMI(${v}) 호조. 수출 수요 증가.`,
      "주의 ●": (v,c) => `외부 산소 감소. 미국PMI(${v}) 둔화. 수출 수요 약화 신호.`,
      "경보 ★": (v,c) => `외부 산소 부족. 미국PMI(${v}) 위축. 수출 수요 급감 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `미국 경기(G5)가 ${v}로 위축됐다. 외부 산소가 부족해지고 있다. 한국 수출의 최대 엔진인 미국 수요가 꺼지면 한국 호흡계 전체가 흔들린다.`;
      if (grade === "주의 ●") return `미국 경기(G5)가 ${v}로 둔화되고 있다. 외부 산소 공급이 줄어드는 신호다.`;
      return `미국 경기(G5)가 ${v}로 호조를 보이고 있다. 외부 산소가 풍부하다.`;
    },
  },

  G6: { // 야간광량(위성, S3_NIGHTLIGHT) → 재생 활력 위성
    name: "야간광량", bodyPart: "재생활력위성", axis: 9,
    "양호 ○": { metaphor: "야간 활력 정상", prefix: "야간광량이 기준치를 유지하며 경제 활력이 정상이다." },
    "주의 ●": { metaphor: "야간 활력 감소", prefix: "야간광량이 줄어들며 경제 활력이 저하되고 있다." },
    "경보 ★": { metaphor: "야간 활력 소실", prefix: "야간광량이 크게 감소하며 경제 활력이 심각하게 위축됐다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `야간 활력 정상. 야간광(${v}) 기준치 이상. 경제 활동 정상.`,
      "주의 ●": (v,c) => `야간 활력 감소. 야간광(${v}) 기준 이하. 경제 활동 둔화.`,
      "경보 ★": (v,c) => `야간 활력 소실. 야간광(${v}) 급감. 경제 활동 심각 위축.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `야간광량(G6)이 ${v}로 크게 감소했다. 위성이 찍은 한반도의 밤이 어두워지고 있다. 야간광은 GDP 통계가 잡지 못하는 실제 경제 활동을 측정하는 가장 정직한 지표다.`;
      if (grade === "주의 ●") return `야간광량(G6)이 ${v}로 감소하고 있다. 경제 활력이 저하되는 위성 신호다.`;
      return `야간광량(G6)이 ${v}로 정상 범위다. 경제 활력이 유지되고 있다.`;
    },
  },

  G7: { // 특구별 투자유치 → 재활치료 [orphan: gauge-adapter 미배정]
    name: "특구투자", bodyPart: "재활치료", axis: 9,
    "양호 ○": { metaphor: "재활 치료 진행", prefix: "특구 투자유치가 활발하며 편마비 재활이 진행되고 있다." },
    "주의 ●": { metaphor: "재활 치료 부진", prefix: "특구 투자유치가 부진하며 재활이 정체되고 있다." },
    "경보 ★": { metaphor: "재활 치료 실패", prefix: "특구 투자유치가 거의 없으며 재활이 실패하고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `재활 치료 진행. 특구투자(${v}) 활발. 지방 회복 동력 확보.`,
      "주의 ●": (v,c) => `재활 치료 부진. 특구투자(${v}) 부진. 지방 회복 정체.`,
      "경보 ★": (v,c) => `재활 치료 실패. 특구투자(${v}) 미미. 지방 재활 포기 상태.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `특구 투자유치(G7)가 ${v}로 거의 없다. 재활 치료가 실패하고 있다. 편마비를 치료하려면 약해진 쪽에 집중 투자해야 하는데, 그 치료 자체가 작동하지 않고 있다.`;
      if (grade === "주의 ●") return `특구 투자유치(G7)가 ${v}로 부진하다. 재활 치료가 정체되고 있다. 지방에 새로운 혈류를 공급하는 통로가 막히고 있다.`;
      return `특구 투자유치(G7)가 ${v}로 활발하다. 재활 치료가 진행 중이다. 편마비 회복의 동력이 확보되고 있다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 7. 금융 스트레스 — 혈액의 질 (F1~F5)
  // ════════════════════════════════════════════════════

  F1: { // 회사채 스프레드 → 혈액 점도
    name: "회사채스프레드", bodyPart: "혈액점도", axis: 7,
    "양호 ○": { metaphor: "혈액 점도 정상", prefix: "회사채 스프레드가 안정적이며 혈액이 맑다." },
    "주의 ●": { metaphor: "혈액 점도 상승", prefix: "회사채 스프레드가 확대되며 혈액이 끈적해지고 있다." },
    "경보 ★": { metaphor: "혈전 위험", prefix: "회사채 스프레드가 급등하며 혈전이 형성될 위험이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈액 점도 정상. 스프레드(${v}) 안정. 기업 자금조달 원활.`,
      "주의 ●": (v,c) => `혈액 점도 상승. 스프레드(${v}) 확대. 기업 자금조달 비용 증가.`,
      "경보 ★": (v,c) => `혈전 위험. 스프레드(${v}) 급등. 기업 자금경색 임박.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `회사채 스프레드(F1)가 ${v} 급등했다. 혈액에 혈전이 형성될 위험이다. AA등급과 BBB등급의 금리 차이가 벌어진다는 것은 시장이 신용위험을 급격히 재평가하고 있다는 뜻이다 — 피가 굳기 시작한 것이다.`;
      if (grade === "주의 ●") return `회사채 스프레드(F1)가 ${v} 확대되었다. 혈액의 점도가 올라가고 있다. 기업들의 자금조달 비용이 늘어나고 있다.`;
      return `회사채 스프레드(F1)가 ${v}로 안정적이다. 혈액의 점도가 정상이다. 기업 자금시장이 원활하게 순환하고 있다.`;
    },
  },

  F2: { // CP 금리 → 혈중 독소
    name: "CP금리", bodyPart: "혈중독소", axis: 7,
    "양호 ○": { metaphor: "혈중 독소 정상", prefix: "CP 금리가 안정적이며 단기 자금시장이 깨끗하다." },
    "주의 ●": { metaphor: "혈중 독소 상승", prefix: "CP 금리가 올라가며 단기 자금시장에 독소가 쌓이고 있다." },
    "경보 ★": { metaphor: "혈중 독소 위험", prefix: "CP 금리가 급등하며 단기 자금시장이 오염되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈중 독소 정상. CP금리(${v}) 안정. 단기 유동성 충분.`,
      "주의 ●": (v,c) => `혈중 독소 상승. CP금리(${v}) 상승. 단기 자금 경색 시작.`,
      "경보 ★": (v,c) => `혈중 독소 위험. CP금리(${v}) 급등. 단기 자금시장 마비.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `CP 금리(F2)가 ${v} 급등했다. 혈중 독소가 위험 수준이다. 기업어음 금리는 기업의 '오늘 내일'을 보여준다 — 이 금리가 뛰면 내일 월급을 줄 돈이 없다는 뜻이다.`;
      if (grade === "주의 ●") return `CP 금리(F2)가 ${v} 상승했다. 혈중 독소가 쌓이고 있다. 단기 자금시장에 경색 조짐이 나타나고 있다.`;
      return `CP 금리(F2)가 ${v}로 안정적이다. 혈중 독소가 정상 수준이다. 단기 자금시장이 원활하다.`;
    },
  },

  F3: { // VIX 공포지수 전일비(%) → 혈액 공포온도
    name: "VIX공포지수", bodyPart: "혈액공포온도", axis: 7,
    "양호 ○": { metaphor: "공포 안정", prefix: "VIX가 안정적이며 금융 시스템의 공포 온도가 낮다." },
    "주의 ●": { metaphor: "공포 상승", prefix: "VIX가 상승하며 시장 공포가 증가하고 있다." },
    "경보 ★": { metaphor: "공포 급등", prefix: "VIX가 급등하며 금융 시스템이 공포 발작 상태다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `공포 안정. VIX(${v}) 안정. 시장 불안 없음.`,
      "주의 ●": (v,c) => `공포 상승. VIX(${v}) 상승. 리스크 경계 단계.`,
      "경보 ★": (v,c) => `공포 급등. VIX(${v}) 급등. 금융 발작 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `VIX 공포지수(F3)가 ${v}로 급등했다. 시장 공포가 발작 수준이다. VIX는 금융 시스템의 체온계다 — 급등하면 자본이 도망치고 실물경제까지 얼어붙는다.`;
      if (grade === "주의 ●") return `VIX 공포지수(F3)가 ${v}로 상승하고 있다. 시장 불안이 커지고 있다. 리스크 회피 심리가 확산되는 초기 신호다.`;
      return `VIX 공포지수(F3)가 ${v}로 안정적이다. 시장 공포 온도가 낮다. 금융 시스템이 안정적이다.`;
    },
  },

  F4: { // 코스닥 거래량(천주, F7_KOSDAQ_VOL) → 혈액량
    name: "코스닥거래량", bodyPart: "혈액량", axis: 7,
    "양호 ○": { metaphor: "혈액량 정상", prefix: "코스닥 거래량이 정상이며 시장 혈액이 순환하고 있다." },
    "주의 ●": { metaphor: "혈액량 감소", prefix: "코스닥 거래량이 감소하며 시장 혈액이 줄어들고 있다." },
    "경보 ★": { metaphor: "혈액량 급감", prefix: "코스닥 거래량이 급감하며 시장 혈액이 고갈되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `혈액량 정상. 거래량(${v}) 정상. 시장 유동성 양호.`,
      "주의 ●": (v,c) => `혈액량 감소. 거래량(${v}) 감소. 시장 관심 냉각.`,
      "경보 ★": (v,c) => `혈액량 급감. 거래량(${v}) 급감. 유동성 공황 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `코스닥 거래량(F4)이 ${v}로 급감했다. 시장 혈액이 고갈되고 있다. 거래량 급감은 투자자가 시장을 외면하는 신호 — 혈액이 없으면 심장도 멈춘다.`;
      if (grade === "주의 ●") return `코스닥 거래량(F4)이 ${v}로 감소하고 있다. 시장 혈액이 줄어드는 신호다. 유동성 냉각에 주의가 필요하다.`;
      return `코스닥 거래량(F4)이 ${v}로 정상 범위다. 시장 혈액이 원활하게 순환하고 있다.`;
    },
  },

  F5: { // 은행채 스프레드 (CDS 대안) → 혈액 응고인자
    name: "은행채스프레드", bodyPart: "혈액응고인자", axis: 7,
    "양호 ○": { metaphor: "응고인자 정상", prefix: "은행채 스프레드가 안정적이며 혈액 응고가 정상이다." },
    "주의 ●": { metaphor: "응고인자 과잉", prefix: "은행채 스프레드가 확대되며 혈액이 과도하게 응고되고 있다." },
    "경보 ★": { metaphor: "응고 위기", prefix: "은행채 스프레드가 급등하며 혈전 형성이 가속되고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `응고인자 정상. 은행채스프레드(${v}) 안정. 은행간 신뢰 유지.`,
      "주의 ●": (v,c) => `응고인자 과잉. 은행채스프레드(${v}) 확대. 은행간 불신 확산.`,
      "경보 ★": (v,c) => `응고 위기. 은행채스프레드(${v}) 급등. 금융시장 경색.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `은행채 스프레드(F5)가 ${v} 급등했다. 혈액의 응고 인자가 과활성화되었다. 은행끼리 돈을 빌려주지 않으려 한다 — 금융시장의 피가 굳어가고 있다.`;
      if (grade === "주의 ●") return `은행채 스프레드(F5)가 ${v} 확대되었다. 응고 인자가 과잉 상태다. 은행 간 신뢰가 흔들리기 시작했다.`;
      return `은행채 스프레드(F5)가 ${v}로 안정적이다. 응고 인자가 정상이다. 은행 간 자금 거래가 원활하다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 6. 물가/재정 — 체온 (E1~E5) [P1_CPI/P2_PPI/P5_IMPORT/P6_EXPORT/P4_COMMODITY]
  // ════════════════════════════════════════════════════

  E1: { // CPI(소비자물가전년비 %) → 체온
    name: "CPI(소비자물가)", bodyPart: "체온", axis: 6,
    "양호 ○": { metaphor: "체온 정상", prefix: "소비자물가가 안정적이며 경제 체온이 정상이다." },
    "주의 ●": { metaphor: "체온 상승", prefix: "소비자물가가 올라가며 경제 체온이 상승하고 있다." },
    "경보 ★": { metaphor: "고열", prefix: "소비자물가가 급등하며 경제가 고열 상태다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `체온 정상. CPI(${v}) 안정. 물가 안정 범위.`,
      "주의 ●": (v,c) => `체온 상승. CPI(${v}) 상승. 물가 압력 확대.`,
      "경보 ★": (v,c) => `고열. CPI(${v}) 급등. 구매력 급격히 잠식.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `소비자물가(E1)가 ${v} 급등했다. 경제가 고열 상태다. 물가는 경제의 체온이다 — 체온이 너무 높으면 세포(가계)가 타들어간다. 실질 구매력이 급격히 잠식되며 소비 기반이 무너진다.`;
      if (grade === "주의 ●") return `소비자물가(E1)가 ${v} 상승했다. 경제 체온이 오르고 있다. 물가 상승이 가계의 실질 소득을 잠식하는 초기 신호다.`;
      return `소비자물가(E1)가 ${v}로 안정적이다. 경제 체온이 정상이다. 물가가 안정 범위에서 유지되고 있다.`;
    },
  },

  E2: { // PPI(생산자물가전년비 %) → 생산 체온
    name: "PPI(생산자물가)", bodyPart: "생산체온", axis: 6,
    "양호 ○": { metaphor: "생산 체온 정상", prefix: "생산자물가가 안정적이며 기업 생산 비용이 관리 가능하다." },
    "주의 ●": { metaphor: "생산 체온 상승", prefix: "생산자물가가 올라가며 기업 비용 압력이 커지고 있다." },
    "경보 ★": { metaphor: "생산 고열", prefix: "생산자물가가 급등하며 기업 생산 비용이 위험 수준이다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `생산 체온 정상. PPI(${v}) 안정. 기업 비용 관리 가능.`,
      "주의 ●": (v,c) => `생산 체온 상승. PPI(${v}) 상승. 비용 압력 확대.`,
      "경보 ★": (v,c) => `생산 고열. PPI(${v}) 급등. 기업 마진 소멸 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `생산자물가(E2)가 ${v} 급등했다. 공장이 고열에 시달리고 있다. 생산자물가 급등은 기업의 마진을 태우는 내부 발열이다 — 소비자에게 전가되면 CPI도 뒤따라 오른다.`;
      if (grade === "주의 ●") return `생산자물가(E2)가 ${v} 상승했다. 기업 생산 비용이 오르고 있다. 원가 상승이 소비자 가격으로 전이되기 전 단계다.`;
      return `생산자물가(E2)가 ${v}로 안정적이다. 생산 체온이 정상이다. 기업 비용 압력이 없다.`;
    },
  },

  E3: { // 수입물가지수 전년비(%) → 수혈 비용 상승
    name: "수입물가", bodyPart: "수혈비용", axis: 6,
    "양호 ○": { metaphor: "수혈 비용 안정", prefix: "수입물가가 안정적이며 원자재·중간재 조달 비용이 관리 가능하다." },
    "주의 ●": { metaphor: "수혈 비용 상승", prefix: "수입물가가 오르며 원자재 비용 압력이 증가하고 있다." },
    "경보 ★": { metaphor: "수혈 비용 급등", prefix: "수입물가가 급등하며 비용 인플레이션이 산업 전반으로 번지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `수혈 비용 안정. 수입물가(${v}) 안정. 비용 관리 가능.`,
      "주의 ●": (v,c) => `수혈 비용 상승. 수입물가(${v}) 상승. 비용 압력 확대.`,
      "경보 ★": (v,c) => `수혈 비용 급등. 수입물가(${v}) 급등. 비용 인플레 확산.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `수입물가지수(E3)가 ${v}로 급등했다. 원자재·에너지 조달 비용이 경보 수준이다. 수입물가 급등은 생산 비용을 태우는 불꽃이다 — 기업 마진이 증발하고 소비자 가격으로 전가된다.`;
      if (grade === "주의 ●") return `수입물가지수(E3)가 ${v}로 상승하고 있다. 원자재 조달 비용이 커지고 있다. 생산 비용 압력이 확대되는 초기 신호다.`;
      return `수입물가지수(E3)가 ${v}로 안정적이다. 원자재 조달 비용이 관리 가능한 수준이다.`;
    },
  },

  E4: { // 수출물가지수 전년비(%) → 수출 체력 지수
    name: "수출물가", bodyPart: "수출체력", axis: 6,
    "양호 ○": { metaphor: "수출 체력 정상", prefix: "수출물가가 안정적이며 수출 경쟁력이 유지되고 있다." },
    "주의 ●": { metaphor: "수출 체력 변동", prefix: "수출물가 변동폭이 커지며 수출 마진이 불안정해지고 있다." },
    "경보 ★": { metaphor: "수출 체력 위기", prefix: "수출물가가 급변하며 수출 기업의 가격 경쟁력이 무너지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `수출 체력 정상. 수출물가(${v}) 안정. 가격 경쟁력 유지.`,
      "주의 ●": (v,c) => `수출 체력 변동. 수출물가(${v}) 변동. 마진 불안정.`,
      "경보 ★": (v,c) => `수출 체력 위기. 수출물가(${v}) 급변. 경쟁력 위협.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `수출물가지수(E4)가 ${v}로 급변했다. 수출 기업의 가격 경쟁력이 무너지고 있다. 수출물가 급등락은 수출 체력의 발작이다 — 마진이 사라지거나 단가가 붕괴된다.`;
      if (grade === "주의 ●") return `수출물가지수(E4)가 ${v}로 변동폭이 커지고 있다. 수출 마진이 불안정해지고 있다. 가격 경쟁력 압박이 확대되는 신호다.`;
      return `수출물가지수(E4)가 ${v}로 안정적이다. 수출 기업의 가격 경쟁력이 유지되고 있다.`;
    },
  },

  E5: { // 상품수지(원자재대리) 백만$ → 영양 공급
    name: "상품수지", bodyPart: "영양공급", axis: 6,
    "양호 ○": { metaphor: "영양 공급 원활", prefix: "상품수지가 흑자를 유지하며 원자재 조달이 원활하다." },
    "주의 ●": { metaphor: "영양 공급 감소", prefix: "상품수지 흑자가 줄어들며 원자재 조달 여력이 약해지고 있다." },
    "경보 ★": { metaphor: "영양 공급 부족", prefix: "상품수지가 적자로 전환되며 원자재 조달이 위협받고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `영양 공급 원활. 상품수지(${v}) 흑자. 원자재 조달 양호.`,
      "주의 ●": (v,c) => `영양 공급 감소. 상품수지(${v}) 축소. 원자재 조달 여력 약화.`,
      "경보 ★": (v,c) => `영양 공급 부족. 상품수지(${v}) 적자. 원자재 조달 위협.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `상품수지(E5)가 ${v}로 적자 상태다. 영양 공급이 부족해지고 있다. 원자재·에너지 상품 교역에서 적자가 나면 외화가 빠져나가며 생산 기반이 흔들린다.`;
      if (grade === "주의 ●") return `상품수지(E5)가 ${v}로 축소되고 있다. 영양 공급 여력이 줄어드는 신호다. 원자재 수입 비용 증가 또는 수출 단가 하락이 진행 중이다.`;
      return `상품수지(E5)가 ${v}로 흑자를 유지하고 있다. 영양 공급이 원활하다. 원자재·상품 교역이 건강하다.`;
    },
  },

  // ════════════════════════════════════════════════════
  // 축 9. 대외/에너지/환경 — 재생 (G1~G6, A1~A5)
  // A1=R8_FOREST(농림어업취업자천명), A2=R7_WASTE(폐기물%), A3=R1_ELECTRICITY(전기가스%)
  // A4=R2_WATER(수도%), A5=R4_COAL(석탄%)
  // ════════════════════════════════════════════════════

  A1: { // 농림어업취업자(전년비) → 1차산업 생명력 [R8_FOREST, 천명]
    name: "농림어업취업자", bodyPart: "1차산업활력", axis: 9,
    "양호 ○": { metaphor: "1차산업 안정", prefix: "농림어업 취업이 안정적이며 기초 식량·원료 공급망이 유지되고 있다." },
    "주의 ●": { metaphor: "1차산업 위축", prefix: "농림어업 취업자가 감소하며 1차산업 기반이 위축되고 있다." },
    "경보 ★": { metaphor: "1차산업 붕괴", prefix: "농림어업 취업자가 급감하며 식량·원료 자립 기반이 무너지고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `1차산업 안정. 농림어업 취업(${v}) 유지. 기초 공급망 안정.`,
      "주의 ●": (v,c) => `1차산업 위축. 농림어업 취업(${v}) 감소. 고령화·도시집중 가속.`,
      "경보 ★": (v,c) => `1차산업 붕괴 경보. 농림어업 취업(${v}) 급감. 식량자립도 하락 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `농림어업취업자(A1)가 ${v}로 급감했다. 1차산업 기반이 흔들리고 있다. 식량·원료 자립도 하락은 대외 의존도를 높이며 공급망 취약성을 키운다.`;
      if (grade === "주의 ●") return `농림어업취업자(A1)가 ${v}로 감소 추세다. 고령화와 도시 집중으로 1차산업 인력이 줄어들고 있다.`;
      return `농림어업취업자(A1)가 ${v}로 안정적이다. 1차산업 인력 공급이 유지되고 있다.`;
    },
  },

  A2: { // 폐기물처리업생산(전년비) → 노폐물 배출
    name: "폐기물생산", bodyPart: "노폐물배출", axis: 9,
    "양호 ○": { metaphor: "노폐물 정상 배출", prefix: "폐기물 처리 산업이 성장하며 경제 노폐물이 원활히 배출되고 있다." },
    "주의 ●": { metaphor: "노폐물 배출 감소", prefix: "폐기물 처리 생산이 감소하며 노폐물 배출 역량이 줄고 있다." },
    "경보 ★": { metaphor: "노폐물 배출 정체", prefix: "폐기물 처리 생산이 급감하며 경제 노폐물이 쌓이고 있다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `노폐물 배출 정상. 폐기물생산(${v}) 성장. 환경 처리 역량 유지.`,
      "주의 ●": (v,c) => `노폐물 배출 감소. 폐기물생산(${v}) 감소. 처리 역량 축소.`,
      "경보 ★": (v,c) => `노폐물 배출 정체. 폐기물생산(${v}) 급감. 환경 인프라 위기.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `폐기물처리업(A2)이 ${v}로 급감했다. 경제 노폐물 배출 역량이 무너지고 있다. 폐기물 처리는 경제의 신장이다 — 기능이 떨어지면 독소가 쌓인다.`;
      if (grade === "주의 ●") return `폐기물처리업(A2)이 ${v}로 감소하고 있다. 노폐물 배출 역량이 줄고 있다. 환경·위생 인프라 유지에 주의가 필요하다.`;
      return `폐기물처리업(A2)이 ${v}로 성장하고 있다. 경제 노폐물 배출이 원활하다.`;
    },
  },

  A3: { // 전기가스수도업생산(전년비) → 산소 공급
    name: "에너지생산", bodyPart: "산소공급", axis: 9,
    "양호 ○": { metaphor: "산소 공급 정상", prefix: "전기·가스 공급 산업이 성장하며 경제 산소 공급이 원활하다." },
    "주의 ●": { metaphor: "산소 공급 감소", prefix: "전기·가스 생산이 감소하며 경제 산소 공급 여력이 줄고 있다." },
    "경보 ★": { metaphor: "산소 공급 위기", prefix: "전기·가스 생산이 급감하며 경제 에너지 공급이 위기다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `산소 공급 정상. 에너지생산(${v}) 성장. 에너지 안정.`,
      "주의 ●": (v,c) => `산소 공급 감소. 에너지생산(${v}) 감소. 공급 여력 축소.`,
      "경보 ★": (v,c) => `산소 공급 위기. 에너지생산(${v}) 급감. 에너지 비상.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `전기가스수도업(A3)이 ${v}로 급감했다. 경제 산소 공급이 위기 수준이다. 에너지 공급은 경제의 폐다 — 폐가 멈추면 모든 장기가 멈춘다.`;
      if (grade === "주의 ●") return `전기가스수도업(A3)이 ${v}로 감소하고 있다. 산소 공급 여력이 줄고 있다. 에너지 안보에 주의가 필요하다.`;
      return `전기가스수도업(A3)이 ${v}로 성장하고 있다. 경제 산소 공급이 안정적이다.`;
    },
  },

  A4: { // 수도업생산(전년비) → 체액 공급
    name: "수도생산", bodyPart: "체액공급", axis: 9,
    "양호 ○": { metaphor: "체액 공급 정상", prefix: "수도업 생산이 성장하며 기초 체액(수자원) 공급이 안정적이다." },
    "주의 ●": { metaphor: "체액 공급 감소", prefix: "수도업 생산이 감소하며 수자원 공급 역량이 줄고 있다." },
    "경보 ★": { metaphor: "체액 공급 위기", prefix: "수도업 생산이 급감하며 기초 수자원 공급이 위험하다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `체액 공급 정상. 수도생산(${v}) 성장. 수자원 안정.`,
      "주의 ●": (v,c) => `체액 공급 감소. 수도생산(${v}) 감소. 수자원 역량 축소.`,
      "경보 ★": (v,c) => `체액 공급 위기. 수도생산(${v}) 급감. 수자원 비상.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `수도업(A4)이 ${v}로 급감했다. 기초 수자원 공급이 위기다. 수자원은 경제의 체액이다 — 공급이 끊기면 산업·생활 기반이 무너진다.`;
      if (grade === "주의 ●") return `수도업(A4)이 ${v}로 감소하고 있다. 수자원 공급 역량이 줄고 있다. 수자원 인프라 유지에 주의가 필요하다.`;
      return `수도업(A4)이 ${v}로 성장하고 있다. 기초 수자원 공급이 안정적이다.`;
    },
  },

  A5: { // 석탄광업생산(전년비) → 비상연료 비축
    name: "석탄생산", bodyPart: "비상연료", axis: 9,
    "양호 ○": { metaphor: "비상연료 안정", prefix: "석탄광업 생산이 안정적이며 기초 에너지 자원이 유지되고 있다." },
    "주의 ●": { metaphor: "비상연료 변동", prefix: "석탄 생산 변동이 커지며 에너지 자원 안정성이 흔들리고 있다." },
    "경보 ★": { metaphor: "비상연료 위기", prefix: "석탄 생산이 급변하며 기초 에너지 공급이 불안정하다." },
    diagnosisTemplate: {
      "양호 ○": (v,c) => `비상연료 안정. 석탄생산(${v}) 안정. 기초 에너지 유지.`,
      "주의 ●": (v,c) => `비상연료 변동. 석탄생산(${v}) 변동. 에너지 자원 불안.`,
      "경보 ★": (v,c) => `비상연료 위기. 석탄생산(${v}) 급변. 에너지 공급 위험.`,
    },
    narrativeTemplate: (v, c, grade) => {
      if (grade === "경보 ★") return `석탄광업(A5)이 ${v}로 급변했다. 기초 에너지 자원 공급이 불안정하다. 석탄은 경제의 비상연료다 — 공급망이 흔들리면 산업 기반 에너지가 위협받는다.`;
      if (grade === "주의 ●") return `석탄광업(A5)이 ${v}로 변동이 크다. 에너지 자원 안정성에 주의가 필요하다. 대체 에너지 전환 속도와 비교 관찰이 필요하다.`;
      return `석탄광업(A5)이 ${v}로 안정적이다. 기초 에너지 자원 공급이 유지되고 있다.`;
    },
  },
};


// ━━━ 2. 경보 이모지/색상 매핑 ━━━

const ALERT_MAP = {
  0: { emoji: "🟢", color: "00A651", label: "0단계: 정상 (관찰 유지)" },
  1: { emoji: "🟡", color: "FFC107", label: "1단계: 주의 (잠복기 관찰 강화)" },
  2: { emoji: "🔴", color: "FF0000", label: "2단계: 경보 (미세석회 침착 가속)" },
  3: { emoji: "🔴", color: "8B0000", label: "3단계: 위기 (이중봉쇄 진행)" },
};


// ━━━ 3. DIAH 트리거 서사 템플릿 ━━━

const DIAH_NARRATIVE = {
  // H = 저산소증(Hypoxia): 산소(에너지) 공급 부족 → 생산 중단 → 유동성 생성↓
  // 경제: 실물 생산 활동 자체가 멈춰 새로운 유동성(매출·수익)이 창출되지 못하는 상태
  H: {
    name: "돈맥경화",
    dormant: (ctx) => {
      // H(저산소) = 생산 중단 → 유동성 생성↓  ← 직접 지표: 산업생산(O3_IP) + 설비가동률(O4_CAPACITY)
      const prodAlerts = [];
      if (ctx.o3Grade === "경보 ★") prodAlerts.push(`산업생산 ${ctx.o3Value} 급감(경보)`);
      else if (ctx.o3Grade === "주의 ●") prodAlerts.push(`산업생산 ${ctx.o3Value} 둔화(주의)`);
      if (ctx.o4CapGrade === "경보 ★") prodAlerts.push(`설비가동률 ${ctx.o4CapValue} 급락(경보)`);
      else if (ctx.o4CapGrade === "주의 ●") prodAlerts.push(`설비가동률 ${ctx.o4CapValue} 하락(주의)`);
      const hasProd = prodAlerts.length > 0;
      return `저산소증(Hypoxia) 잠복 단계다. H의 핵심은 '생산 현장 중단'—새로운 유동성이 생성되지 않는 상태다. ` +
        (hasProd
          ? `[생산 중단 징후 포착] ${prodAlerts.join("; ")}. 공장 라인이 멈추면 미세혈관(가계·소상공인)까지 산소(유동성)가 끊긴다.`
          : ctx.o6Grade !== "양호 ○"
            ? `소비(O6) 위축은 생산 수요가 꺼지는 간접 신호다. 산업생산·가동률을 지속 관찰한다—수요가 사라지면 생산도 멈춘다.`
            : `현재 산업생산·설비가동률 모두 정상 수준. 생산 중단 징후 없음.`);
    },
    active: (ctx) => `저산소증(H/Hypoxia) 발동. 실물 생산이 중단되어 새로운 유동성이 생성되지 않고 있다.` +
      (ctx.o3Grade === "경보 ★" ? ` 산업생산 ${ctx.o3Value} 급감—공장 라인 붕괴.` : "") +
      (ctx.o4CapGrade === "경보 ★" ? ` 설비가동률 ${ctx.o4CapValue}—유휴 설비 폭증.` : "") +
      ` 기존 유동성만 소진되는 혐기성 대사 상태—외부 수혈 없이는 기능 유지 불가. 세포(가계·소상공인)부터 괴사 시작. 돈맥경화 트리거 발동.`,
  },
  // A = 대사성 산증(Acidosis): CO₂ 배출 실패 → 체액 pH↓ → 효소 기능 저하
  // 경제: 인플레이션 압력(CO₂) 회수 실패 → 화폐가치 하락 → 유동성 효율↓
  A: {
    name: "물가폭등",
    dormant: (ctx) => `산증(Acidosis) 잠복 단계다. CPI ${ctx.o2Value}—${ctx.o2Grade === "양호 ○" ? "배출 밸브(금리·재정)가 작동하며 압력이 관리되고 있다." : "CO₂(인플레이션 압력)가 미열 수준으로 쌓이고 있다. 배출이 지연되면 체액(화폐가치)이 산성화된다."} ${ctx.o2Grade === "경보 ★" ? "배출 임계를 넘었다—산성화 진행." : ""}`,
    active: (ctx) => `대사성 산증(A/Acidosis) 발동. CO₂(인플레이션 압력) 배출에 실패하여 체액이 산성화되었다. 화폐가치(pH)가 훼손되고 유동성 효율이 붕괴하고 있다. 물가폭등 트리거 발동.`,
  },
  // D = 결핍(Deficiency): 칼슘 흡수 조건 불충족 → 혈중 칼슘↓ → PTH 발동 → 비상금고 소진
  // 경제: 소득(칼슘 흡수) 감소 → 유동성 공급↓ → 비상금 인출 → 부채 시작
  D: {
    name: "소득절벽",
    dormant: (ctx) => `결핍(Deficiency) 잠복 단계다. 경상수지 ${ctx.i1Value}—거시적 칼슘 유입은 ${ctx.i1Grade === "양호 ○" ? "유지되고 있다" : "위축되고 있다"}. ${ctx.i4Grade !== "양호 ○" ? `그러나 환율 ${ctx.i4Value} 고공행진은 수입 의존 가계의 실질 흡수 조건을 훼손하고 있다. 칼슘이 들어와도 흡수되지 못하면 PTH가 발동한다.` : "흡수 조건은 아직 유지되고 있다."}`,
    active: (ctx) => `결핍(D/Deficiency) 발동. 칼슘 흡수 조건이 붕괴하여 소득 유입이 급감하고 있다. PTH 명령이 발동하여 비상금고(뼈)에서 현금(칼슘)이 유출되고 있다. 소득절벽 트리거 발동.`,
  },
  // I = 염증(Inflammation): 만성 염증 → 면역계 과활성 → 자원(에너지/영양소) 소진↑ → 정상 조직 공격
  // 경제: 사회적 갈등·양극화(염증) → 복지·긴급 지출 증가 → 재정 소진 → 빈부격차 확대
  I: {
    name: "빈부격차",
    dormant: (ctx) => `염증(Inflammation) 잠복 단계다. ${ctx.o4Grade !== "양호 ○" ? "주가(자산) 급등과 " : ""}소비(O6) ${ctx.o6Grade !== "양호 ○" ? "위축의 동시 진행은" : "흐름은"} ${ctx.o6Grade !== "양호 ○" ? `만성 염증의 잠복을 의미한다. 면역계(사회)가 과활성화되면 정상 조직(중산층·소상공인)도 공격한다.` : "관찰 중이다."} 염증은 방치하면 복리로 악화된다.`,
    active: (ctx) => `만성 염증(I/Inflammation) 발동. 면역계가 임계점을 넘어 정상 조직을 공격하고 있다. 사회 자원이 갈등·긴급 비용으로 소진되며 빈부격차가 구조적으로 고착된다. 빈부격차 트리거 발동.`,
  },
};


// ━━━ 4. 7M 기전 표 (고정) ━━━

const M7_TABLE = [
  { stage: "0M", name: "정상", body: "무증상",              econ: "거시지표 양호" },
  { stage: "1M", name: "폐열", body: "내강폐쇄/파열/출혈",  econ: "자본시장 급성 경색" },
  { stage: "2M", name: "둔화", body: "관절/근육 기능저하",   econ: "경기 둔화/고용 악화" },
  { stage: "3M", name: "피폐", body: "수용체/신호차단",      econ: "정책 무반응" },
  { stage: "4M", name: "경화", body: "섬유화/석회화",        econ: "구조적 경직" },
  { stage: "5M", name: "범파", body: "세포과증식/비대",      econ: "버블/비대화" },
  { stage: "6M", name: "단절", body: "신경단절/괴사",        econ: "시스템 단절" },
  { stage: "7M", name: "붕괴", body: "뼈/치아 구조붕괴",     econ: "국가 구조 붕괴" },
];


// ━━━ 5. 부록 (고정 텍스트) ━━━

const APPENDIX = [
  { title: "1. 기존 경제학의 한계", text: "기존 경제학은 양(量)만 보고 흐름(流)을 보지 않았다. GDP가 성장해도 서민의 삶이 나아지지 않는 이유를 설명하지 못한다. DIAH-7M은 '어디가 막혔는가'를 묻는다." },
  { title: "2. DIAH-7M의 질문", text: "이 시스템의 핵심 질문은 단 하나다. '어디가 막혔는가?' 경제의 흐름이 어디에서 막히고 있는지를 진단하면, 어디를 뚫어야 하는지가 명확해진다." },
  { title: "3. 신체와 경제는 같은 법칙을 따른다", text: "인체는 37조 개의 세포로 구성되며, 202개 질병이 DIAH 트리거와 7M 기전으로 분류된다. 경제도 수천만 경제 주체(가계/소상공인, 대기업, 정부)로 구성되며, 같은 흐름 법칙을 따른다." },
  { title: "4. 구조적 동형(Structural Isomorphism)", text: "이것은 비유가 아니다. 같은 설계도다. 인체의 칼슘 대사와 경제의 자본 흐름은 구조적으로 동일한 패턴을 따른다. 막히면 죽는다는 법칙은 세포에도, 경제에도 동일하게 적용된다." },
  { title: "5. 핵심 등식 — 칼슘·이자·인플레이션의 구분", text: "칼슘=현금(유동성). 뼈=비상금고(저축). 대출은 뼈에서 칼슘이 빠져나오는 것—원금은 돌아올 수 있다. 그러나 이자는 유출된 칼슘이 좁아진 길목에 굳어 미세석회가 되는 것—절대 돌아오지 않는다. 이자가 누적되면 가처분소득이 줄어 소비(배출)가 막히고(DLT), 동시에 투자 여력이 소진되어 수입(공급)도 막힌다(CAM). 수입과 소비가 동시에 막히는 것이 이중봉쇄다. 미세석회(이자 누적)와 CO₂(인플레이션 압력)는 근본적으로 다르다—이자는 굳어서 막고, 인플레이션은 쌓여서 썩게 한다." },
  { title: "6. 5단계 인과 경로", text: "DIAH-7M의 인과 경로는 5단계다. [1단계 요인] 1·2·3차 요인이 깔때기처럼 수렴하여 DIAH 사관문(유동성 위기)을 통과한다. [2단계 시작] PTH(비상금 인출 명령)가 발동되어 뼈(비상금고)에서 칼슘(현금)이 유출된다. [3단계 봉쇄] 유출된 칼슘이 좁아진 길목에 미세석회로 침착되어 이중봉쇄(CAM+DLT)가 형성된다 — 통신망과 물류망이 동시에 마비된다. 이중봉쇄는 7M의 원인이지 7M 기전의 하나가 아니다. [4단계 발현] 이중봉쇄로 인해 7가지 병리 기전(7M)이 단독 또는 복합으로 발현된다. [5단계 결과] 다장기 부전·국가 부도·궤멸." },
  { title: "7. DIAH 트리거의 의학적 정의", text: "D(결핍/Deficiency): 칼슘 흡수 조건 불충족 → PTH 발동 → 비상금고 소진 / 경제: 소득절벽. I(염증/Inflammation): 만성 염증 → 면역계 과활성 → 자원 소진 / 경제: 사회 갈등·빈부격차. A(산증/Acidosis): CO₂ 배출 실패 → 체액 산성화 → 유동성 효율↓ / 경제: 물가폭등. H(저산소/Hypoxia): 혈액 있어도 조직에 산소 미도달 → 혐기성 대사 / 경제: 돈맥경화·유동성 함정." },
  { title: "8. 7M 기전의 동일성", text: "7M은 이중봉쇄(공급·배출 동시 차단)가 만들어 낸 7가지 병리 발현 유형이다. 단계적 순서가 아니라 단독 또는 복합으로 발생한다. 1M(폐열): 막혀터짐—자본시장 급성 경색. 2M(둔화): 느려짐—경기 침체. 3M(피폐): 덮여막힘—정책 무반응. 4M(경화): 굳어짐—구조 경직. 5M(범파): 넘쳐터짐—버블. 6M(단절): 끊어짐—공급망 붕괴. 7M(붕괴): 무너짐—국가 부도." },
  { title: "9. 자연의 보편 법칙", text: "뉴턴이 사과와 달이 같은 힘으로 움직인다고 본 것처럼, DIAH-7M은 세포와 경제가 같은 흐름 법칙으로 작동한다고 본다. 이것이 인체국가경제론의 핵심이다." },
  { title: "10. 본 보고서의 의의", text: "이 보고서는 예측이 아니라 진단이다. 현재 경제의 흐름 상태를 객관적으로 측정하고, 어디가 막혀 있는지를 보여준다. 예측은 틀릴 수 있지만, 진단은 현재를 정확히 읽는다." },
];


// ━━━ 6. 경보 상향 규칙 (고정) ━━━

const ALERT_RULES = [
  { condition: "7게이지 중 2개 이상 주의", action: "1단계(주의)로 상향 검토" },
  { condition: "7게이지 중 1개 이상 경보 + 1개 이상 주의", action: "2단계(경보)로 상향 검토" },
  { condition: "DIAH 트리거 2개 이상 동시 발동", action: "3단계(위기)로 상향 검토" },
];


// ━━━ 7. 가족력 (고정 — 과거 데이터 불변) ━━━

const FAMILY_HISTORY_PAST = {
  "1997": {
    year: "1997년 11월",
    data: { 경상수지: "-23억$ (적자)", 외환보유고: "~300억$", 환율: "~1,700원 (폭등)", 국채금리: ">20% (폭등)", 물가: "~6% (급등)", 주가: "~400pt (폭락)", "DIAH 트리거": "D+H 동시발동", 진단명: "급성 심근경색" },
    narrative: (nowMonth) => `1997년(D+H / 급성 심근경색): 외환위기 당시 소득절벽(D)과 돈맥경화(H)가 동시 발동하여 급성 심근경색을 일으켰다. 현재와의 차이점은 외환보유고와 경상수지(흑자 기조)가 안정적이라는 것이다. 그러나 당시에도 위기 직전까지 거시지표는 양호했다는 점을 기억해야 한다.`,
  },
  "2008": {
    year: "2008년 10월",
    data: { 경상수지: "-56억$ (적자)", 외환보유고: "~2,000억$", 환율: "~1,500원 (급등)", 국채금리: "~6% (급등)", 물가: "~5% (상승)", 주가: "~1,000pt (급락)", "DIAH 트리거": "H+A 동시발동", 진단명: "패혈증 쇼크" },
    narrative: (nowMonth) => `2008년(H+A / 패혈증 쇼크): 글로벌 금융위기 시 돈맥경화(H)와 물가폭등(A)이 결합하여 패혈증 쇼크가 발생했다. 현재와 비교하면 금리와 물가 수준이 크게 다르나, 잠복기 후 급성 발현이라는 패턴은 동일하다.`,
  },
  common: "두 사례 모두 미세석회가 오랜 기간 조용히 침착된 후 급성 발현으로 전환되었다는 공통점이 있다. 현재의 0단계 정상 판정이 안전을 보장하는 것은 아니다.",
};


// ━━━ 8. 섹션 0 작동원리 (고정) ━━━

// ━━━ v2.8 신규: 교차신호 서사 템플릿 (6쌍) ━━━

const CROSS_SIGNAL_NARRATIVES = {
  '거시↔고용': {
    organ: '심폐 → 근육/신경',
    trigger: '거시경제(심장)의 박동이 약해지면 고용(근육)에 힘이 빠진다.',
    risk: '실물경기 침체가 고용시장으로 전이',
    historical: '2008 금융위기 — GDP 급락 → 대량 실업 확산',
  },
  '거시↔금융': {
    organ: '심폐 ↔ 혈액',
    trigger: '심장(거시)과 혈액(금융)이 동시에 나빠지면 전신 순환이 멈춘다.',
    risk: '실물↔금융 악순환 — 가장 위험한 복합 경로',
    historical: '2008 금융위기 — 서브프라임 → 리먼 → 실물 붕괴',
  },
  '거시↔에너지': {
    organ: '심폐 ← 산소통',
    trigger: '산소 공급(에너지)이 끊기면 심폐(거시)가 직접 타격받는다.',
    risk: '에너지 충격이 실물 경제를 직격',
    historical: '1973 오일쇼크, 2008 유가 $147 → 실물 위기 가속',
  },
  '고용↔금융': {
    organ: '근육 ↔ 혈액',
    trigger: '근육 손상(고용 악화)과 혈액 오염(금융 불안)이 동시 발생하면 회복이 어렵다.',
    risk: '가계부채 부실이 금융시스템으로 전이',
    historical: '가계 연체 → 은행 부실채권 증가 → 신용경색',
  },
  '금융↔에너지': {
    organ: '혈액 ← 산소통',
    trigger: '산소 공급(에너지) 위기가 혈액의 질(금융)을 오염시킨다.',
    risk: '에너지 가격 급등이 금융 시장 불안을 촉발',
    historical: '유가 급등 → 기업 수익성 악화 → 회사채 스프레드 확대',
  },
  '부동산↔금융': {
    organ: '뼈 → 혈액',
    trigger: '뼈(부동산)에 골절이 발생하면 내출혈(금융 손실)이 전신으로 퍼진다.',
    risk: 'PF/부동산 부실이 금융 시장으로 전이',
    historical: '2022 레고랜드 PF — 강원도 ABCP 디폴트 → 채권시장 동결',
  },
};

// ━━━ v2.8 신규: 구조축(축9) 등급별 서사 템플릿 ━━━

const STRUCTURAL_TEMPLATES = {
  3: { // 🔴위기
    headline: '이 경제의 신체 나이가 위기 수준이다',
    body: '인구 구조가 심각한 경보 상태다. 출산율 급락, 고령화 가속, 생산인구 감소가 동시에 진행되고 있으며, 이는 10년 이상의 장기 구조적 위험으로, 순환 건강(축1~8)의 단기 대응으로는 해결이 불가능하다. 인체 비유: 뼈와 근육은 아직 움직이지만, 신체의 생물학적 나이가 실제 나이보다 훨씬 높은 상태. 세포 재생력(출산율)이 바닥이고, 조직의 노화(고령화)가 가속화되고 있다.',
  },
  2: { // 🟠경보
    headline: '인구 구조에 경보 신호가 감지된다',
    body: '주요 인구 지표에서 경보 수준의 악화가 확인된다. 현재 추세가 지속되면 5~10년 내 구조적 위기로 전환될 가능성이 높다. 신체 나이가 실제 나이보다 높아지기 시작한 단계.',
  },
  1: { // 🟡주의
    headline: '인구 구조에 주의가 필요하다',
    body: '인구 관련 일부 지표에서 악화 추세가 관찰된다. 아직 위기 수준은 아니지만 장기 모니터링이 필요하다.',
  },
  0: { // 🟢양호/🔵관심
    headline: '인구 구조가 안정적이다',
    body: '주요 인구 지표가 안정적 범위 내에 있다.',
  },
};

// ━━━ 위성 물리흐름 진단 서사 (SATELLITE_INTRO) ━━━
// 보고서 "위성." 섹션 전체를 구성하는 고정 서사 데이터
// renderer.js buildSatelliteOverview()가 이 상수를 사용한다
const SATELLITE_INTRO = {

  // ── 세계 최초 선언문 (보고서 상단 고정 박스) ──
  declaration: `DIAH-7M은 세계최초로 위성 물리흐름과 공공 수치지표로 통합 진단한다.
정부가 발표하는 통계는 사람이 집계하고 사람이 보고한다. 그러나 위성은 다르다.
야간에 공장이 가동되면 불빛이 나온다. 건물에 사람이 살면 빛과 열이 발생한다. 건물이 지어지면 레이더 반사가 바뀐다.
위성은 이 물리적 신호를 조작 없이 포착한다. 통계가 거짓말을 해도, 위성은 하지 못한다.
의사가 환자의 말만 듣지 않고 CT·MRI로 몸 속을 직접 확인하듯,
DIAH-7M은 위성으로 경제의 몸 속을 직접 들여다본다.`,

  // ── 인체 비유 요약 (1줄) ──
  bodyAnalogy: `환자의 자기 보고(정부 통계)만 믿지 않는다. CT·MRI·혈액검사(위성 실측)로 몸 속을 직접 확인한다.`,

  // ── 물리 흐름도 — 활동 → 신호 → 위성 → 경제 해석 ──
  // renderer가 이 배열을 4열 테이블로 렌더링
  physicsFlowTable: [
    {
      activity:    '공장·항만 가동',
      signal:      '야간 빛 방사 (nW/cm²/sr)',
      sensor:      'NASA VIIRS DNB',
      interpretation: '가동률 (S2) — 통계 2~3개월 선행',
    },
    {
      activity:    '사람 거주·생활',
      signal:      '야간 빛 + 표면열 (°C)',
      sensor:      'VIIRS + Landsat-9 TIR',
      interpretation: '실입주율 (R6) — 유령단지 적발',
    },
    {
      activity:    '건물 골조 성장',
      signal:      '레이더 후방산란 변화 (mm)',
      sensor:      'ESA Sentinel-1 SAR',
      interpretation: '공정률 (R5) — 공사 은폐 적발',
    },
    {
      activity:    '지역 경제 활동',
      signal:      '지역별 야간광 총량 비율 (%)',
      sensor:      'NASA VIIRS DNB (지역 비교)',
      interpretation: '지역 활력 격차 (G6) — 편마비 위성 확증',
    },
  ],

  // ── 위성의 핵심 강점 3가지 ──
  coreStrengths: [
    {
      title: '조작 불가능',
      body: '통계는 보고자가 수치를 바꿀 수 있다. 위성이 포착한 빛·열·레이더 신호는 바꿀 수 없다. 공장이 꺼져 있으면, 위성은 어둡다고 기록한다.',
    },
    {
      title: '통계 2~3개월 선행',
      body: '야간광이 감소하기 시작하면, 통계청 산업생산 발표보다 2~3개월 앞서 경기 둔화를 포착한다. DIAH-7M만이 이 선행 신호를 경제 진단에 통합한다.',
    },
    {
      title: '통계 vs 위성 교차검증',
      body: '정부 통계와 위성 실측이 같은 방향이면 확신이 높아진다. 다른 방향이면 — 아직 통계에 잡히지 않은 변화가 물리적으로 이미 시작된 것이다.',
    },
  ],

  // ── 위성 X-ray 교차검증 서사 (R5+R6+G6 삼각검증) ──
  crossValidation: {
    title: '위성 3중 교차검증 (X-ray 삼각확인)',
    intro: '단일 위성 신호는 오차가 있을 수 있다. 그러나 세 가지 위성이 같은 방향을 가리키면 — 이것은 오차가 아니라 실물이다.',
    scenarios: [
      {
        label: '유령단지 삼각 확증',
        signals: ['R6 야간광 극저 (불이 꺼져 있다)', 'R5 SAR 정지 (공사가 멈췄다)', 'R2 미분양 급증 (시장이 외면한다)'],
        verdict: '3중 일치 → 유령 개발 사업장 확증. 통계의 입주율 보고는 신뢰 불가.',
      },
      {
        label: '지방소멸 위성 확증',
        signals: ['G6 지방 야간광 감소 (불빛이 사라진다)', 'G1 소멸지수 상승 (인구가 준다)', 'G5 재정자립도 하락 (세수가 마른다)'],
        verdict: '3중 일치 → 편마비 진행 위성 확증. GRDP 통계보다 빠른 실물 신호.',
      },
      {
        label: '경기침체 조기경보',
        signals: ['S2 야간광 3개월 연속 하락 (공단이 꺼진다)', 'O1 산업생산 둔화', 'E1 수출 감소'],
        verdict: '3중 일치 → 경기침체 선행 경보. 공식 통계 발표 2개월 전 포착.',
      },
    ],
  },

  // ── 위성 판독 면책 고지 ──
  disclaimer: `위성 데이터는 기상 조건, 해상도 한계, 계절 변동 등으로 인한 오차를 포함할 수 있습니다.
DIAH-7M은 단일 위성 신호가 아닌 복수 지표의 교차검증으로 판정합니다.
본 위성 분석은 투자 조언이 아닌 물리적 실측 정보의 제공입니다.`,
};


const SECTION_0 = {
  principle: "경제는 인체와 같은 흐름 시스템이다. 막히면 죽는다.",
  body1: "빚이자란 카드빚이자, 대출이자, 임대료 같은 것이다. 하나하나는 눈에 보이지 않지만, 전신에 쌓여 경제를 굳힌다. 이것이 미세석회다. 대기업과 정부의 빚이자, 자산버블처럼 눈에 보이는 것은 거시석회다. 그러나 진짜 위기를 일으키는 것은 미세석회, 즉 가계 빚이자의 전신 침착이다.",
  body2: "원인은 네 갈래(DIAH)지만 수렴점은 하나다. 대출은 뼈(비상금고)에서 칼슘(현금)이 유출되는 것이고, 이자는 그 유출된 칼슘이 좁아진 길목에 굳어 미세석회로 침착되는 것이다. 이것이 5단계 경로다. [1단계 요인] DIAH 트리거 발생 → [2단계 시작] PTH 발동, 비상금고 소진 → [3단계 봉쇄] 미세석회 침착, CAM+DLT 이중봉쇄 → [4단계 발현] 1M~7M 기전 순차 누적 → [5단계 결과] 궤멸. 이중봉쇄는 7M 기전의 하나가 아니라, 발현(4단계) 직전의 봉쇄 단계(3단계)에 해당한다.",
  rule: "미세석회는 하루아침에 쌓이지 않는다. 수십 년간 조용히 누적되다가, 어느 순간 임계점을 넘으면 한꺼번에 기능이 마비된다. 위기는 트리거 하나가 아니라 복합 작용으로 온다.",
  camDlt: "CAM은 미세석회가 수용체를 덮어 신호를 차단하는 것이다. 경제적으로는 정책 금리를 낮춰도 말단이 반응하지 않는 인슐린 저항 상태다. DLT는 미세석회가 미세혈관 통로를 막아 세포의 산소·포도당 공급과 CO₂·독소 배출을 동시에 차단하는 것이다. 둘 다 발생하면 이중봉쇄다.",
  diahDef: "D(소득절벽)는 들어올 자본이 부족해 비상금고를 녹여 쓰는 것이다. I(빈부격차)는 마찰이 미세경로를 수축시켜 자본 회전을 둔화시키는 것이다. A(물가폭등)는 배출되지 못한 압력이 축적되어 기능이 마비되는 것이다. H(돈맥경화)는 초미세 자본이 공급되어도 말단이 흡수하지 못하는 것이다.",
  warning: "미세석회는 무증상으로 쌓인다. 0단계는 아직 진단 기준에 도달하지 않았다는 뜻이지, 석회가 없다는 뜻이 아니다. 1997년과 2008년 모두 위기 직전까지 거시지표는 양호했다.",
};


// ══════════════════════════════════════════════════════════════
// ██ 메인 변환 함수: generateNarrative(judgmentResult, rawData, meta) → D 객체
// ══════════════════════════════════════════════════════════════

/**
 * @param {Object} result - 판정엔진 v5.0/v5.1 runJudgment() 출력
 * @param {Object} rawData - 원시 입력 데이터 (값/변동 문자열용)
 * @param {Object} meta - 추가 메타 정보
 *   meta.month         "2025년 12월"
 *   meta.writeDate     "2026년 2월 7일"
 *   meta.engineVersion "DIAH-7M 판정엔진 v5.1 + 서사엔진 v2.8"
 *   meta.dataNote      "일부 지표 2025년 11월 확정치 사용"
 *   meta.baseRate       "2.50%" (기준금리)
 *   meta.oneLiner       "경상수지 사상 최대에도..." (한줄 진단 — 선택, 자동생성도 가능)
 *   meta.prevMonths     { m1: "10월", m2: "11월", m3: "12월" }
 *   meta.sec2_titleSuffix  "[심폐계] 제목 후반부"
 *   meta.sec3_titleSuffix  "[순환계-말단] 제목 후반부"
 *   meta.sec4_titleSuffix  "잠복 상태, 관찰 필요"
 *   meta.prognosis      { A: {...}, B: {...}, C: {...} }
 *   meta.watchVars      [...] 
 *   meta.prescriptions  [...]
 *   meta.timeseriesOverride [...] (시계열 데이터 직접 입력)
 *   meta.familyHistoryNow {...} (현재 가족력 컬럼)
 */
function generateNarrative(result, rawData, meta) {
  // ── v2.8: v5.1 → v2.7 호환 심(shim) ──
  // v5.1 gauges: { code: { value, score, threshold } }
  // v2.7 expects: { code: { available, value, change, grade } }
  const _rawG = result.gauges || {};
  const _scoreToGrade = (s) => s === '★' ? '경보 ★' : s === '●' ? '주의 ●' : '양호 ○';
  
  const g = {};
  for (const [code, gData] of Object.entries(_rawG)) {
    if (gData && typeof gData === 'object') {
      g[code] = {
        available: true,
        value: gData.value,
        change: rawData?.[code]?.change ?? rawData?.[code]?.value ?? null,
        grade: gData.grade || _scoreToGrade(gData.score || '○'),
        name: METAPHOR[code]?.name || code,
      };
    }
  }

  // v5.1 alert/blockade 호환 (v5.1은 이 필드가 없으므로 diah에서 유도)
  const _diahRaw = result.diah || {};
  const _triggerList = _diahRaw.triggers || _diahRaw.active || [];
  const _triggerCount = _triggerList.length;
  const al = result.alert || {
    level: _triggerCount >= 3 ? 2 : _triggerCount >= 1 ? 1 : 0,
    label: _triggerCount >= 3 ? 'Lv.2 복합경보' : _triggerCount >= 1 ? 'Lv.1 단일경보' : 'Lv.0 정상',
  };
  const bl = result.blockade || {
    type: _triggerCount >= 3 ? '이중봉쇄' : _triggerCount >= 2 ? '신호봉쇄' : '미발동',
    label: _triggerCount >= 3 ? 'CAM+DLT 이중봉쇄' : _triggerCount >= 2 ? 'CAM 신호봉쇄' : '봉쇄 미발동',
    cam: _triggerCount >= 2 ? '경보' : _triggerCount >= 1 ? '주의' : '양호',
    dlt: _triggerCount >= 3 ? '경보' : _triggerCount >= 2 ? '주의' : '양호',
    dual: _triggerCount >= 3,
  };

  // v5.1 diah 호환
  const diah = (() => {
    if (_diahRaw.label && _diahRaw.active) return _diahRaw; // v5.0 형식 (label + active 모두 존재)
    // v5.1 형식 → v2.7 호환
    return {
      ..._diahRaw,
      label: _diahRaw.formula || _triggerList.join('+') || '미발동',
      active: _triggerList,
    };
  })();

  // v5.1 m7 호환
  const _m7Raw = result.m7 || {};
  const m7 = (() => {
    if (_m7Raw.current !== undefined) return _m7Raw; // v5.0 형식
    // v5.1 형식 → v2.7 호환
    const pathways = _m7Raw.pathways || [];
    const lastP = pathways.length > 0 ? pathways[pathways.length - 1] : '0M';
    const lastNum = parseInt(lastP) || 0;
    const nextP = lastNum < 7 ? `${lastNum + 1}M` : '7M';
    return {
      ..._m7Raw,
      current: lastP,
      next: nextP,
    };
  })();

  // ── v2.8 신규: v5.1 등급 추출 (v5.0 호환) ──
  const _isV51 = !!(result.cyclicalGrade && result.structuralGrade);
  const _grades = _isV51 ? {
    cyclicalLevel: result.cyclicalGrade.level,
    cyclicalCode: result.cyclicalGrade.code,
    eff: result.cyclicalGrade.eff,
    maxAxisCode: result.cyclicalGrade.maxAxisCode,
    boost: result.cyclicalGrade.boost,
    crisisCount: result.cyclicalGrade.crisisCount,
    alertCount: result.cyclicalGrade.alertCount,
    cautionCount: result.cyclicalGrade.cautionCount,
    structuralLevel: result.structuralGrade.level,
    structuralCode: result.structuralGrade.code,
    display: result.overallGrade.display,
  } : {
    cyclicalLevel: result.overallGrade?.level || '미판정',
    cyclicalCode: result.overallGrade?.code || 0,
    eff: null, maxAxisCode: null, boost: null,
    crisisCount: null, alertCount: null, cautionCount: null,
    structuralLevel: null, structuralCode: null,
    display: result.overallGrade?.level || '미판정',
  };

  // ── v2.8 신규: 교차신호 서사 생성 ──
  // crossSignals가 { active: [...], inactive: [] } 객체이거나 배열일 수 있음
  const _crossSignalsRaw = Array.isArray(result.crossSignals)
    ? result.crossSignals
    : (result.crossSignals?.active || []);
  const _crossSignals = _crossSignalsRaw.map(cs => {
    const tmpl = CROSS_SIGNAL_NARRATIVES[cs.pair] || {
      organ: '축간 연동', trigger: `${cs.pair}에서 교차 신호 감지`, risk: '축간 전이 위험',
    };
    let severityDesc;
    if (cs.severity >= 5) severityDesc = '매우 강한 교차 — 전이가 진행 중';
    else if (cs.severity >= 4) severityDesc = '강한 교차 — 전이 감시 필요';
    else if (cs.severity >= 3) severityDesc = '중간 교차 — 전이 가능성';
    else severityDesc = '약한 교차 — 모니터링 단계';
    let boostDesc;
    if (cs.boost >= 1.0) boostDesc = '전이 확인 (+1.0)';
    else if (cs.boost >= 0.5) boostDesc = '전이 가능성 (+0.5)';
    else boostDesc = '미적용';
    return {
      pair: cs.pair, severity: cs.severity, severityDesc, boostDesc,
      organ: tmpl.organ, narrative: tmpl.trigger, risk: tmpl.risk,
      historical: tmpl.historical || null,
    };
  });

  // ── v2.8 신규: 구조축(축9) 전용 서사 생성 ──
  const _structuralNarrative = (() => {
    if (!_isV51 || !_grades.structuralCode) return null;
    const code = Math.min(3, Math.floor(_grades.structuralCode));
    const tmpl = STRUCTURAL_TEMPLATES[code] || STRUCTURAL_TEMPLATES[0];
    return {
      headline: tmpl.headline,
      body: tmpl.body,
      separator: '※ 구조등급은 순환등급(축1~8)과 독립적으로 평가됩니다.',
    };
  })();

  // 12게이지 코드 (순서 고정)
  const INPUT_CODES = ["I1", "I2", "I3", "I4", "I5", "I6"];
  const OUTPUT_CODES = ["O1", "O2", "O3", "O4", "O5", "O6"];
  const ALL_CODES = [...INPUT_CODES, ...OUTPUT_CODES];
  // 7게이지 (자동) — 종합판정 테이블용
  const SEVEN_CODES = ["I1", "I3", "I4", "I6", "O2", "O4", "O6"];
  // 5게이지 (보조) — 보조 분석용
  const FIVE_CODES = ["I2", "I5", "O1", "O3", "O5"];

  // ── 축2 무역/제조업 (동맥) 코드 ──
  const AXIS2_SAT = ["S1", "S2", "S3"];  // 위성 게이지
  const AXIS2_TRAD = ["T1", "T2", "T3"]; // 통계 게이지
  const AXIS2_CODES = [...AXIS2_SAT, ...AXIS2_TRAD];

  // 축3 골목시장 — 미세혈관
  const AXIS3_CODES = ["M1", "M2", "M3", "M4", "M5"];

  // 축4 부동산 X-ray — 뼈
  const AXIS4_MARKET = ["R1", "R2", "R3", "R4"];           // 4A 시세
  const AXIS4_SAT = ["R5", "R6", "R7", "R8"];              // 4B/4C 위성 팩트체크
  const AXIS4_ALERT = ["R9"];                                // 4D 괴리경보
  const AXIS4_CODES = [...AXIS4_MARKET, ...AXIS4_SAT, ...AXIS4_ALERT];

  // 축5 소비심리 — CSI (gauge-adapter Axis5 = S2_CSI만 남음)
  const AXIS5_CODES = ["L5"];

  // 축6 물가/재정 — 내분비 (gauge-adapter Axis6 = P1~P6 → E1~E5)
  // ★ core-engine A6(내분비/물가) 점수와 일치하도록 E 코드 사용
  const AXIS6_CODES = ["E1", "E2", "E3", "E4", "E5"];

  // 축7 금융 스트레스 — 혈액의 질
  const AXIS7_CODES = ["F1", "F2", "F3", "F4", "F5"];

  // 축8 고용/가계 — 인구취약 (gauge-adapter Axis8 = L2~L4, S5 → L1~L4)
  // ★ core-engine A8(인구/취약) 고용 점수와 일치하도록 L 코드 사용
  const AXIS8_CODES = ["L1", "L2", "L3", "L4"];

  // 축9 에너지/대외/환경 — 재생 (gauge-adapter Axis9 = G1~G6 + A1~A5)
  const AXIS9_CODES = ["G1", "G2", "G3", "G4", "G5", "G6", "A1", "A2", "A3", "A4", "A5"];

  // 헬퍼: 값 포맷
  function fmtValue(code) {
    const gauge = g[code];
    if (!gauge || !gauge.available) return "N/A";
    const v = gauge.value;
    const def = METAPHOR[code];
    if (!def) return String(v);
    // ── Input (순환계 핵심) ──
    if (code === "I1") return `${v}억$`;          // 무역수지(절대값)
    if (code === "I2") return `${v}%`;
    if (code === "I3") return `${v}%p`;            // 외환보유고변동(전월비%)
    if (code === "I4") return `${v}%p`;            // 환율(전월비%)
    if (code === "I5") return `${v}bp`;            // 신용스프레드
    if (code === "I6") return `${v}%p`;            // 기준금리(전월변동 %p)
    // ── Output (호흡계 핵심) ──
    if (code === "O1") return `${v}%`;             // 수출(전년비)
    if (code === "O2") return `${v}pt`;            // 제조업PMI
    if (code === "O3") return `${v}%`;             // 실업률변동
    if (code === "O4") return `${v}pt`;            // KOSPI
    if (code === "O5") return `${v}pt`;            // 주택가격지수
    if (code === "O6") return `${v}%`;             // 소매판매(전년비)
    if (code === "O7") return `${v}%`;             // 건설생산(전년비)
    // ── Axis2 무역/해운 ──
    if (code === "S1") return `${v}백만$`;         // 해운수지(T5_SHIPPING)
    if (code === "S2") return `${v}pt`;            // 발틱운임지수(BDI)
    if (code === "S3") return `${v}%`;
    if (code === "T1") return `${v}백만$`;         // 경상수지(T2_CURRENT_ACCOUNT)
    if (code === "T2") return `${v}pt`;            // 제조업BSI
    if (code === "T3") return `${v}pt`;            // 중국PMI
    // ── Axis3 내수/산업 대리지표 ──
    if (code === "M1") return `${v}%`;             // 재고지수(전년비)
    if (code === "M2") return `${v}%`;             // 출하지수(전년비)
    if (code === "M3") return `${v}%`;             // 산업생산지수(전년비)
    if (code === "M4") return `${v}%`;             // 설비가동률(전년비)
    if (code === "M5") return `${v}%`;
    // ── Axis4 건설/자산 대리지표 ──
    if (code === "R1") return `${v}%`;
    if (code === "R2") return `${v}%`;             // 시멘트생산(전년비)
    if (code === "R3") return `${v}%`;             // 철강재생산(전년비)
    if (code === "R4") return `${v}%`;             // 자동차생산(전년비)
    if (code === "R5") return `${v}m`;
    if (code === "R6") return `${v}°C`;            // 도시열섬이상(°C, R6_UHI)
    if (code === "R7") return `${v}%`;
    if (code === "R8") return `${v}℃`;
    if (code === "R9") return `${v}개월`;
    // ── Axis5 고용/가계 ──
    if (code === "L1") return `${v}천명`;          // 취업자수증감(S5_EMPLOY)
    if (code === "L2") return `${v}%`;             // 경제활동참가율변동
    if (code === "L3") return `${v}%`;             // 임금(전년비)
    if (code === "L4") return `${v}%`;             // 근로시간변동
    if (code === "L5") return `${v}pt`;            // 소비자심리(CSI)
    // ── Axis6 물류/대외 ──
    if (code === "G1") return `${v}백만$`;         // 서비스수지(T3_FDI)
    if (code === "G2") return `${v}백만$`;         // 운송수지(I5_CARGO)
    if (code === "G3") return `${v}백만$`;         // 항공운송수지(I6_AIRPORT)
    if (code === "G4") return `${v}천명`;          // 운수창고취업자(I7_RAILROAD)
    if (code === "G5") return `${v}pt`;            // 미국경기(OECD CLI)
    if (code === "G6") return `${v}%`;             // 야간광 위성
    if (code === "G7") return `${v}건`;
    // ── Axis7 금융스트레스 ──
    if (code === "F1") return `${v}%`;             // KOSDAQ(전일비%)
    if (code === "F2") return `${v}%`;             // 달러인덱스(전일비%)
    if (code === "F3") return `${v}%`;             // VIX(공포지수 전일비%)
    if (code === "F4") return `${v}%`;             // KOSDAQ거래량(전일비%)
    if (code === "F5") return `${v}bp`;
    if (code === "F8") return `${v}백만원`;        // 외국인순매수
    // ── Axis8 에너지/물가 ──
    if (code === "E1") return `${v}%`;             // CPI(소비자물가전년비)
    if (code === "E2") return `${v}%`;             // PPI(생산자물가전년비)
    if (code === "E3") return `${v}%`;             // 수입물가지수(전년비%)
    if (code === "E4") return `${v}%`;             // 수출물가지수(전년비%)
    if (code === "E5") return `${v}백만$`;         // 상품수지(원자재대리)
    // ── Axis9 재생/환경 ──
    if (code === "A1") return `${v}천명`;          // 농림어업취업자(R8_FOREST)
    if (code === "A2") return `${v}%`;             // 폐기물처리업생산(전년비)
    if (code === "A3") return `${v}%`;             // 전기가스수도업생산(전년비)
    if (code === "A4") return `${v}%`;             // 수도업생산(전년비)
    if (code === "A5") return `${v}%`;             // 석탄광업생산(전년비)
    return String(v);
  }
  function fmtChange(code) {
    const gauge = g[code];
    if (!gauge || gauge.change === null || gauge.change === undefined) return "";
    const c = gauge.change;
    const sign = c > 0 ? "+" : "";
    // ── Input ──
    if (code === "I1") return `${sign}${c}억$`;
    if (code === "I2") return `${sign}${c}%p`;
    if (code === "I3") return `${sign}${c}%p`;
    if (code === "I4") return `${sign}${c}%p`;
    if (code === "I5") return `${sign}${c}bp`;
    if (code === "I6") return `${sign}${c}%p`;
    // ── Output ──
    if (code === "O1") return `${sign}${c}%p`;
    if (code === "O2") return `${sign}${c}pt`;     // PMI
    if (code === "O3") return `${sign}${c}%p`;
    if (code === "O4") return `${sign}${c}%`;      // KOSPI
    if (code === "O5") return `${sign}${c}pt`;     // 주택가격지수
    if (code === "O6") return `${sign}${c}%p`;
    if (code === "O7") return `${sign}${c}%p`;
    // ── Axis2 ──
    if (code === "S1") return `${sign}${c}백만$`;
    if (code === "S2") return `${sign}${c}pt`;     // BDI
    if (code === "S3") return `${sign}${c}%p`;
    if (code === "T1") return `${sign}${c}백만$`;  // 경상수지
    if (code === "T2") return `${sign}${c}pt`;     // BSI
    if (code === "T3") return `${sign}${c}pt`;     // 중국PMI
    // ── Axis3 ──
    if (code === "M1") return `${sign}${c}%p`;
    if (code === "M2") return `${sign}${c}%p`;
    if (code === "M3") return `${sign}${c}%p`;
    if (code === "M4") return `${sign}${c}%p`;
    if (code === "M5") return `${sign}${c}%p`;
    // ── Axis4 ──
    if (code === "R1") return `${sign}${c}%p`;
    if (code === "R2") return `${sign}${c}%p`;
    if (code === "R3") return `${sign}${c}%p`;
    if (code === "R4") return `${sign}${c}%p`;
    if (code === "R5") return `${sign}${c}m`;
    if (code === "R6") return `${sign}${c}°C`;     // 도시열섬
    if (code === "R7") return `${sign}${c}%p`;
    if (code === "R8") return `${sign}${c}℃`;
    if (code === "R9") return `${sign}${c}개월`;
    // ── Axis5 ──
    if (code === "L1") return `${sign}${c}천명`;   // 취업자수증감
    if (code === "L2") return `${sign}${c}%p`;     // 경활율변동
    if (code === "L3") return `${sign}${c}%p`;
    if (code === "L4") return `${sign}${c}%p`;
    if (code === "L5") return `${sign}${c}pt`;
    // ── Axis6 ──
    if (code === "G1") return `${sign}${c}백만$`;
    if (code === "G2") return `${sign}${c}백만$`;
    if (code === "G3") return `${sign}${c}백만$`;
    if (code === "G4") return `${sign}${c}천명`;
    if (code === "G5") return `${sign}${c}pt`;
    if (code === "G6") return `${sign}${c}%p`;
    if (code === "G7") return `${sign}${c}건`;
    // ── Axis7 ──
    if (code === "F1") return `${sign}${c}%p`;    // KOSDAQ
    if (code === "F2") return `${sign}${c}%p`;    // 달러인덱스
    if (code === "F3") return `${sign}${c}%p`;    // VIX 전일비
    if (code === "F4") return `${sign}${c}%p`;    // KOSDAQ거래량 전일비
    if (code === "F5") return `${sign}${c}bp`;
    if (code === "F8") return `${sign}${c}백만원`;
    // ── Axis8 ──
    if (code === "E1") return `${sign}${c}%p`;    // CPI
    if (code === "E2") return `${sign}${c}%p`;    // PPI
    if (code === "E3") return `${sign}${c}%p`;    // 수입물가지수 YoY
    if (code === "E4") return `${sign}${c}%p`;    // 수출물가지수 YoY
    if (code === "E5") return `${sign}${c}백만$`; // 상품수지
    // ── Axis9 ──
    if (code === "A1") return `${sign}${c}천명`;
    if (code === "A2") return `${sign}${c}%p`;
    if (code === "A3") return `${sign}${c}%p`;    // 전기가스수도업생산
    if (code === "A4") return `${sign}${c}%p`;    // 수도업생산
    if (code === "A5") return `${sign}${c}%p`;    // 석탄광업생산
    return `${sign}${c}`;
  }
  function getGrade(code) {
    return g[code]?.grade || "N/A";
  }
  function gradeToJudge(grade) {
    if (grade.includes("양호")) return "정상";
    if (grade.includes("주의")) return "주의";
    if (grade.includes("경보")) return "경보";
    return "N/A";
  }

  // ── 경보 ──
  const alertInfo = ALERT_MAP[al.level] || ALERT_MAP[0];

  // ── 게이지 테이블 (섹션1) — 7게이지 자동 ──
  const gaugeTable = SEVEN_CODES.map(code => ({
    cat: ["I1","I2","I3","I4","I5","I6"].includes(code) ? "Input" : "Output",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  // ── 보조 5게이지 테이블 ──
  const auxGaugeTable = FIVE_CODES.filter(c => g[c]?.available).map(code => ({
    cat: ["I2","I5"].includes(code) ? "Input" : "Output",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  // 등급 카운트 (12게이지 전체)
  const gradeCount = { ok: 0, warn: 0, alert: 0 };
  ALL_CODES.filter(c => g[c]?.available).forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) gradeCount.alert++;
    else if (gr.includes("주의")) gradeCount.warn++;
    else gradeCount.ok++;
  });

  // ── 섹션1 서사 (기준 DOCX v3 수준) ──
  const totalAvail = ALL_CODES.filter(c => g[c]?.available).length;
  const warnCodes  = ALL_CODES.filter(c => g[c]?.available && getGrade(c).includes("주의"));
  const alertCodes = ALL_CODES.filter(c => g[c]?.available && getGrade(c).includes("경보"));

  // 병명 자동 생성: 경보 패턴 → 한의학적 병명
  const _hasH    = (getGrade("I4") !== "양호 ○" || getGrade("I6") !== "양호 ○"); // 혈압/금리
  const _hasD    = getGrade("I1") === "경보 ★"; // 경상수지 적자
  const _hasCold = getGrade("O4") === "경보 ★" && getGrade("O6") === "경보 ★"; // 주가+소비 동반
  const _hasHeat = getGrade("O2") === "경보 ★"; // 물가 급등
  let _clinicalName = "";
  if (bl.dual) _clinicalName = "이중봉쇄 — 경제 급사 위험";
  else if (_hasCold && _hasH) _clinicalName = "하한(下寒) 증후군 — 전신 냉각 진행 중";
  else if (_hasHeat && _hasH) _clinicalName = "열독(熱毒) 증후군 — 인플레 독소 누적";
  else if (_hasD) _clinicalName = "소득절벽 — 외부 산소 공급 차단 위험";
  else if (alertCodes.length >= 3) _clinicalName = "복합 경보 — 다발성 흐름 장애";
  else if (alertCodes.length >= 1) _clinicalName = `${alertCodes.map(c => METAPHOR[c]?.bodyPart || c).join("·")} 경보 상태`;
  else if (warnCodes.length >= 2) _clinicalName = "잠복기 — 미세석회 침착 주시 필요";
  else _clinicalName = "전신 순환 안정 — 무증상 정상 범위";

  const sec1_alertNarrative = _clinicalName;

  // 병리적 연결고리 — Input 경보→Output 영향 추적
  const _pathLines = [];
  if (getGrade("I4") === "경보 ★") {
    const _i4v = fmtValue("I4");
    _pathLines.push(`환율 ${_i4v} 급등(혈압 위기)은 수입물가를 끌어올리고 외국인 자본 이탈을 자극한다.`);
  }
  if (getGrade("I1") !== "양호 ○") {
    _pathLines.push(`경상수지 위축(폐 기능 저하)은 달러 공급 감소로 이어져 환율 추가 상승 압력을 만든다.`);
  }
  if (getGrade("O4") === "경보 ★") {
    _pathLines.push(`주가 하락(혈류 감소)은 자산효과 소멸로 소비 심리를 직격하고 내수를 위축시킨다.`);
  }
  if (getGrade("O6") === "경보 ★") {
    _pathLines.push(`소비 급감(말단 괴사)은 2년 이상 지속 시 구조적 3M(피폐·정책 무반응) 진입을 예고한다.`);
  }
  if (getGrade("O2") !== "양호 ○") {
    _pathLines.push(`물가 상승(체온 상승)은 환율발 수입물가 경로로 추가 자극될 수 있어 A(물가폭등) 트리거 잠복 관찰이 필요하다.`);
  }
  if (_pathLines.length === 0) _pathLines.push("현재 주요 게이지 간 연쇄 악화 경로는 감지되지 않는다. 단월 변동에 유의하며 추이를 관찰한다.");

  let sec1_detail = (() => {
    const _parts = [];
    // 전체 판정 요약
    _parts.push(`현재 ${totalAvail}개 게이지 중 경보 ${alertCodes.length}개, 주의 ${warnCodes.length}개, 양호 ${gradeCount.ok}개다.`);
    // 경보 게이지 인체비유 상세
    if (alertCodes.length > 0) {
      const _alertDescs = alertCodes.map(c => {
        const m = METAPHOR[c];
        const mInfo = m?.[getGrade(c)] || m?.["양호 ○"];
        return `${m?.bodyPart || c}(${c}: ${fmtValue(c)})이 ${mInfo?.metaphor || '경보 수준'}이다`;
      });
      _parts.push(_alertDescs.join(". ") + ".");
    }
    // CAM/DLT 상태
    _parts.push(`CAM(자본대사·동맥) ${bl.cam}, DLT(말단순환·정맥) ${bl.dlt}${bl.dual ? " — 이중봉쇄 발생. 급사 위험 단계." : bl.cam !== "양호" || bl.dlt !== "양호" ? ". 단독봉쇄 상태." : ". 이중봉쇄 미발생."}`);
    // DIAH 상태
    _parts.push(`DIAH 트리거: ${diah.label}.`);
    return _parts.join(" ");
  })();

  // sec1_pathology: 병리적 연결고리 서사
  const sec1_pathology = _pathLines.join(" ");

  // ── 섹션2 심폐계 (Input 6게이지) ──
  const sec2_gauges = INPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  // 심폐계 종합
  const inputGrades = INPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(c => getGrade(c));
  const inputKeywords = INPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    const info = m[gr] || m["양호 ○"];
    return `${m.bodyPart} ${gr.includes("양호") ? "안정" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  // ── 섹션3 순환계-말단 (Output 6게이지) ──
  const sec3_gauges = OUTPUT_CODES.filter(c => g[c]?.available && METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = (() => {
      let info = m[grade] || m["양호 ○"];
      // 값이 음수인데 양호 등급이면 비유를 주의 수준으로 보정
      if (code === "O6" && g[code].value < 0 && grade === "양호 ○") info = m["주의 ●"];
      if (code === "O1" && g[code].value < 0 && grade === "양호 ○") info = m["주의 ●"];
      return info;
    })();
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  // ── 섹션4 DIAH ──

  // ══════════════════════════════════════
  // 축2. 무역/제조업 — 동맥 혈류
  // ══════════════════════════════════════
  const axis2_available = AXIS2_CODES.filter(c => g[c]?.available);
  const axis2_gauges = axis2_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  // 축2 게이지 테이블 (종합판정 보조)
  const axis2_gaugeTable = axis2_available.map(code => ({
    cat: AXIS2_SAT.includes(code) ? "위성" : "통계",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  // 축2 종합 키워드
  const axis2_keywords = axis2_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  // 축2 gradeCount
  const axis2_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis2_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis2_gradeCount.alert++;
    else if (gr.includes("주의")) axis2_gradeCount.warn++;
    else axis2_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축3. 골목시장 — 미세혈관
  // ══════════════════════════════════════
  const axis3_available = AXIS3_CODES.filter(c => g[c]?.available);
  const axis3_gauges = axis3_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis3_gaugeTable = axis3_available.map(code => ({
    cat: "골목",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis3_keywords = axis3_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis3_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis3_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis3_gradeCount.alert++;
    else if (gr.includes("주의")) axis3_gradeCount.warn++;
    else axis3_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축4. 부동산 X-ray — 뼈
  // ══════════════════════════════════════
  const axis4_available = AXIS4_CODES.filter(c => g[c]?.available);
  const axis4_gauges = axis4_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis4_gaugeTable = axis4_available.map(code => ({
    cat: AXIS4_MARKET.includes(code) ? "시세" : AXIS4_SAT.includes(code) ? "위성" : "괴리",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis4_keywords = axis4_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis4_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis4_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis4_gradeCount.alert++;
    else if (gr.includes("주의")) axis4_gradeCount.warn++;
    else axis4_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축5. 고용/가계 — 근육/신경
  // ══════════════════════════════════════
  const axis5_available = AXIS5_CODES.filter(c => g[c]?.available);
  const axis5_gauges = axis5_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis5_gaugeTable = axis5_available.map(code => ({
    cat: "소비심리",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis5_keywords = axis5_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis5_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis5_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis5_gradeCount.alert++;
    else if (gr.includes("주의")) axis5_gradeCount.warn++;
    else axis5_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축6. 물가/재정 — 체온 (E1~E5)
  // ══════════════════════════════════════
  const axis6_available = AXIS6_CODES.filter(c => g[c]?.available);
  const axis6_gauges = axis6_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis6_gaugeTable = axis6_available.map(code => ({
    cat: "물가",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis6_keywords = axis6_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis6_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis6_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis6_gradeCount.alert++;
    else if (gr.includes("주의")) axis6_gradeCount.warn++;
    else axis6_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축7. 금융 스트레스 — 혈액의 질
  // ══════════════════════════════════════
  const axis7_available = AXIS7_CODES.filter(c => g[c]?.available);
  const axis7_gauges = axis7_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });

  const axis7_gaugeTable = axis7_available.map(code => ({
    cat: "금융",
    code: `${code} ${METAPHOR[code]?.name || g[code]?.name || code}`,
    raw: fmtValue(code),
    change: fmtChange(code),
    grade: getGrade(code),
    judge: gradeToJudge(getGrade(code)),
  }));

  const axis7_keywords = axis7_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c];
    const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });

  const axis7_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis7_available.forEach(code => {
    const gr = getGrade(code);
    if (gr.includes("경보")) axis7_gradeCount.alert++;
    else if (gr.includes("주의")) axis7_gradeCount.warn++;
    else axis7_gradeCount.ok++;
  });

  // ══════════════════════════════════════
  // 축8. 고용/가계 — 근력/취약 (L1~L4)
  // ══════════════════════════════════════
  const axis8_available = AXIS8_CODES.filter(c => g[c]?.available);
  const axis8_gauges = axis8_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });
  const axis8_gaugeTable = axis8_available.map(code => ({
    cat: "고용",
    code: `${code} ${METAPHOR[code]?.name || code}`,
    raw: fmtValue(code), change: fmtChange(code),
    grade: getGrade(code), judge: gradeToJudge(getGrade(code)),
  }));
  const axis8_keywords = axis8_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c]; const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });
  const axis8_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis8_available.forEach(code => { const gr = getGrade(code); if (gr.includes("경보")) axis8_gradeCount.alert++; else if (gr.includes("주의")) axis8_gradeCount.warn++; else axis8_gradeCount.ok++; });

  // ══════════════════════════════════════
  // 축9. 대외/에너지 — 외화혈관·재생 (G1~G6, A1~A5)
  // ══════════════════════════════════════
  const axis9_available = AXIS9_CODES.filter(c => g[c]?.available);
  const axis9_gauges = axis9_available.filter(c => METAPHOR[c]).map(code => {
    const grade = getGrade(code);
    const m = METAPHOR[code];
    const mInfo = m[grade] || m["양호 ○"];
    return {
      code: `${code} ${m.name}`,
      value: `${fmtValue(code)} (${fmtChange(code)})`.replace("()", ""),
      metaphor: mInfo.metaphor,
      grade: grade.replace("양호 ○", "○ 양호").replace("주의 ●", "● 주의").replace("경보 ★", "★ 경보"),
      narrative: m.narrativeTemplate(fmtValue(code), fmtChange(code), grade),
      diagnosis: m.diagnosisTemplate[grade] ? m.diagnosisTemplate[grade](fmtValue(code), fmtChange(code)) : "",
    };
  });
  const axis9_gaugeTable = axis9_available.map(code => ({
    cat: "대외",
    code: `${code} ${METAPHOR[code]?.name || code}`,
    raw: fmtValue(code), change: fmtChange(code),
    grade: getGrade(code), judge: gradeToJudge(getGrade(code)),
  }));
  const axis9_keywords = axis9_available.filter(c => METAPHOR[c]).map(c => {
    const m = METAPHOR[c]; const gr = getGrade(c);
    return `${m.bodyPart} ${gr.includes("양호") ? "정상" : gr.includes("주의") ? "주의" : "경보"}`;
  });
  const axis9_gradeCount = { ok: 0, warn: 0, alert: 0 };
  axis9_available.forEach(code => { const gr = getGrade(code); if (gr.includes("경보")) axis9_gradeCount.alert++; else if (gr.includes("주의")) axis9_gradeCount.warn++; else axis9_gradeCount.ok++; });

  // ══════════════════════════════════════
  // 체감경제 경보 — 거시 양호 + 미세혈관(가계·골목) 심각
  // ══════════════════════════════════════
  // 거시(수출·금융) 양호 + 미세혈관(골목·가계) 압박 = 체감경제 경보
  // 체감 = 거시지표와 현장 사이의 구조적 괴리
  // axis3 = 골목시장(미세혈관), axis5 = 가계·고용(세포 레벨)
  const _chaegamLevel = (() => {
    const microAlert = (axis3_gradeCount.alert || 0) + (axis5_gradeCount.alert || 0);
    const microWarn  = (axis3_gradeCount.warn  || 0) + (axis5_gradeCount.warn  || 0);
    // 거시 양호 조건: Layer A 급성 경보 없음 + 수출 동맥(axis2) 경보 없음
    const macroOk = al.level === 0 && (axis2_gradeCount.alert || 0) === 0;
    if (!macroOk) return null; // 거시 자체 문제 있으면 체감경제 경보 별도 발령 불필요
    if (microAlert >= 2) return 'critical';   // 골목+가계 동시 경보 ≥ 2개
    if (microAlert >= 1) return 'warning';    // 골목 또는 가계 경보 ≥ 1개
    if (microWarn  >= 3) return 'caution';    // 주의 신호 3개 이상 누적
    return null;
  })();
  const chaegam_alert = _chaegamLevel ? {
    level: _chaegamLevel,
    title: _chaegamLevel === 'critical'
      ? '⚠️ 체감경제 이중 경보 — 거시 양호, 가계·골목 동시 위기'
      : _chaegamLevel === 'warning'
        ? '⚠️ 체감경제 경보 — 거시 양호, 미세혈관 압박 심각'
        : '⚠️ 체감경제 주의 — 거시 안정, 가계·골목 압박 누적',
    axis3Summary: `골목시장(미세혈관): ${axis3_gradeCount.alert}개 경보, ${axis3_gradeCount.warn}개 주의`,
    axis5Summary: `가계·고용(세포): ${axis5_gradeCount.alert}개 경보, ${axis5_gradeCount.warn}개 주의`,
    narrative: _chaegamLevel === 'critical'
      ? `거시 지표(수출·금융)는 안정적이나, 경제의 미세혈관과 세포층이 동시에 막히고 있습니다. ` +
        `대동맥(대기업·수출)에 피가 흐른다고 골목과 가계까지 닿지 않습니다. ` +
        `가계부채 이자(미세석회)가 소비와 창업 의지를 이중으로 봉쇄하는 구조입니다. ` +
        `거시 지표와 체감경제의 괴리가 임계점에 달했습니다.`
      : _chaegamLevel === 'warning'
        ? `거시 지표는 안정권이나 미세혈관(골목상권·가계)에 경보 신호가 포착되었습니다. ` +
          `부채 이자(미세석회)가 쌓이면 체감경기가 먼저 무너집니다. ` +
          `선행 지표로 관찰이 필요합니다.`
        : `거시 지표는 안정적이나 가계·골목 영역에 주의 신호가 누적되고 있습니다. ` +
          `미세석회(이자 누적)의 잠복 심화로 체감경제가 악화될 수 있습니다.`,
  } : null;

  // ── 섹션4 DIAH (원래 위치) ──
  const diahContext = {
    baseRate: meta.baseRate || "미확인",
    i6Grade: getGrade("I6"), o6Grade: getGrade("O6"), o6Value: fmtValue("O6"),
    o2Grade: getGrade("O2"), o2Value: fmtValue("O2"),
    i1Grade: getGrade("I1"), i1Value: fmtValue("I1"),
    i4Grade: getGrade("I4"), i4Value: fmtValue("I4"),
    o4Grade: getGrade("O4"),
    // H(저산소) 직접 지표 — 생산 중단 감시 (O3_IP=산업생산, O4_CAPACITY=설비가동률)
    o3Grade: getGrade("O3_IP"),     o3Value: g["O3_IP"]?.value != null ? `${g["O3_IP"].value}%` : "N/A",
    o4CapGrade: getGrade("O4_CAPACITY"), o4CapValue: g["O4_CAPACITY"]?.value != null ? `${g["O4_CAPACITY"].value}%` : "N/A",
  };
  const sec4_triggers = ["H", "A", "D", "I"].map(code => {
    const dn = DIAH_NARRATIVE[code];
    const isActive = diah.active.includes(code);
    return {
      code, name: dn.name,
      text: isActive ? dn.active(diahContext) : dn.dormant(diahContext),
    };
  });

  // DIAH 종합
  let sec4_summary = `DIAH 종합: 트리거 ${diah.label}`;
  if (diah.active.length === 0) {
    const dormantHints = [];
    // H(저산소) 직접 지표: 산업생산·가동률 경보 → 생산 중단 선행 신호
    if (getGrade("O3_IP") !== "양호 ○" || getGrade("O4_CAPACITY") !== "양호 ○") dormantHints.push("H 잠복 — 산업생산·가동률 경계");
    if (getGrade("I6") !== "양호 ○" || getGrade("I4") !== "양호 ○") dormantHints.push("H/D 잠복 관찰");
    if (getGrade("O6") !== "양호 ○") dormantHints.push("소비 위축 지속");
    if (dormantHints.length > 0) sec4_summary += `이나 ${dormantHints.join(", ")} 필요.`;
  }

  // ── 섹션5 7M ──
  const currentM = typeof m7.current === "object" ? m7.current.m : (m7.current || "0M");
  const currentMData = M7_TABLE.find(m => m.stage === currentM) || M7_TABLE[0];
  const nextM = typeof m7.next === "object" ? m7.next.m : (m7.next || "1M");
  const nextMData = M7_TABLE.find(m => m.stage === nextM) || M7_TABLE[1];

  // ── 출처 테이블 (고정 구조) ──
  const sources = [
    { code: "I1",  data: "경상수지",     source: "ECOS", org: "한국은행",   period: "월간 (1~2개월 지연)" },
    { code: "I3",  data: "외환보유고",   source: "ECOS", org: "한국은행",   period: "월간 (1개월 지연)" },
    { code: "I4",  data: "환율",         source: "ECOS", org: "한국은행",   period: "일간/준실시간" },
    { code: "I6",  data: "국채금리",     source: "ECOS", org: "한국은행",   period: "일간" },
    { code: "O2",  data: "소비자물가",   source: "KOSIS", org: "통계청",    period: "월간 (익월 초)" },
    { code: "O4",  data: "주가(KOSPI)",  source: "KRX",  org: "한국거래소", period: "일간/준실시간 15분" },
    { code: "O6",  data: "소매판매",     source: "KOSIS", org: "통계청",    period: "월간 (2개월 지연)" },
    // 축2 무역/제조업 출처
    { code: "T5",  data: "선박 입출항",   source: "AIS",   org: "UN Global Platform", period: "준실시간" },
    { code: "G6",  data: "야간광량",     source: "VIIRS", org: "NOAA",      period: "30일 이동평균" },
    { code: "S3",  data: "NO₂ 농도",    source: "Sentinel-5P", org: "ESA",  period: "30일 이동평균" },
    { code: "T6",  data: "컨테이너 TEU", source: "해수부", org: "해양수산부",  period: "월간 (1개월 지연)" },
    { code: "T2",  data: "제조업 BSI",   source: "ECOS",  org: "한국은행",   period: "월간" },
    { code: "R1",  data: "산업용 전력",   source: "전력거래소", org: "전력거래소", period: "월간" },
    // 축3 골목시장 출처 (향후 연동 예정)
    { code: "C1",  data: "개폐업 현황",   source: "상가DB",    org: "소상공인진흥공단", period: "분기 (예정)" },
    { code: "C2",  data: "유동인구",      source: "열린데이터", org: "서울시",         period: "월간 (예정)" },
    { code: "C3",  data: "카드매출",      source: "로컬데이터", org: "행안부",         period: "월간 (예정)" },
    { code: "C4",  data: "상가 임대차",   source: "실거래가",   org: "국토부",         period: "월간 (예정)" },
    { code: "C5",  data: "상권 등급",     source: "상권정보",   org: "소진공",         period: "분기 (예정)" },
    // 축4 부동산 출처 (향후 연동 예정)
    { code: "M1",  data: "아파트 실거래가", source: "실거래가",   org: "국토부",         period: "월간 (예정)" },
    { code: "M2",  data: "미분양 통계",    source: "실거래가",   org: "국토부",         period: "월간 (예정)" },
    { code: "M3",  data: "전세가율",       source: "KB부동산",   org: "KB",            period: "월간 (예정)" },
    { code: "O5",  data: "경매 건수",      source: "경매정보",   org: "대법원",         period: "월간 (예정)" },
    { code: "R5",  data: "건물 높이(SAR)", source: "Sentinel-1", org: "ESA/Copernicus", period: "수시 (순차 확대)" },
    { code: "R6",  data: "야간광(신축)",   source: "VIIRS",      org: "NOAA",          period: "30일 이동평균" },
    { code: "R5",  data: "주차장 점유",    source: "Sentinel-2", org: "ESA/Copernicus", period: "수시 (순차 확대)" },
    { code: "R6",  data: "건물 표면온도",  source: "Landsat",    org: "USGS/NASA",     period: "60일 평균" },
    { code: "DIAH", data: "괴리 경보",     source: "자체엔진",   org: "DIAH-7M",       period: "실시간 산출" },
    // 축5 고용/가계 출처
    { code: "L1",  data: "고용동향",       source: "KOSIS",     org: "통계청",         period: "월간 (익월 중순)" },
    { code: "L2",  data: "실업급여",       source: "고용부",    org: "고용노동부",     period: "월간" },
    { code: "L3",  data: "가계부채",       source: "ECOS",      org: "한국은행",       period: "분기 (1분기 지연)" },
    { code: "L4",  data: "연체율",         source: "금감원",    org: "금융감독원",     period: "분기" },
    { code: "S5",  data: "체감경기 CSI",   source: "ECOS",      org: "한국은행",       period: "월간" },
    // 축6 지역균형 출처 (향후 연동 예정)
    { code: "D3",  data: "지방소멸지수",   source: "소멸지수",  org: "한국고용정보원",  period: "연간 (예정)" },
    { code: "G1",  data: "지역별 GRDP",   source: "KOSIS",     org: "통계청",         period: "연간 (예정)" },
    { code: "D2",  data: "지역별 인구이동", source: "전입전출",  org: "통계청",         period: "월간 (예정)" },
    { code: "C5",  data: "지역별 창폐업",  source: "상가정보",  org: "소진공",         period: "분기 (예정)" },
    { code: "G1",  data: "지방재정자립도", source: "지방재정365", org: "행안부",        period: "연간 (예정)" },
    { code: "G6",  data: "지역별 야간광",  source: "VIIRS",     org: "NOAA",          period: "30일 이동평균" },
    { code: "R1",  data: "특구 투자유치",  source: "산업부",    org: "산업통상자원부",  period: "분기 (예정)" },
    // 축7 금융 스트레스 출처
    { code: "F3",  data: "회사채 스프레드", source: "금투협",    org: "금융투자협회",    period: "일간" },
    { code: "F5",  data: "CP 금리",        source: "ECOS",      org: "한국은행",       period: "일간" },
    { code: "F6",  data: "은행 BIS 비율",  source: "금감원",    org: "금융감독원",     period: "분기 (1분기 지연)" },
    { code: "F1",  data: "코스피 변동성",  source: "KRX",       org: "한국거래소",     period: "일간/준실시간" },
    { code: "F2",  data: "은행채 스프레드", source: "금투협",    org: "금융투자협회",    period: "일간" },
    // 축8 에너지/자원 출처
    { code: "P3",  data: "유가 Dubai",     source: "Opinet",    org: "한국석유공사",    period: "일간" },
    { code: "P4",  data: "전력 예비율",    source: "전력거래소",  org: "전력거래소",     period: "일간/실시간" },
    { code: "P5",  data: "LNG 재고",      source: "가스공사",    org: "한국가스공사",    period: "월간" },
    { code: "R1",  data: "산업용 전력",    source: "전력거래소",  org: "전력거래소",     period: "월간" },
    { code: "P6",  data: "원자재 가격지수", source: "ECOS",      org: "한국은행",       period: "월간" },
    // 축9 인구/노화 출처
    { code: "D1",  data: "합계출산율",     source: "KOSIS",     org: "통계청",         period: "연간 (익년 초)" },
    { code: "D2",  data: "고령화율",       source: "KOSIS",     org: "통계청",         period: "연간" },
    { code: "D3",  data: "생산가능인구",   source: "KOSIS",     org: "통계청",         period: "연간" },
    { code: "D3",  data: "학령인구",       source: "교육부",    org: "교육부",         period: "연간" },
    { code: "D2",  data: "이민 순유입",    source: "법무부",    org: "법무부",         period: "분기" },
  ];

  // ══════════════════════════════════════
  // D 객체 조립
  // ══════════════════════════════════════

  const D = {
    // 메타
    month: meta.month,
    writeDate: meta.writeDate || new Date().toLocaleDateString('ko-KR', { year:'numeric', month:'long', day:'numeric' }),
    engineVersion: meta.engineVersion || "DIAH-7M 판정엔진 v5.0 + 서사엔진 v2.7",
    dataNote: meta.dataNote || "",

    // 경보
    alertEmoji: alertInfo.emoji,
    alertLevel: alertInfo.label,
    alertColor: alertInfo.color,
    oneLiner: meta.oneLiner || (chaegam_alert
      ? `${alertInfo.label.split(":")[0]} 판정 — ${chaegam_alert.title}`
      : `${alertInfo.label.split(":")[0]} 판정`),
    camStatus: `${bl.cam === "양호" ? "🟢" : "🔴"} ${bl.cam}`,
    dltStatus: `${bl.dlt === "양호" ? "🟢" : "🔴"} ${bl.dlt}`,
    dualBlockade: bl.dual ? "발생" : "미발생",
    diahStatus: diah.label,

    // 섹션1
    gauges: gaugeTable,
    auxGauges: auxGaugeTable,
    sec1_alertNarrative,
    sec1_detail,
    sec1_pathology,  // 병리적 연결고리 서사 (v2.8 신규)

    // 섹션2
    sec2_title: `2. [심폐계] ${meta.sec2_titleSuffix || "Input 게이지 분석"}`,
    sec2_gauges,
    sec2_summary: meta.sec2_summary || `심폐계 종합: ${inputKeywords.join(", ")}`,
    sec2_summaryNarrative: meta.sec2_summaryNarrative || "심폐계 종합 서사를 meta에서 입력하세요.",

    // 섹션3
    sec3_title: `3. [순환계-말단] ${meta.sec3_titleSuffix || "Output 게이지 분석"}`,
    sec3_gauges,
    sec3_summary: meta.sec3_summary || "순환계 종합",
    sec3_summaryNarrative: meta.sec3_summaryNarrative || "순환계 종합 서사를 meta에서 입력하세요.",

    // ── 축2 무역/제조업 (동맥 혈류) ──
    axis2_title: meta.axis2_titleSuffix
      ? `[동맥] ${meta.axis2_titleSuffix}`
      : `[동맥] 무역/제조업 — 수출 동맥의 혈류 점검`,
    axis2_gauges,
    axis2_gaugeTable,
    axis2_summary: meta.axis2_summary || (axis2_available.length > 0
      ? `동맥 종합: ${axis2_keywords.join(", ")}`
      : "축2 데이터 미입력"),
    axis2_summaryNarrative: meta.axis2_summaryNarrative || (axis2_available.length > 0
      ? `${axis2_gradeCount.ok}개 양호, ${axis2_gradeCount.warn}개 주의, ${axis2_gradeCount.alert}개 경보. ${axis2_gradeCount.alert > 0 ? "동맥 혈류에 경보 신호가 감지되었다." : axis2_gradeCount.warn > 0 ? "동맥 혈류에 주의 신호가 관찰된다." : "동맥 혈류가 원활하다."}`
      : "축2 데이터 미입력"),
    axis2_available: axis2_available.length > 0,

    // ── 축3 골목시장 (미세혈관) ──
    axis3_title: meta.axis3_titleSuffix
      ? `[미세혈관] ${meta.axis3_titleSuffix}`
      : `[미세혈관] 골목시장 — 경제의 미세혈관 점검`,
    axis3_gauges,
    axis3_gaugeTable,
    axis3_summary: meta.axis3_summary || (axis3_available.length > 0
      ? `미세혈관 종합: ${axis3_keywords.join(", ")}`
      : "축3 데이터 미입력"),
    axis3_summaryNarrative: meta.axis3_summaryNarrative || (axis3_available.length > 0
      ? `${axis3_gradeCount.ok}개 양호, ${axis3_gradeCount.warn}개 주의, ${axis3_gradeCount.alert}개 경보. ${axis3_gradeCount.alert > 0 ? "미세혈관에 괴사 신호가 감지되었다. 골목 경제가 위험하다." : axis3_gradeCount.warn > 0 ? "미세혈관에 순환 장애 징후가 관찰된다." : "미세혈관 순환이 원활하다. 골목 상권이 살아있다."}`
      : "축3 데이터 미입력"),
    axis3_available: axis3_available.length > 0,

    // ── 축4 부동산 X-ray (뼈) ──
    axis4_title: meta.axis4_titleSuffix
      ? `[뼈] ${meta.axis4_titleSuffix}`
      : `[뼈] 부동산 X-ray — 골밀도 측정과 위성 팩트체크`,
    axis4_gauges,
    axis4_gaugeTable,
    axis4_summary: meta.axis4_summary || (axis4_available.length > 0
      ? `골격 종합: ${axis4_keywords.join(", ")}`
      : "축4 데이터 미입력"),
    axis4_summaryNarrative: meta.axis4_summaryNarrative || (axis4_available.length > 0
      ? `${axis4_gradeCount.ok}개 양호, ${axis4_gradeCount.warn}개 주의, ${axis4_gradeCount.alert}개 경보. ${axis4_gradeCount.alert > 0 ? "골격에 골절 또는 괴리 신호가 감지되었다. 부동산 구조 안정성 경보." : axis4_gradeCount.warn > 0 ? "골격에 약화 징후가 관찰된다. 골밀도 추적 필요." : "골격이 견고하다. 부동산 X-ray 정상."}`
      : "축4 데이터 미입력"),
    axis4_available: axis4_available.length > 0,

    // ── 축5 고용/가계 (근육/신경) ──
    axis5_title: meta.axis5_titleSuffix
      ? `[근육/신경] ${meta.axis5_titleSuffix}`
      : `[근육/신경] 고용/가계 — 경제의 근력과 통증 점검`,
    axis5_gauges,
    axis5_gaugeTable,
    axis5_summary: meta.axis5_summary || (axis5_available.length > 0
      ? `소비심리 종합: ${axis5_keywords.join(", ")}`
      : "축5 데이터 미입력"),
    axis5_summaryNarrative: meta.axis5_summaryNarrative || (axis5_available.length > 0
      ? `${axis5_gradeCount.ok}개 양호, ${axis5_gradeCount.warn}개 주의, ${axis5_gradeCount.alert}개 경보. ${axis5_gradeCount.alert > 0 ? "소비심리가 위험 수준이다. 소비 위축이 내수를 잠식하고 있다." : axis5_gradeCount.warn > 0 ? "소비심리 위축 징후가 관찰된다. 체감경기가 나빠지고 있다." : "소비심리가 양호하다. 체감경기가 안정적이다."}`
      : "축5 데이터 미입력"),
    axis5_available: axis5_available.length > 0,

    // ── 축6 물가/재정 (내분비) — core-engine A6 물가 점수와 일치 ──
    axis6_title: meta.axis6_titleSuffix
      ? `[내분비] ${meta.axis6_titleSuffix}`
      : `[내분비] 물가/재정 — 인플레이션·물가 점검`,
    axis6_gauges,
    axis6_gaugeTable,
    axis6_summary: meta.axis6_summary || (axis6_available.length > 0
      ? `물가/재정 종합: ${axis6_keywords.join(", ")}`
      : "축6 데이터 미입력"),
    axis6_summaryNarrative: meta.axis6_summaryNarrative || (axis6_available.length > 0
      ? `${axis6_gradeCount.ok}개 양호, ${axis6_gradeCount.warn}개 주의, ${axis6_gradeCount.alert}개 경보. ${axis6_gradeCount.alert > 0 ? "물가 압력이 임계점을 넘었다. 인플레이션이 경제 전반을 잠식하고 있다." : axis6_gradeCount.warn > 0 ? "물가 불안 징후가 관찰된다. 미세석회(빚 이자)가 굳어가고 있다." : "물가가 안정적이다. 인플레이션 압력이 통제 범위 내에 있다."}`
      : "축6 데이터 미입력"),
    axis6_available: axis6_available.length > 0,

    // ── 축7 금융 스트레스 (혈액의 질) ──
    axis7_title: meta.axis7_titleSuffix
      ? `[혈액의 질] ${meta.axis7_titleSuffix}`
      : `[혈액의 질] 금융 스트레스 — 혈액 점도·독소·면역 점검`,
    axis7_gauges,
    axis7_gaugeTable,
    axis7_summary: meta.axis7_summary || (axis7_available.length > 0
      ? `혈액의 질 종합: ${axis7_keywords.join(", ")}`
      : "축7 데이터 미입력"),
    axis7_summaryNarrative: meta.axis7_summaryNarrative || (axis7_available.length > 0
      ? `${axis7_gradeCount.ok}개 양호, ${axis7_gradeCount.warn}개 주의, ${axis7_gradeCount.alert}개 경보. ${axis7_gradeCount.alert > 0 ? "혈액에 혈전·독소가 위험 수준이다. 금융 시스템 경색 위험." : axis7_gradeCount.warn > 0 ? "혈액의 질이 악화되고 있다. 금융 스트레스 누적 중." : "혈액의 질이 양호하다. 금융시장이 안정적이다."}`
      : "축7 데이터 미입력"),
    axis7_available: axis7_available.length > 0,

    // ── 축8 고용/가계 (인구취약) — core-engine A8 고용 점수와 일치 ──
    axis8_title: meta.axis8_titleSuffix
      ? `[인구취약] ${meta.axis8_titleSuffix}`
      : `[인구취약] 고용/가계 — 노동시장·가계 체력 점검`,
    axis8_gauges,
    axis8_gaugeTable,
    axis8_summary: meta.axis8_summary || (axis8_available.length > 0
      ? `고용/가계 종합: ${axis8_keywords.join(", ")}`
      : "축8 데이터 미입력"),
    axis8_summaryNarrative: meta.axis8_summaryNarrative || (axis8_available.length > 0
      ? `${axis8_gradeCount.ok}개 양호, ${axis8_gradeCount.warn}개 주의, ${axis8_gradeCount.alert}개 경보. ${axis8_gradeCount.alert > 0 ? "고용이 무너졌다. 세포(가계·소상공인)가 가장 먼저 죽어가고 있다." : axis8_gradeCount.warn > 0 ? "고용 불안 징후가 관찰된다. 노동시장이 흔들리고 있다." : "고용이 안정적이다. 가계 체력이 유지되고 있다."}`
      : "축8 데이터 미입력"),
    axis8_available: axis8_available.length > 0,

    // ── 축9 에너지/대외/환경 (재생) — ⚠️ 구조축 [v2.8] ——
    axis9_title: meta.axis9_titleSuffix
      ? `[재생/대외] ${meta.axis9_titleSuffix}`
      : `[재생/대외] 에너지·환경·대외 — 재생 가능성 점검 ⚠️구조축`,
    axis9_type: 'structural',  // v2.8 신규: 구조축 타입 플래그
    axis9_gauges,
    axis9_gaugeTable,
    axis9_summary: meta.axis9_summary || (axis9_available.length > 0
      ? `대외/에너지 종합: ${axis9_keywords.join(", ")}`
      : "축9 데이터 미입력"),
    axis9_summaryNarrative: meta.axis9_summaryNarrative || (axis9_available.length > 0
      ? `${axis9_gradeCount.ok}개 양호, ${axis9_gradeCount.warn}개 주의, ${axis9_gradeCount.alert}개 경보. ${axis9_gradeCount.alert > 0 ? "대외수지·에너지 공급이 동시에 무너지고 있다. 재생·환경 기반 위기." : axis9_gradeCount.warn > 0 ? "대외수지·에너지 이상 징후가 관찰된다. 공급망 안정에 주의." : "대외수지·에너지 공급이 안정적이다. 재생·환경 기반이 건전하다."}`
      : "축9 데이터 미입력"),
    axis9_structuralNarrative: _structuralNarrative,  // v2.8 신규: 구조축 전용 서사
    axis9_available: axis9_available.length > 0,

    // 섹션4
    sec4_title: `4. DIAH 트리거 분석: ${meta.sec4_titleSuffix || "상태 점검"}`,
    sec4_verdict: `판정: ${diah.label}`,
    sec4_triggers,
    sec4_summary,

    // 섹션5
    sec5_current: currentM,
    sec5_currentName: currentMData.name,
    sec5_currentText: meta.sec5_currentText || `석회 작용이 기전 발현 수준에 ${currentM === "0M" ? "도달하지 않았다. 경제의 구조적 통로는 아직 개통 상태를 유지하고 있다." : "진입했다."}`,
    sec5_nextM: nextM,
    sec5_nextName: `${nextMData.name} (${nextMData.body.split("/")[0]})`,
    sec5_nextText: meta.sec5_nextText || `${currentM}에서 ${nextM}으로의 진입 조건은 거시석회의 급성 파열이다.`,

    // 섹션6 (예후는 정성 판단 필요 → meta에서 입력)
    sec6_intro: meta.sec6_intro || (() => {
      if (alertCodes.length >= 3) return "복수 경보 게이지가 동시 발동 중이다. 향후 3개월은 분기점이다. 세 가지 경로 중 어디로 향하는지 관찰한다.";
      if (alertCodes.length >= 1) return "경보 게이지가 발생했다. 현재 흐름이 지속되면 악화, 전환 조건이 충족되면 개선으로 분기한다.";
      if (warnCodes.length >= 2) return "복수 주의 신호가 감지되었다. 잠복 단계로, 추세 방향에 따라 세 경로 중 하나로 수렴한다.";
      return "주요 게이지가 안정적이다. 다만 구조적 취약성이 잠복하므로 3가지 경로를 사전에 점검한다.";
    })(),
    sec6_paths: meta.prognosis || (() => {
      // 자동 확률 계산: 경보/주의 수 + DIAH 활성 여부 기반
      const _alertN = alertCodes.length;
      const _warnN  = warnCodes.length;
      const _diahN  = diah.active.length;
      // 기본 확률 (개선/유지/악화)
      let pA = 30, pB = 50, pC = 20;
      if (_alertN >= 3 || _diahN >= 2) { pA = 10; pB = 40; pC = 50; }
      else if (_alertN >= 2 || _diahN >= 1) { pA = 20; pB = 45; pC = 35; }
      else if (_alertN === 1) { pA = 25; pB = 50; pC = 25; }
      else if (_warnN >= 3) { pA = 30; pB = 50; pC = 20; }
      else { pA = 40; pB = 45; pC = 15; }
      // 경보 코드 기반 경로 설명 자동 생성
      const _alertDesc = alertCodes.length > 0
        ? alertCodes.map(c => `${METAPHOR[c]?.name || c}(${c})` ).join(", ") + " 경보 해소"
        : "현재 추이 유지";
      const _warnDesc = warnCodes.length > 0
        ? warnCodes.map(c => `${METAPHOR[c]?.name || c}` ).join("·") + " 주의 신호 지속"
        : "현재 상태 유지";
      const _worstDesc = alertCodes.length > 0
        ? alertCodes.map(c => `${METAPHOR[c]?.name || c}(${c}) 악화` ).join(", ")
        : warnCodes.map(c => `${METAPHOR[c]?.name || c} 경보 전환` ).join(", ") || "주요 지표 추가 악화";
      // Input 최강 경보 코드 → 관찰변수
      const _topAlert = alertCodes[0] || warnCodes[0];
      const _watchMain = _topAlert ? `${_topAlert}(${METAPHOR[_topAlert]?.name || _topAlert})` : "핵심 지표 추이";
      return [
        { label: "경로 A — 개선", prob: `${pA}%`, text: `조건: ${_alertDesc} + 정책 효과 발현. 경과: 경보 게이지 정상 복귀 → CAM/DLT 봉쇄 해제 → 종합 등급 하향. 확률: ${pA}% (${_alertN === 0 ? "현 추이 유지 시 가장 가능성 높음" : "정책·외부 여건 동시 개선 필요"}).` },
        { label: "경로 B — 유지", prob: `${pB}%`, text: `조건: ${_warnDesc}. 경과: 경보 게이지 횡보 → ${_warnN > 0 ? "주의 수준 장기 유지 → 만성 피로 누적" : "현 상태 유지"}. 확률: ${pB}% (현재 가장 가능성 높은 시나리오).` },
        { label: "경로 C — 악화", prob: `${pC}%`, text: `조건: ${_worstDesc}. 경과: ${_diahN > 0 ? `DIAH ${diah.label} 심화 →` : "경보 게이지 추가 확대 →"} CAM 또는 DLT 봉쇄 → 이중봉쇄 위험. 위험 신호: ${_watchMain} 연속 악화 + DIAH 트리거 추가 활성. 확률: ${pC}%.` },
      ];
    })(),
    sec6_watchVars: meta.watchVars || (() => {
      const _vars = [];
      alertCodes.slice(0, 3).forEach(c => _vars.push(`${c}(${METAPHOR[c]?.name || c}) — 경보 지속 여부`));
      warnCodes.slice(0, 2).forEach(c => _vars.push(`${c}(${METAPHOR[c]?.name || c}) — 경보 전환 여부`));
      if (_vars.length === 0) _vars.push("I4 환율", "O6 소매판매", "O4 주가");
      return _vars;
    })(),

    // 섹션7 (시계열은 이전 데이터 필요 → meta에서 입력)
    sec7_data: meta.timeseriesOverride || [],
    sec7_months: meta.prevMonths ? [meta.prevMonths.m1, meta.prevMonths.m2, meta.prevMonths.m3] : ["N-2", "N-1", "N"],
    sec7_narrative: meta.sec7_narrative || "시계열 서사를 meta에서 입력하세요.",

    // v2.8+: 모드별 시계열 구조체 (보고서생성기 v3.1 호환)
    sec7_monthly: meta.sec7_monthly || {
      title: "7. 시계열 추이: 직전 3개월 변화",
      cols: meta.prevMonths ? [meta.prevMonths.m1, meta.prevMonths.m2, meta.prevMonths.m3] : ["N-2월", "N-1월", "N월"],
      data: meta.timeseriesOverride || [],
    },
    sec7_quarterly: meta.sec7_quarterly || {
      title: "7. 시계열 추이: 직전 4분기 변화",
      cols: ["Q-2", "Q-1", "Q0"],
      data: [],
    },
    sec7_annual: meta.sec7_annual || {
      title: "7. 시계열 추이: 직전 3개년 변화",
      cols: ["Y-2", "Y-1", "Y0"],
      data: [],
    },

    // 섹션8
    sec8_data: (() => {
      const items = ["경상수지", "외환보유고", "환율", "국채금리", "물가", "주가", "DIAH 트리거", "진단명"];
      const nowData = meta.familyHistoryNow || {};
      return items.map(item => ({
        item,
        y1997: FAMILY_HISTORY_PAST["1997"].data[item] || "",
        y2008: FAMILY_HISTORY_PAST["2008"].data[item] || "",
        now: nowData[item] || "",
      }));
    })(),
    sec8_narrative1997: FAMILY_HISTORY_PAST["1997"].narrative(meta.month),
    sec8_narrative2008: FAMILY_HISTORY_PAST["2008"].narrative(meta.month),
    sec8_common: FAMILY_HISTORY_PAST.common,

    // 섹션9 — 처방 자동생성 (DIAH + 경보 코드 기반)
    sec9_title: meta.sec9_title || (() => {
      if (diah.active.includes('H')) return '9. 명의의 처방: "유동성 함정 탈출 — 말단 혈관 개통"';
      if (diah.active.includes('D')) return '9. 명의의 처방: "소득절벽 차단 — 외부 산소 공급 확보"';
      if (diah.active.includes('A')) return '9. 명의의 처방: "물가 독소 배출 — 체온 안정화"';
      if (diah.active.includes('I')) return '9. 명의의 처방: "사회 염증 완화 — 격차 해소"';
      if (alertCodes.length > 0) return `9. 명의의 처방: "${alertCodes.map(c => METAPHOR[c]?.bodyPart || c).join('·')} 집중 치료"`;
      return '9. 명의의 처방: "미세혈관 개통을 위한 예방적 처방"';
    })(),
    sec9_intro: meta.sec9_intro || (() => {
      if (diah.active.length > 0) {
        return `현재 이 유기체에는 ${diah.label} 트리거가 활성화되어 있다. 단일 처방으로는 부족하며, 원인-경로-말단을 동시에 겨냥하는 복합 처방이 필요하다.`;
      }
      if (alertCodes.length > 0) {
        return `경보 게이지가 감지되었다. 지금은 예방 처방의 적기다. 흐름이 굳기 전에 미세혈관을 개통해야 한다.`;
      }
      return "현재 안정적이나, 미세석회는 무증상으로 쌓인다. 선제적 흐름 관리가 필요하다.";
    })(),
    sec9_prescriptions: meta.prescriptions || (() => {
      const _rxList = [];
      // 처방 1: 가장 나쁜 output 게이지 대응
      const _worstOut = OUTPUT_CODES.filter(c => g[c]?.available).sort((a,b) => {
        const gr = c => getGrade(c).includes("경보") ? 2 : getGrade(c).includes("주의") ? 1 : 0;
        return gr(b) - gr(a);
      })[0];
      if (_worstOut) {
        const _rxGrade = getGrade(_worstOut);
        const _rxM = METAPHOR[_worstOut];
        _rxList.push({
          title: `처방 1: ${_rxM?.bodyPart || _worstOut} ${_rxGrade.includes("경보") ? "응급 처치" : "주의 관리"} — ${_rxM?.name || _worstOut} 정상화`,
          text: `${_rxM?.["경보 ★"]?.prefix || _rxM?.["주의 ●"]?.prefix || ""} ${_rxGrade.includes("경보") ? `${_worstOut}(${fmtValue(_worstOut)})이 경보 수준이다. 즉각적 정책 투입이 필요하다.` : `${_worstOut}(${fmtValue(_worstOut)}) 주의 신호가 지속된다. 선제적 모니터링과 완화 조치가 필요하다.`}`,
        });
      }
      // 처방 2: 가장 나쁜 input 게이지 대응
      const _worstIn = INPUT_CODES.filter(c => g[c]?.available).sort((a,b) => {
        const gr = c => getGrade(c).includes("경보") ? 2 : getGrade(c).includes("주의") ? 1 : 0;
        return gr(b) - gr(a);
      })[0];
      if (_worstIn && _worstIn !== _worstOut) {
        const _rxM2 = METAPHOR[_worstIn];
        const _rxGrade2 = getGrade(_worstIn);
        _rxList.push({
          title: `처방 2: ${_rxM2?.bodyPart || _worstIn} 관리 — ${_rxM2?.name || _worstIn} ${_rxGrade2.includes("경보") ? "경보 대응" : "안정화"}`,
          text: `${_rxM2?.diagnosisTemplate?.[_rxGrade2]?.(fmtValue(_worstIn), fmtChange(_worstIn)) || `${_worstIn}(${fmtValue(_worstIn)}) 관리가 필요하다.`} 이 지표가 추가 악화되면 CAM(자본대사) 봉쇄로 전이될 수 있다.`,
        });
      }
      // 처방 3: 이중봉쇄 예방 또는 산소 공급 유지
      const _bestIn = INPUT_CODES.filter(c => g[c]?.available && getGrade(c) === "양호 ○")[0];
      if (_bestIn) {
        const _rxM3 = METAPHOR[_bestIn];
        _rxList.push({
          title: `처방 3: ${_rxM3?.bodyPart || _bestIn} 강점 유지 — 산소 공급 경로 보존`,
          text: `현재 ${_rxM3?.name || _bestIn}(${_bestIn})이 양호하다. 이 강점을 유지하는 것이 경제 생존의 마지막 보루다. ${_rxM3?.["양호 ○"]?.prefix || ""} 정책 우선순위에서 이 경로를 보호해야 한다.`,
        });
      }
      if (_rxList.length === 0) {
        _rxList.push({ title: "처방 1: 흐름 모니터링 강화", text: "현재 안정적이나, 잠복기 미세석회 침착을 예방하기 위해 핵심 게이지 주간 모니터링을 권고한다." });
      }
      return _rxList;
    })(),
    sec9_rules: ALERT_RULES,

    // 섹션10
    sec10_sources: sources.map((s, i) => ({ ...s, period: meta.sourcePeriods?.[i] || meta.month })),
    sec10_disclaimer: "본 보고서는 DIAH-7M 경제건강검진 시스템에 의해 자동 생성된 진단 결과서입니다. 투자 권유나 정책 제안이 아니며, 참고용으로만 활용하시기 바랍니다. 개별 경제 주체의 의사결정에 대한 책임은 본인에게 있습니다.",

    // 부록
    appendix: APPENDIX,

    // ── v2.8 신규: 종합등급 이원 구조 ──
    _v28_engineVersion: 'v2.8',
    _v28_isV51: _isV51,

    // 순환등급 (축1~8)
    _v28_cyclicalLevel: _grades.cyclicalLevel,
    _v28_cyclicalCode: _grades.cyclicalCode,
    _v28_eff: _grades.eff,
    _v28_maxAxisCode: _grades.maxAxisCode,
    _v28_boost: _grades.boost,
    _v28_crisisCount: _grades.crisisCount,
    _v28_alertCount: _grades.alertCount,
    _v28_cautionCount: _grades.cautionCount,

    // 구조등급 (축9)
    _v28_structuralLevel: _grades.structuralLevel,
    _v28_structuralCode: _grades.structuralCode,

    // 종합 표시
    _v28_gradeDisplay: _grades.display,
    _v28_coverGrade: _isV51
      ? `순환 건강: ${_grades.cyclicalLevel} | 구조 건강: ${_grades.structuralLevel}`
      : _grades.cyclicalLevel,

    // 종합 진단 서사 (이원 구조)
    _v28_overallNarrative: (() => {
      const lines = [];
      lines.push(`■ 순환 건강: ${_grades.cyclicalLevel}`);
      if (_grades.eff !== null) {
        lines.push(`  유효등급(eff) = ${_grades.eff} (최고위기축 ${_grades.maxAxisCode} + 교차부스트 ${_grades.boost})`);
        const parts = [];
        if (_grades.crisisCount > 0) parts.push(`위기 ${_grades.crisisCount}축`);
        if (_grades.alertCount > 0) parts.push(`경보 ${_grades.alertCount}축`);
        if (_grades.cautionCount > 0) parts.push(`주의 ${_grades.cautionCount}축`);
        if (parts.length > 0) lines.push(`  순환축 현황: ${parts.join(', ')}`);
      }
      if (_grades.cyclicalCode >= 3) lines.push('  → 다수의 장기에서 동시에 위험 신호가 감지. 전신 건강검진 결과 중증 상태.');
      else if (_grades.cyclicalCode >= 2) lines.push('  → 일부 장기에서 경보 수준의 이상 발견. 집중 관찰과 대응 필요.');
      else if (_grades.cyclicalCode >= 1) lines.push('  → 몇몇 지표에서 주의 신호 감지. 현재는 관리 가능한 수준.');
      else lines.push('  → 순환 건강 안정적. 주요 장기가 정상 범위 내에서 기능.');
      if (_grades.structuralLevel) {
        lines.push('');
        lines.push(`■ 구조 건강: ${_grades.structuralLevel}`);
        if (_grades.structuralCode >= 3) {
          lines.push('  → 인구 고령화(신체 나이)가 위기 수준. 순환 건강과 독립적인 장기 체력 평가.');
          lines.push('  → 10년+ 시계의 구조 개혁 없이는 순환 건강이 양호해도 장기 지속 어려움.');
        } else if (_grades.structuralCode >= 2) lines.push('  → 인구 구조에서 경보 수준의 변화 진행 중.');
        else if (_grades.structuralCode >= 1) lines.push('  → 인구 구조에 주의 필요하지만 아직 안정적.');
        else lines.push('  → 인구 구조 양호.');
      }
      return lines.join('\n');
    })(),

    // 교차신호 서사 (6쌍 기본)
    _v28_crossSignals: _crossSignals,
    _v28_crossSignalCount: _crossSignals.length,
    _v28_crossSignalSummary: _crossSignals.length > 0
      ? `교차신호 ${_crossSignals.length}건 감지: ${_crossSignals.map(c => `${c.pair}(${c.severityDesc})`).join(', ')}`
      : '교차신호 미감지',

    // ── 체감경제 경보 (거시 양호 + 미세혈관 심각 감지) ──
    // null이면 경보 없음, 있으면 { level, title, narrative, axis3Summary, axis5Summary }
    chaegam_alert,
  };

  // ── v2.8+2D: 교차신호 고도화 통합 (선택적 로딩) ──
  try {
    const enhance2D = require('./DIAH-7M_교차신호_2D_v1_0.js');
    const e2d = enhance2D(result);

    D._v28_2D_available = true;
    D._v28_2D_summary = e2d.summary;

    // 확장 교차신호 (15쌍)
    D._v28_2D_crossSignals = e2d.crossSignals2D;
    D._v28_2D_crossSignalCount = e2d.summary.totalPairs;

    // 캐스케이드 서사
    D._v28_2D_cascades = e2d.cascades.map(cc => ({
      name: cc.name,
      path: cc.path,
      organ: cc.organ,
      severity: cc.severity,
      totalSeverity: cc.totalSeverity,
      leadMonths: cc.leadTotalMonths,
      historicalRef: cc.historicalRef,
      narrative: `연쇄 전이 경로 "${cc.name}" 활성: ${cc.path} [${cc.severity}]. ` +
        `총 리드타임 ${cc.leadTotalMonths}개월. 역사적 사례: ${cc.historicalRef || '없음'}.`,
    }));
    D._v28_2D_cascadeCount = e2d.cascades.length;

    // 선행지표 경고
    D._v28_2D_leadTimeAlerts = e2d.leadTimeAlerts.map(al => ({
      source: al.source,
      target: al.target,
      sourceLevel: al.sourceLevel,
      leadMonths: al.leadMonths,
      confidence: al.confidence,
      warning: al.warning,
    }));
    D._v28_2D_leadTimeCount = e2d.leadTimeAlerts.length;

    // 조합경보 역사 매칭
    D._v28_2D_comboHistory = e2d.comboHistory;
    D._v28_2D_comboHistoryCount = e2d.comboHistory.length;

    // 부스트 (참조용, 실제 등급에는 v5.1 기본값 사용)
    D._v28_2D_boost = e2d.boost2D;

    // 종합 2D 서사
    D._v28_2D_narrative = e2d.summary.narrative;
    D._v28_2D_riskLevel = e2d.summary.riskLevel;

  } catch (e) {
    // 2D 모듈 미설치 시 기본값
    D._v28_2D_available = false;
  }

  return D;
}


// ━━━ 모듈 내보내기 ━━━
if (typeof module !== "undefined") {
  module.exports = {
    generateNarrative,
    METAPHOR,
    GAUGE_NARRATIVE,    // v2 코드 59개 — report-grammar.js에서 로드
    SATELLITE_INTRO,    // 위성 물리흐름 서사 (선언문 + 흐름도 + 교차검증)
    SECTION_0,
    M7_TABLE,
    APPENDIX,
    ALERT_MAP,
    DIAH_NARRATIVE,
    FAMILY_HISTORY_PAST,
    CROSS_SIGNAL_NARRATIVES,
    STRUCTURAL_TEMPLATES,
  };
}
